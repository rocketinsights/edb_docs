---
title: The SQL Language
---


The following sections describe the Oracle-compatible subset of the Postgres Plus Advanced Server SQL language. The SQL syntax, commands, data types, and functions that follow work in both Postgres Plus Advanced Server and in Oracle.

Other aspects of the Postgres Plus Advanced Server SQL language that are not Oracle compatible can be found in the Postgres Plus documentation set. The Postgres Plus documentation set includes syntax and commands for extended functionality not included in this guide.

This section is organized into the following sections:
 - General discussion of Postgres Plus Advanced Server SQL syntax and language elements
 - Data types
 - Summary of SQL commands
 - Built-in functions

## SQL Syntax

This section describes the general syntax of SQL. It forms the foundation for understanding the following chapters that include detail about how the SQL commands are applied to define and modify data.

### Lexical Structure

SQL input consists of a sequence of commands. A *command* is composed of a sequence of *tokens*, terminated by a semicolon (;). The end of the input stream also terminates a command. Which tokens are valid depends on the syntax of the particular command.

A token can be a *key word*, an *identifier*, a *quoted identifier*, a *literal* (or *constant*), or a special character symbol. Tokens are normally separated by *whitespace* (space, tab, new line), but need not be if there is no ambiguity (which is generally only the case if a special character is adjacent to some other token type).

Additionally, *comments* can occur in SQL input. They are not tokens - they are effectively equivalent to whitespace.

For example, the following is (syntactically) valid SQL input:

SELECT \* FROM MY\_TABLE;

UPDATE MY\_TABLE SET A = 5;

INSERT INTO MY\_TABLE VALUES (3, 'hi there');

This is a sequence of three commands, one per line (although this is not required; more than one command can be on a line, and commands can usually be split across lines).

The SQL syntax is not very consistent regarding what tokens identify commands and which are operands or parameters. The first few tokens are generally the command name, so in the above example we would usually speak of a SELECT, an UPDATE, and an INSERT command. But for instance the UPDATE command always requires a SET token to appear in a certain position, and this particular variation of INSERT also requires a VALUES token in order to be complete. The precise syntax rules for each command are described in Section <span class="underline">3.3</span>.

### Identifiers and Key Words

Tokens such as SELECT, UPDATE, or VALUES in the example above are examples of *key words*, that is, words that have a fixed meaning in the SQL language. The tokens MY\_TABLE and A are examples of *identifiers*. They identify names of tables, columns, or other database objects, depending on the command they are used in. Therefore they are sometimes simply called, “*names*”. Key words and identifiers have the same *lexical structure*, meaning that one cannot know whether a token is an identifier or a key word without knowing the language.

SQL identifiers and key words must begin with a letter (a-z or A-Z). Subsequent characters in an identifier or key word can be letters, underscores, digits (0-9), dollar signs ($), or number signs (\#).

Identifier and key word names are case insensitive. Therefore

UPDATE MY\_TABLE SET A = 5;

can equivalently be written as:

uPDaTE my\_TabLE SeT a = 5;

A convention often used is to write key words in upper case and names in lower case, e.g.,

UPDATE my\_table SET a = 5;

There is a second kind of identifier: the *delimited identifier* or *quoted identifier*. It is formed by enclosing an arbitrary sequence of characters in double-quotes ("). A delimited identifier is always an identifier, never a key word. So "select" could be used to refer to a column or table named "select", whereas an unquoted select would be taken as a key word and would therefore provoke a parse error when used where a table or column name is expected. The example can be written with quoted identifiers like this:

UPDATE "my\_table" SET "a" = 5;

Quoted identifiers can contain any character, except the character with code zero. (To include a double quote, write two double quotes.) This allows constructing table or column names that would otherwise not be possible, such as ones containing spaces or ampersands. The length limitation still applies.

Quoting an identifier also makes it case-sensitive, whereas unquoted names are always folded to lower case. For example, the identifiers FOO, foo, and "foo" are considered the same by Postgres Plus Advanced Server, but "Foo" and "FOO" are different from these three and each other. (The folding of unquoted names to lower case in Postgres Plus Advanced Server is an area of Oracle-incompatibility. In Oracle unquoted names are folded to upper case. Thus, foo is equivalent to "FOO" not "foo" in Oracle. If you want to write portable applications you are advised to always quote a particular name or never quote it.)

### Constants

The kinds of implicitly-typed constants in Postgres Plus Advanced Server are *strings* and *numbers*. Constants can also be specified with explicit types, which can enable more accurate representation and more efficient handling by the system. These alternatives are discussed in the following subsections.

#### String Constants

A *string constant* in SQL is an arbitrary sequence of characters bounded by single quotes ('), for example 'This is a string'. To include a single-quote character within a string constant, write two adjacent single quotes, e.g. 'Dianne''s horse'. Note that this is not the same as a double-quote character (").

#### Numeric Constants

Numeric constants are accepted in these general forms:

*digits*

*digits*.\[*digits*\]\[e\[+-\]*digits*\]

\[*digits*\].*digits*\[e\[+-\]*digits*\]

*digits*e\[+-\]*digits*

where *digits* is one or more decimal digits (0 through 9). At least one digit must be before or after the decimal point, if one is used. At least one digit must follow the exponent marker (e), if one is present. There may not be any spaces or other characters embedded in the constant. Note that any leading plus or minus sign is not actually considered part of the constant; it is an operator applied to the constant.

These are some examples of valid numeric constants:

42
3.5
4\.
.001
5e2
1.925e-3

A numeric constant that contains neither a decimal point nor an exponent is initially presumed to be type INTEGER if its value fits in type INTEGER (32 bits); otherwise it is presumed to be type BIGINT if its value fits in type BIGINT (64 bits); otherwise it is taken to be type NUMBER. Constants that contain decimal points and/or exponents are always initially presumed to be type NUMBER.

The initially assigned data type of a numeric constant is just a starting point for the type resolution algorithms. In most cases the constant will be automatically coerced to the most appropriate type depending on context. When necessary, you can force a numeric value to be interpreted as a specific data type by casting it as described in the following section.

#### Constants of Other Types

A constant of an arbitrary type can be entered using the following notation:

CAST('*string*' AS *type*)

The string constant’s text is passed to the input conversion routine for the type called *type*. The result is a constant of the indicated type. The explicit type cast may be omitted if there is no ambiguity as to the type the constant must be (for example, when it is assigned directly to a table column), in which case it is automatically coerced.

CAST can also be used to specify runtime type conversions of arbitrary expressions.

### Comments

A comment is an arbitrary sequence of characters beginning with double dashes and extending to the end of the line, e.g.:

\-- This is a standard SQL comment

Alternatively, C-style block comments can be used:

/\* multiline comment

\* block

\*/

where the comment begins with /\* and extends to the matching occurrence of \*/.

## Data Types

The following table shows the built-in general-purpose data types.

Table 3‑3‑1 Data Types

<table>
<tbody>
<tr class="odd">
<td>Name</td>
<td>Alias</td>
<td>Description</td>
</tr>
<tr class="even">
<td>BLOB</td>
<td>LONG RAW, RAW(<em>n</em>), BYTEA</td>
<td>Binary data</td>
</tr>
<tr class="odd">
<td>BOOLEAN</td>
<td></td>
<td>Logical Boolean (true/false)</td>
</tr>
<tr class="even">
<td>CHAR [ (<em>n</em>) ]</td>
<td>CHARACTER [ (<em>n</em>) ]</td>
<td>Fixed-length character string of n characters</td>
</tr>
<tr class="odd">
<td>CLOB</td>
<td>LONG, LONG VARCHAR</td>
<td>Long character string</td>
</tr>
<tr class="even">
<td>DATE</td>
<td>TIMESTAMP(0)</td>
<td>Date and time to the second</td>
</tr>
<tr class="odd">
<td>DOUBLE PRECISION</td>
<td><p>FLOAT,</p>
<p>FLOAT(25) – FLOAT(53)</p></td>
<td>Double precision floating-point number</td>
</tr>
<tr class="even">
<td>INTEGER</td>
<td>INT, BINARY_INTEGER, PLS_INTEGER</td>
<td>Signed four-byte integer</td>
</tr>
<tr class="odd">
<td>NUMBER</td>
<td>DEC, DECIMAL, NUMERIC</td>
<td>Exact numeric with optional decimal places</td>
</tr>
<tr class="even">
<td>NUMBER(<em>p</em> [, <em>s</em> ])</td>
<td><p>DEC(p [, <em>s</em> ]),</p>
<p>DECIMAL(<em>p</em> [, <em>s</em> ]),</p>
<p>NUMERIC(<em>p</em> [, <em>s</em> ])</p></td>
<td>Exact numeric of maximum precision, <em>p</em>, and optional scale, <em>s</em></td>
</tr>
<tr class="odd">
<td>REAL</td>
<td>FLOAT(1) – FLOAT(24)</td>
<td>Single precision floating-point number</td>
</tr>
<tr class="even">
<td>TIMESTAMP [ (<em>p</em>) ]</td>
<td></td>
<td>Date and time with optional, fractional second precision, <em>p</em></td>
</tr>
<tr class="odd">
<td>TIMESTAMP [ (<em>p</em>) ] WITH TIME ZONE</td>
<td></td>
<td>Date and time with optional, fractional second precision, <em>p</em>, and with time zone</td>
</tr>
<tr class="even">
<td>VARCHAR2(<em>n</em>)</td>
<td>CHAR VARYING(<em>n</em>), CHARACTER VARYING(<em>n</em>), VARCHAR(<em>n</em>)</td>
<td>Variable-length character string with a maximum length of <em>n</em> characters</td>
</tr>
<tr class="odd">
<td>XMLTYPE</td>
<td></td>
<td>XML data</td>
</tr>
</tbody>
</table>

### Numeric Types

Numeric types consist of four-byte integers, four-byte and eight-byte floating-point numbers, and fixed-precision decimals. The following table lists the available types.

Table 3‑3‑2 Numeric Types

|                         |              |                                                                  |                                              |
| ----------------------- | ------------ | ---------------------------------------------------------------- | -------------------------------------------- |
| Name                    | Storage Size | Description                                                      | Range                                        |
| BINARY\_INTEGER         | 4 bytes      | Signed integer, Alias for INTEGER                                | \-2,147,483,648 to +2,147,483,647            |
| DOUBLE PRECISION        | 8 bytes      | Variable-precision, inexact                                      | 15 decimal digits precision                  |
| INTEGER                 | 4 bytes      | Usual choice for integer                                         | \-2,147,483,648 to +2,147,483,647            |
| NUMBER                  | Variable     | User-specified precision, exact                                  | Up to 1000 digits of precision               |
| NUMBER(*p* \[, *s* \] ) | Variable     | Exact numeric of maximum precision, *p*, and optional scale, *s* | Up to 1000 digits of precision               |
| PLS\_INTEGER            | 4 bytes      | Signed integer, Alias for INTEGER                                | \-2,147,483,648 to +2,147,483,647            |
| REAL                    | 4 bytes      | Variable-precision, inexact                                      | 6 decimal digits precision                   |
| ROWID                   | 8 bytes      | Signed 8 bit integer.                                            | \-9223372036854775808 to 9223372036854775807 |

The following sections describe the types in detail.

#### Integer Types

The type, INTEGER, stores whole numbers (without fractional components) between the values of -2,147,483,648 and +2,147,483,647. Attempts to store values outside of the allowed range will result in an error.

Columns of the ROWID type holds fixed-length binary data that describes the physical address of a record. ROWID is an unsigned, four-byte INTEGER that stores whole numbers (without fractional components) between the values of 0 and 4,294,967,295. Attempts to store values outside of the allowed range will result in an error.

#### Arbitrary Precision Numbers

The type, NUMBER, can store practically an unlimited number of digits of precision and perform calculations exactly. It is especially recommended for storing monetary amounts and other quantities where exactness is required. However, the NUMBER type is very slow compared to the floating-point types described in the next section.

In what follows we use these terms: The *scale* of a NUMBER is the count of decimal digits in the fractional part, to the right of the decimal point. The *precision* of a NUMBER is the total count of significant digits in the whole number, that is, the number of digits to both sides of the decimal point. So the number 23.5141 has a precision of 6 and a scale of 4. Integers can be considered to have a scale of zero.

Both the precision and the scale of the NUMBER type can be configured. To declare a column of type NUMBER use the syntax

NUMBER(*precision*, *scale*)

The precision must be positive, the scale zero or positive. Alternatively,

NUMBER(*precision*)

selects a scale of 0. Specifying NUMBER without any precision or scale creates a column in which numeric values of any precision and scale can be stored, up to the implementation limit on precision. A column of this kind will not coerce input values to any particular scale, whereas NUMBER columns with a declared scale will coerce input values to that scale. (The SQL standard requires a default scale of 0, i.e., coercion to integer precision. For maximum portability, it is best to specify the precision and scale explicitly.)

If the precision or scale of a value is greater than the declared precision or scale of a column, the system will attempt to round the value. If the value cannot be rounded so as to satisfy the declared limits, an error is raised.

#### Floating-Point Types

The data types REAL and DOUBLE PRECISION are *inexact*, variable-precision numeric types. In practice, these types are usually implementations of IEEE Standard 754 for Binary Floating-Point Arithmetic (single and double precision, respectively), to the extent that the underlying processor, operating system, and compiler support it.

Inexact means that some values cannot be converted exactly to the internal format and are stored as approximations, so that storing and printing back out a value may show slight discrepancies. Managing these errors and how they propagate through calculations is the subject of an entire branch of mathematics and computer science and will not be discussed further here, except for the following points:

If you require exact storage and calculations (such as for monetary amounts), use the NUMBER type instead.

If you want to do complicated calculations with these types for anything important, especially if you rely on certain behavior in boundary cases (infinity, underflow), you should evaluate the implementation carefully.

Comparing two floating-point values for equality may or may not work as expected.

On most platforms, the REAL type has a range of at least 1E-37 to 1E+37 with a precision of at least 6 decimal digits. The DOUBLE PRECISION type typically has a range of around 1E-307 to 1E+308 with a precision of at least 15 digits. Values that are too large or too small will cause an error. Rounding may take place if the precision of an input number is too high. Numbers too close to zero that are not representable as distinct from zero will cause an underflow error.

Postgres Plus Advanced Server also supports the SQL standard notations FLOAT and FLOAT(*p*) for specifying inexact numeric types. Here, *p* specifies the minimum acceptable precision in binary digits. Postgres Plus Advanced Server accepts FLOAT(1) to FLOAT(24) as selecting the REAL type, while FLOAT(25) to FLOAT(53) as selecting DOUBLE PRECISION. Values of *p* outside the allowed range draw an error. FLOAT with no precision specified is taken to mean DOUBLE PRECISION.

### Character Types

The following table lists the general-purpose character types available in Postgres Plus Advanced Server.

Table 3‑3‑3 Character Types

|                |                                                                                                       |
| -------------- | ----------------------------------------------------------------------------------------------------- |
| Name           | Description                                                                                           |
| CHAR\[(*n*)\]  | Fixed-length character string, blank-padded to the size specified by *n*                              |
| CLOB           | Large variable-length up to 1 GB                                                                      |
| LONG           | Variable unlimited length.                                                                            |
| NVARCHAR(*n*)  | Variable-length national character string, with limit.                                                |
| NVARCHAR2(*n*) | Variable-length national character string, with limit.                                                |
| STRING         | Alias for VARCHAR2.                                                                                   |
| VARCHAR(*n*)   | Variable-length character string, with limit (considered deprecated, but supported for compatibility) |
| VARCHAR2(*n*)  | Variable-length character string, with limit                                                          |

Where *n* is a positive integer; these types can store strings up to *n* characters in length. An attempt to assign a value that exceeds the length of *n* will result in an error, unless the excess characters are all spaces, in which case the string will be truncated to the maximum length.

CHAR

If you do not specify a value for *n*, *n* will default to 1. If the string to be assigned is shorter than *n*, values of type CHAR will be space-padded to the specified width (*n*), and will be stored and displayed that way.

Padding spaces are treated as semantically insignificant. That is, trailing spaces are disregarded when comparing two values of type CHAR, and they will be removed when converting a CHAR value to one of the other string types.

If you explicitly cast an over-length value to a CHAR(*n*) type, the value will be truncated to *n* characters without raising an error (as specified by the SQL standard).

VARCHAR, VARCHAR2, NVARCHAR and NVARCHAR2

If the string to be assigned is shorter than *n*, values of type VARCHAR, VARCHAR2, NVARCHAR and NVARCHAR2 will store the shorter string without padding.

Note that trailing spaces *are* semantically significant in VARCHAR values.

If you explicitly cast a value to a VARCHAR type, an over-length value will be truncated to *n* characters without raising an error (as specified by the SQL standard).

CLOB

You can store a large character string in a CLOB type. CLOB is semantically equivalent to VARCHAR2 except no length limit is specified. Generally, you should use a CLOB type if the maximum string length is not known.

The longest possible character string that can be stored in a CLOB type is about 1 GB.

The storage requirement for data of these types is the actual string plus 1 byte if the string is less than 127 bytes, or 4 bytes if the string is 127 bytes or greater. In the case of CHAR, the padding also requires storage. Long strings are compressed by the system automatically, so the physical requirement on disk may be less. Long values are stored in background tables so they do not interfere with rapid access to the shorter column values.

The database character set determines the character set used to store textual values.

### Binary Data

The following data types allows storage of binary strings.

Table 3‑3‑4 Binary Large Object

|           |                                                                                                                                            |                                                                  |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------- |
| Name      | Storage Size                                                                                                                               | Description                                                      |
| BINARY    | The length of the binary string.                                                                                                           | Fixed-length binary string, with a length between 1 and 8300.    |
| BLOB      | The actual binary string plus 1 byte if the binary string is less than 127 bytes, or 4 bytes if the binary string is 127 bytes or greater. | Variable-length binary string                                    |
| VARBINARY | The length of the binary string                                                                                                            | Variable-length binary string, with a length between 1 and 8300. |

A binary string is a sequence of octets (or bytes). Binary strings are distinguished from characters strings by two characteristics: First, binary strings specifically allow storing octets of value zero and other "non-printable" octets (defined as octets outside the range 32 to 126). Second, operations on binary strings process the actual bytes, whereas the encoding and processing of character strings depends on locale settings.

### Date/Time Types

The following discussion of the date/time types assumes that the configuration parameter, edb\_redwood\_date, has been set to true whenever a table is created or altered.

Postgres Plus Advanced Server supports the date/time types shown in the following table.

Table 3‑3‑5 Date/Time Types

<table>
<tbody>
<tr class="odd">
<td>Name</td>
<td>Storage Size</td>
<td>Description</td>
<td>Low Value</td>
<td>High Value</td>
<td>Resolution</td>
</tr>
<tr class="even">
<td>DATE</td>
<td>8 bytes</td>
<td>Date and time</td>
<td>4713 BC</td>
<td>5874897 AD</td>
<td>1 second</td>
</tr>
<tr class="odd">
<td><p>INTERVAL DAY TO SECOND</p>
<p>[(<em>p</em>)]</p></td>
<td>12 bytes</td>
<td>Period of time</td>
<td>-178000000 years</td>
<td>178000000 years</td>
<td>1 microsecond / 14 digits</td>
</tr>
<tr class="even">
<td>INTERVAL YEAR TO MONTH</td>
<td>12 bytes</td>
<td>Period of time</td>
<td>-178000000 years</td>
<td>178000000 years</td>
<td>1 microsecond / 14 digits</td>
</tr>
<tr class="odd">
<td>TIMESTAMP [(<em>p</em>)]</td>
<td>8 bytes</td>
<td>Date and time</td>
<td>4713 BC</td>
<td>5874897 AD</td>
<td>1 microsecond</td>
</tr>
<tr class="even">
<td>TIMESTAMP [(<em>p</em>)] WITH TIME ZONE</td>
<td>8 bytes</td>
<td>Date and time with time zone</td>
<td>4713 BC</td>
<td>5874897 AD</td>
<td>1 microsecond</td>
</tr>
</tbody>
</table>

When DATE appears as the data type of a column in the data definition language (DDL) commands, CREATE TABLE or ALTER TABLE, it is translated to TIMESTAMP(0) at the time the table definition is stored in the database. Thus, a time component will also be stored in the column along with the date.

When DATE appears as a data type of a variable in an SPL declaration section, or the data type of a formal parameter in an SPL procedure or an SPL function, or the return type of an SPL function, it is always translated to TIMESTAMP(0) and thus can handle a time component if present.

TIMESTAMP accepts an optional precision value *p* which specifies the number of fractional digits retained in the seconds field. The allowed range of *p* is from 0 to 6 with the default being 6.

When TIMESTAMP values are stored as double precision floating-point numbers (currently the default), the effective limit of precision may be less than 6. TIMESTAMP values are stored as seconds before or after midnight 2000-01-01. Microsecond precision is achieved for dates within a few years of 2000-01-01, but the precision degrades for dates further away. When TIMESTAMP values are stored as eight-byte integers (a compile-time option), microsecond precision is available over the full range of values. However eight-byte integer timestamps have a more limited range of dates than shown above: from 4713 BC up to 294276 AD.

TIMESTAMP (*p*) WITH TIME ZONE is similar to TIMESTAMP (*p*), but includes the time zone as well.

#### INTERVAL Types

INTERVAL values specify a period of time. Values of INTERVAL type are composed of fields that describe the value of the data. The following table lists the fields allowed in an INTERVAL type:

| Field Name | INTERVAL Values Allowed                                                 |
| ---------- | ----------------------------------------------------------------------- |
| YEAR       | Integer value (positive or negative)                                    |
| MONTH      | 0 through 11                                                            |
| DAY        | Integer value (positive or negative)                                    |
| HOUR       | 0 through 23                                                            |
| MINUTE     | 0 through 59                                                            |
| SECOND     | 0 through 59.9(*p*) where 9(*p*) is the precision of fractional seconds |

The fields must be presented in descending order – from YEARS to MONTHS, and from DAYS to HOURS, MINUTES and then SECONDS.

Advanced Server supports two Oracle-compatible INTERVAL types.

The first variation supported by Advanced Server is INTERVAL DAY TO SECOND \[(*p*)\]. INTERVAL DAY TO SECOND \[(*p*)\] stores a time interval in days, hours, minutes and seconds.

> *p* specifies the precision of the second field.

Advanced Server interprets the value:

> INTERVAL '1 2:34:5.678' DAY TO SECOND(3)

as 1 day, 2 hours, 34 minutes, 5 seconds and 678 thousandths of a second.

Advanced Server interprets the value:

> INTERVAL '1 23' DAY TO HOUR

as 1 day and 23 hours.

Advanced Server interprets the value:

> INTERVAL '2:34' HOUR TO MINUTE

as 2 hours and 34 minutes.

Advanced Server interprets the value:

> INTERVAL '2:34:56.129' HOUR TO SECOND(2)

as 2 hours, 34 minutes, 56 seconds and 13 thousandths of a second. Note that the fractional second is rounded up to 13 because of the specified precision.

The second Oracle-compatible variation supported by Advanced Server is INTERVAL YEAR TO MONTH. This variation stores a time interval in years and months.

Advanced Server interprets the value:

> INTERVAL '12-3' YEAR TO MONTH

as 12 years and 3 months.

Advanced Server interprets the value:

> INTERVAL '456' YEAR(2)

as 12 years and 3 months.

Advanced Server interprets the value:

> INTERVAL '300' MONTH

as 25 years.

#### Date/Time Input

Date and time input is accepted in ISO 8601 SQL-compatible format, the Oracle default dd-MON-yy format, as well as a number of other formats provided that there is no ambiguity as to which component is the year, month, and day. However, use of the TO\_DATE function is strongly recommended to avoid ambiguities.

Any date or time literal input needs to be enclosed in single quotes, like text strings. The following SQL standard syntax is also accepted:

*type* '*value*'

*type* is either DATE or TIMESTAMP.

*value* is a date/time text string.

##### Dates

The following table shows some possible input formats for dates, all of which equate to January 8, 1999.

Table 3‑3‑6 Date Input

|                 |
| --------------- |
| Example         |
| January 8, 1999 |
| 1999-01-08      |
| 1999-Jan-08     |
| Jan-08-1999     |
| 08-Jan-1999     |
| 08-Jan-99       |
| Jan-08-99       |
| 19990108        |
| 990108          |

The date values can be assigned to a DATE or TIMESTAMP column or variable. The hour, minute, and seconds fields will be set to zero if the date value is not appended with a time value.

##### Times

Some examples of the time component of a date or time stamp are shown in the following table.

Table 3‑3‑7 Time Input

|              |                                          |
| ------------ | ---------------------------------------- |
| Example      | Description                              |
| 04:05:06.789 | ISO 8601                                 |
| 04:05:06     | ISO 8601                                 |
| 04:05        | ISO 8601                                 |
| 040506       | ISO 8601                                 |
| 04:05 AM     | Same as 04:05; AM does not affect value  |
| 04:05 PM     | Same as 16:05; input hour must be \<= 12 |

##### Time Stamps

Valid input for time stamps consists of a concatenation of a date and a time. The date portion of the time stamp can be formatted according to any of the examples shown in Table 3‑3‑6 Date Input. The time portion of the time stamp can be formatted according to any of examples shown in Table 3‑3‑7 Time Input.

The following is an example of a time stamp which follows the Oracle default format.

08-JAN-99 04:05:06

The following is an example of a time stamp which follows the ISO 8601 standard.

1999-01-08 04:05:06

#### Date/Time Output

The default output format of the date/time types will be either the Oracle compatible style (dd-MON-yy) referred to as the *Redwood date style*, or the ISO 8601 format (yyyy-mm-dd) depending upon the application interface to the database. Applications that use JDBC such as SQL Interactive always present the date in ISO 8601 form. Other applications such as PSQL present the date in Redwood form.

The following table shows examples of the output formats for the two styles, Redwood and ISO 8601.

Table 3‑3‑8 Date/Time Output Styles

|                       |                     |
| --------------------- | ------------------- |
| Description           | Example             |
| Redwood style         | 31-DEC-05 07:37:16  |
| ISO 8601/SQL standard | 1997-12-17 07:37:16 |

#### Internals

Postgres Plus Advanced Server uses Julian dates for all date/time calculations. Julian dates correctly predict or calculate any date after 4713 BC based on the assumption that the length of the year is 365.2425 days.

### Boolean Type

Postgres Plus Advanced Server provides the standard SQL type BOOLEAN. BOOLEAN can have one of only two states: TRUE or FALSE. A third state, UNKNOWN, is represented by the SQL NULL value.

Table 3‑3‑9 Boolean Type

|         |              |                              |
| ------- | ------------ | ---------------------------- |
| Name    | Storage Size | Description                  |
| BOOLEAN | 1 byte       | Logical Boolean (true/false) |

The valid literal value for representing the true state is TRUE. The valid literal for representing the false state is FALSE.

### XML Type

The XMLTYPE data type is used to store XML data. Its advantage over storing XML data in a character field is that it checks the input values for well-formedness, and there are support functions to perform type-safe operations on it.

The XML type can store well-formed “documents”, as defined by the XML standard, as well as “content” fragments, which are defined by the production XMLDecl? content in the XML standard. Roughly, this means that content fragments can have more than one top-level element or character node.

**Note:** Oracle does not support the storage of content fragments in XMLTYPE columns.

The following example shows the creation and insertion of a row into a table with an XMLTYPE column.

CREATE TABLE books (

content XMLTYPE

);

INSERT INTO books VALUES (XMLPARSE (DOCUMENT '\<?xml version="1.0"?\>\<book\>\<title\>Manual\</title\>\<chapter\>...\</chapter\>\</book\>'));

SELECT \* FROM books;

content

\----------------------------------------------------------

\<book\>\<title\>Manual\</title\>\<chapter\>...\</chapter\>\</book\>

(1 row)

## SQL Commands

This section provides a summary of the Oracle compatible SQL commands supported by Postgres Plus Advanced Server. The SQL commands in this section will work on both an Oracle database and a Postgres Plus Advanced Server database.

Note the following points:
 - Postgres Plus Advanced Server supports other commands that are not listed here. These commands may have no Oracle equivalent or they may provide the similar or same functionality as an Oracle SQL command, but with different syntax.
 - The SQL commands in this section do not necessarily represent the full syntax, options, and functionality available in the command. Syntax, options, and functionality that are not Oracle compatible have been omitted from the command description and syntax.
 - The Postgres Plus documentation set contains aspects of the command that may not be Oracle compatible.<span id="_Ref178500664" class="anchor"></span>

### ALTER INDEX

Name

ALTER INDEX -- modify an existing index.

Synopsis

Advanced Server supports two Oracle-compatible variations of the ALTER INDEX command. Use the first variation to rename an index:

ALTER INDEX *name* RENAME TO *new\_name*

Use the second variation of the ALTER INDEX command to rebuild an index:

ALTER INDEX *name* REBUILD

Description

ALTER INDEX changes the definition of an existing index. The RENAME clause changes the name of the index. The REBUILD clause reconstructs an index, replacing the old copy of the index with an updated version based on the index's table.

The REBUILD clause invokes the PostgreSQL REINDEX command; for more information about using the REBUILD clause, see the PostgreSQL core documentation at:

<http://www.enterprisedb.com/docs/en/9.4/pg/sql-reindex.html>

ALTER INDEX has no effect on stored data.

Parameters

*name*

The name (possibly schema-qualified) of an existing index.

*new\_name*

New name for the index.

Examples

To change the name of an index from name\_idx to empname\_idx:

ALTER INDEX name\_idx RENAME TO empname\_idx;

To rebuild an index named empname\_idx:

ALTER INDEX empname\_idx REBUILD;

**See Also**

[CREATE INDEX](#_CREATE_INDEX), [DROP INDEX](#_Ref178500676)

### ALTER PROCEDURE

Name

ALTER PROCEDURE 

Synopsis

ALTER PROCEDURE *procedure*\_*name* *options* \[RESTRICT\]

Description

Use the ALTER PROCEDURE statement to specify that a procedure is a SECURITY INVOKER or SECURITY DEFINER.

Parameters

*procedure\_name*

*procedure\_name* specifies the (possibly schema-qualified) name of a stored procedure.

*options* may be:

\[EXTERNAL\] SECURITY DEFINER

Specify SECURITY DEFINER to instruct the server to execute the procedure with the privileges of the user that created the procedure. The EXTERNAL keyword is accepted for compatibility, but ignored.

\[EXTERNAL\] SECURITY INVOKER

Specify SECURITY INVOKER to instruct the server to execute the procedure with the privileges of the user that is invoking the procedure. The EXTERNAL keyword is accepted for compatibility, but ignored.

The RESTRICT keyword is accepted for compatibility, but ignored.

Examples

The following command specifies that the update\_balance procedure should execute with the privileges of the user invoking the procedure:

ALTER PROCEDURE update\_balance SECURITY INVOKER;

<span id="_ALTER_ROLE" class="anchor"></span>

### ALTER ROLE

Name

ALTER ROLE -- change a database role

Synopsis

ALTER ROLE *role\_name* IDENTIFIED BY *password*

Description

ALTER ROLE changes the password of a role. Only superusers or users with the CREATEROLE attribute can use this command. If the role to be altered has the SUPERUSER attribute, then only a superuser can give this command. Note that unless the role has the LOGIN attribute, the password serves no real purpose.

Parameters

*role\_name*

The name of the role whose password is to be altered.

*password*

The role’s new password.

Notes

You can use GRANT and REVOKE to change a role’s memberships.

Examples

To change a role’s password:

ALTER ROLE admins IDENTIFIED BY xyRP35z;

***Using ALTER ROLE to Manage Database Link and DBMS\_RLS Privileges***

Advanced Server includes extra syntax (not offered by Oracle) for the ALTER ROLE command. This syntax can be useful when assigning privileges related to creating and dropping Oracle-compatible database links, and fine-grained access control (using DBMS\_RLS).

**CREATE DATABASE LINK**

A user who holds the CREATE DATABASE LINK privilege may create a private database link. The following ALTER ROLE command grants privileges to an Advanced Server role that allow the specified role to create a private database link:

> ALTER ROLE *role*\_*name*
> WITH \[CREATEDBLINK | CREATE DATABASE LINK\]

This command is the functional equivalent of:

> GRANT CREATE DATABASE LINK to *role*\_*name*

Use the following command to revoke the privilege:

> ALTER ROLE *role*\_*name*
> WITH \[NOCREATEDBLINK | NO CREATE DATABASE LINK\]

Please note: the CREATEDBLINK and NOCREATEDBLINK keywords should be considered deprecated syntax; we recommend using the CREATE DATABASE LINK and NO CREATE DATABASE LINK syntax options.

**CREATE PUBLIC DATABASE LINK**

A user who holds the CREATE PUBLIC DATABASE LINK privilege may create a public database link. The following ALTER ROLE command grants privileges to an Advanced Server role that allow the specified role to create a public database link:

> ALTER ROLE *role*\_*name*
> WITH \[CREATEPUBLICDBLINK | CREATE PUBLIC DATABASE LINK\]

This command is the functional equivalent of:

> GRANT CREATE PUBLIC DATABASE LINK to *role*\_*name*

Use the following command to revoke the privilege:

> ALTER ROLE *role*\_*name*
> WITH \[NOCREATEPUBLICDBLINK | NO CREATE PUBLIC DATABASE LINK\]

Please note: the CREATEPUBLICDBLINK and NOCREATEPUBLICDBLINK keywords should be considered deprecated syntax; we recommend using the CREATE PUBLIC DATABASE LINK and NO CREATE PUBLIC DATABASE LINK syntax options.

**DROP PUBLIC DATABASE LINK**

A user who holds the DROP PUBLIC DATABASE LINK privilege may drop a public database link. The following ALTER ROLE command grants privileges to an Advanced Server role that allow the specified role to drop a public database link:

> ALTER ROLE *role*\_*name*
> WITH \[DROPPUBLICDBLINK | DROP PUBLIC DATABASE LINK\]

This command is the functional equivalent of:

> GRANT DROP PUBLIC DATABASE LINK to *role*\_*name*

Use the following command to revoke the privilege:

> ALTER ROLE *role*\_*name*
> WITH \[NODROPPUBLICDBLINK | NO DROP PUBLIC DATABASE LINK\]

Please note: the DROPPUBLICDBLINK and NODROPPUBLICDBLINK keywords should be considered deprecated syntax; we recommend using the DROP PUBLIC DATABASE LINK and NO DROP PUBLIC DATABASE LINK syntax options.

**EXEMPT ACCESS POLICY**

A user who holds the EXEMPT ACCESS POLICY privilege is exempt from fine-grained access control (DBMS\_RLS) policies. A user who holds these privileges will be able to view or modify any row in a table constrained by a DBMS\_RLS policy. The following ALTER ROLE command grants privileges to an Advanced Server role that exempt the specified role from any defined DBMS\_RLS policies:

> ALTER ROLE role\_name
> WITH \[POLICYEXEMPT | EXEMPT ACCESS POLICY\]

This command is the functional equivalent of:

> GRANT EXEMPT ACCESS POLICY TO role\_name

Use the following command to revoke the privilege:

> ALTER ROLE role\_name
> WITH \[NOPOLICYEXEMPT | NO EXEMPT ACCESS POLICY\]

Please note: the POLICYEXEMPT and NOPOLICYEXEMPT keywords should be considered deprecated syntax; we recommend using the EXEMPT ACCESS POLICY and NO EXEMPT ACCESS POLICY syntax options.

**See Also**

[CREATE ROLE](#_CREATE_ROLE), [DROP ROLE](#_DROP_ROLE), [GRANT](#_GRANT), [REVOKE](#_REVOKE), [SET ROLE](#_SET_ROLE)

<span id="_ALTER_SEQUENCE" class="anchor"></span>

### ALTER SEQUENCE

Name

ALTER SEQUENCE  --  change the definition of a sequence generator

Synopsis

ALTER SEQUENCE *name* \[ INCREMENT BY *increment* \]

\[ MINVALUE *minvalue* \] \[ MAXVALUE *maxvalue* \]

\[ CACHE *cache* | NOCACHE \] \[ CYCLE \]

Description

ALTER SEQUENCE changes the parameters of an existing sequence generator. Any parameter not specifically set in the ALTER SEQUENCE command retains its prior setting.

Parameters

*name*

The name (optionally schema-qualified) of a sequence to be altered.

*increment*

The clause INCREMENT BY *increment* is optional. A positive value will make an ascending sequence, a negative one a descending sequence. If unspecified, the old increment value will be maintained.

*minvalue*

The optional clause MINVALUE *minvalue* determines the minimum value a sequence can generate. If not specified, the current minimum value will be maintained. Note that the key words, NO MINVALUE, may be used to set this behavior back to the defaults of 1 and -2<sup>63</sup>-1 for ascending and descending sequences, respectively, however, this term is not Oracle compatible.

*maxvalue*

The optional clause MAXVALUE *maxvalue* determines the maximum value for the sequence. If not specified, the current maximum value will be maintained. Note that the key words, NO MAXVALUE, may be used to set this behavior back to the defaults of 2<sup>63</sup>-1 and -1 for ascending and descending sequences, respectively, however, this term is not Oracle compatible.

*cache*

The optional clause CACHE *cache* specifies how many sequence numbers are to be preallocated and stored in memory for faster access. The minimum value is 1 (only one value can be generated at a time, i.e., NOCACHE). If unspecified, the old cache value will be maintained.

CYCLE

The CYCLE option allows the sequence to wrap around when the *maxvalue* or *minvalue* has been reached by an ascending or descending sequence respectively. If the limit is reached, the next number generated will be the *minvalue* or *maxvalue*, respectively. If not specified, the old cycle behavior will be maintained. Note that the key words, NO CYCLE, may be used to alter the sequence so that it does not recycle, however, this term is not Oracle compatible.

Notes

To avoid blocking of concurrent transactions that obtain numbers from the same sequence, ALTER SEQUENCE is never rolled back; the changes take effect immediately and are not reversible.

ALTER SEQUENCE will not immediately affect NEXTVAL results in backends, other than the current one, that have pre-allocated (cached) sequence values. They will use up all cached values prior to noticing the changed sequence parameters. The current backend will be affected immediately.

Examples

Change the increment and cache value of sequence, serial.

ALTER SEQUENCE serial INCREMENT BY 2 CACHE 5;

**See Also**

[CREATE SEQUENCE](#_Ref176073097), [DROP SEQUENCE](#_DROP_SEQUENCE)

### ALTER SESSION

Name

ALTER SESSION  --  change a runtime parameter

Synopsis

ALTER SESSION SET *name* = *value*

Description

The ALTER SESSION command changes runtime configuration parameters. ALTER SESSION only affects the value used by the current session. Some of these parameters are provided solely for Oracle syntax compatibility and have no effect whatsoever on the runtime behavior of Postgres Plus Advanced Server. Others will alter a corresponding Postgres Plus Advanced Server database server runtime configuration parameter.

Parameters

*name*

Name of a settable runtime parameter. Available parameters are listed below.

*value*

New value of parameter.

Configuration Parameters

The following configuration parameters can be modified using the ALTER SESSION command:

NLS\_DATE\_FORMAT (string)

Sets the display format for date and time values as well as the rules for interpreting ambiguous date input values. Has the same effect as setting the Postgres Plus Advanced Server datestyle runtime configuration parameter.

NLS\_LANGUAGE (string)

Sets the language in which messages are displayed. Has the same effect as setting the Postgres Plus Advanced Server lc\_messages runtime configuration parameter.

NLS\_LENGTH\_SEMANTICS (string)

Valid values are BYTE and CHAR. The default is BYTE. This parameter is provided for syntax compatibility only and has no effect in Postgres Plus Advanced Server.

OPTIMIZER\_MODE (string)

Sets the default optimization mode for queries. Valid values are ALL\_ROWS, CHOOSE, FIRST\_ROWS, FIRST\_ROWS\_10, FIRST\_ROWS\_100, and FIRST\_ROWS\_1000. The default is CHOOSE. This parameter is implemented in Postgres Plus Advanced Server. See [Section 3.4](#_Optimizer_Hints) for more information about optimizer hints.

QUERY\_REWRITE\_ENABLED (string)

Valid values are TRUE, FALSE, and FORCE. The default is FALSE. This parameter is provided for syntax compatibility only and has no effect in Postgres Plus Advanced Server.

QUERY\_REWRITE\_INTEGRITY (string)

Valid values are ENFORCED, TRUSTED, and STALE\_TOLERATED. The default is ENFORCED. This parameter is provided for syntax compatibility only and has no effect in Postgres Plus Advanced Server.

Examples

Set the language to U.S. English in UTF-8 encoding. Note that in this example, the value, en\_US.UTF-8, is in the format that must be specified for Postgres Plus Advanced Server. This form is not Oracle compatible.

ALTER SESSION SET NLS\_LANGUAGE = 'en\_US.UTF-8';

Set the date display format.

ALTER SESSION SET NLS\_DATE\_FORMAT = 'dd/mm/yyyy';

<span id="_ALTER_TABLE" class="anchor"></span>

### ALTER TABLE

Name

ALTER TABLE -- change the definition of a table

Synopsis

ALTER TABLE *name*

*action* \[, ...\]

ALTER TABLE *name*

RENAME COLUMN *column* TO *new\_column*

ALTER TABLE *name*

RENAME TO *new\_name*

where *action* is one of:

ADD *column* *type* \[ *column\_constraint* \[ ... \] \]

DROP COLUMN *column*

ADD *table\_constraint*

DROP CONSTRAINT *constraint\_name* \[ CASCADE \]

Description

ALTER TABLE changes the definition of an existing table. There are several subforms:

ADD *column* *type*

> This form adds a new column to the table using the same syntax as CREATE TABLE.

DROP COLUMN

This form drops a column from a table. Indexes and table constraints involving the column will be automatically dropped as well.

ADD *table\_constraint*

> This form adds a new constraint to a table using the same syntax as CREATE TABLE.

DROP CONSTRAINT

This form drops constraints on a table. Currently, constraints on tables are not required to have unique names, so there may be more than one constraint matching the specified name. All matching constraints will be dropped.

RENAME

The RENAME forms change the name of a table (or an index, sequence, or view) or the name of an individual column in a table. There is no effect on the stored data.

You must own the table to use ALTER TABLE.

Parameters

*name*

The name (possibly schema-qualified) of an existing table to alter.

*column*

Name of a new or existing column.

*new\_column*

New name for an existing column.

*new\_name*

New name for the table.

*type*

Data type of the new column.

*table\_constraint*

New table constraint for the table.

*constraint\_name*

Name of an existing constraint to drop.

CASCADE

Automatically drop objects that depend on the dropped constraint.

Notes

When you invoke ADD COLUMN, all existing rows in the table are initialized with the column’s default value (null if no DEFAULT clause is specified). Adding a column with a non-null default will require the entire table to be rewritten. This may take a significant amount of time for a large table; and it will temporarily require double the disk space. Adding a CHECK or NOT NULL constraint requires scanning the table to verify that existing rows meet the constraint.

The DROP COLUMN form does not physically remove the column, but simply makes it invisible to SQL operations. Subsequent insert and update operations in the table will store a null value for the column. Thus, dropping a column is quick but it will not immediately reduce the on-disk size of your table, as the space occupied by the dropped column is not reclaimed. The space will be reclaimed over time as existing rows are updated.

Changing any part of a system catalog table is not permitted. Refer to [CREATE TABLE](#_CREATE_TABLE) for a further description of valid parameters.

Examples

To add a column of type VARCHAR2 to a table:

ALTER TABLE emp ADD address VARCHAR2(30);

To drop a column from a table:

ALTER TABLE emp DROP COLUMN address;

To rename an existing column:

ALTER TABLE emp RENAME COLUMN address TO city;

To rename an existing table:

ALTER TABLE emp RENAME TO employee;

To add a check constraint to a table:

ALTER TABLE emp ADD CONSTRAINT sal\_chk CHECK (sal \> 500);

To remove a check constraint from a table:

ALTER TABLE emp DROP CONSTRAINT sal\_chk;

**See Also**

[CREATE TABLE](#_CREATE_TABLE), [DROP TABLE](#_DROP_TABLE)

<span id="_ALTER_TABLESPACE" class="anchor"></span>

### ALTER TABLESPACE

Name

ALTER TABLESPACE -- change the definition of a tablespace

Synopsis

ALTER TABLESPACE *name* RENAME TO *newname*

Description

ALTER TABLESPACE changes the definition of a tablespace.

Parameters

*name*

The name of an existing tablespace.

*newname*

The new name of the tablespace. The new name cannot begin with pg\_, as such names are reserved for system tablespaces.

Examples

Rename tablespace empspace to employee\_space:

ALTER TABLESPACE empspace RENAME TO employee\_space;

See Also

[DROP TABLESPACE](#_DROP_TABLESPACE)

<span id="_ALTER_USER" class="anchor"></span>

### ALTER USER

Name

ALTER USER -- change a database user account

Synopsis

ALTER USER *name* IDENTIFIED BY *password*

Description

ALTER USER is used to change the password of a Postgres Plus Advanced Server user account. A database superuser or a user with the CREATEROLE privilege can use this command. Ordinary users can also use this command to change their own password.

Parameters

*name*

The name of the user whose attributes are to be altered.

*password*

The new password to be used for this account.

Examples

Change a user password:

ALTER USER john IDENTIFIED BY xyz;

See Also

[CREATE USER](#_CREATE_USER), [DROP USER](#_DROP_USER)

### CALL

Name

CALL

Synopsis

CALL *procedure\_name* '('\[*argument*\_*list*\]')'

Description

Use the CALL statement to invoke a procedure. To use the CALL statement, you must have EXECUTE privileges on the procedure that the CALL statement is invoking.

Parameters

*procedure\_name*

*procedure\_name* is the (optionally schema-qualified) procedure name.

*argument\_list*

> *argument\_list* specifies a comma-separated list of arguments required by the procedure. Note that each member of *argument\_list* corresponds to a formal argument expected by the procedure. Each formal argument may be an IN parameter, an OUT parameter, or an INOUT parameter.

Examples

The CALL statement may take one of several forms, depending on the arguments required by the procedure:

CALL update\_balance();
CALL update\_balance(1,2,3);

### COMMENT

Name

COMMENT -- define or change the comment of an object

Synopsis

COMMENT ON

{

TABLE *table\_name* |

COLUMN *table\_name*.*column\_name*

} IS '*text*'

Description

COMMENT stores a comment about a database object. To modify a comment, issue a new COMMENT command for the same object. Only one comment string is stored for each object. To remove a comment, specify the empty string (two consecutive single quotes with no intervening space) for *text*. Comments are automatically dropped when the object is dropped.

Parameters

*table\_name*

The name of the table to be commented. The table name may be schema-qualified.

*table\_name*.*column\_name*

The name of a column within *table\_name* to be commented. The table name may be schema-qualified.

*text*

The new comment.

Notes

There is presently no security mechanism for comments: any user connected to a database can see all the comments for objects in that database (although only superusers can change comments for objects that they don’t own). *Do not put security-critical information in comments.*

Examples

Attach a comment to the table emp:

COMMENT ON TABLE emp IS 'Current employee information';

Attach a comment to the empno column of the emp table:

COMMENT ON COLUMN emp.empno IS 'Employee identification number';

Remove these comments:

COMMENT ON TABLE emp IS '';

COMMENT ON COLUMN emp.empno IS '';

<span id="_Ref177374273" class="anchor"></span>

### COMMIT

Name

COMMIT -- commit the current transaction

Synopsis

COMMIT \[ WORK \]

Description

COMMIT commits the current transaction. All changes made by the transaction become visible to others and are guaranteed to be durable if a crash occurs.

Parameters

WORK

Optional key word - has no effect.

Notes

Use ROLLBACK to abort a transaction. Issuing COMMIT when not inside a transaction does no harm.

Examples

To commit the current transaction and make all changes permanent:

COMMIT;

**See Also**

[ROLLBACK](#_Ref177374233), [ROLLBACK TO SAVEPOINT](#_Ref177375870)

### CREATE DATABASE

Name

CREATE DATABASE -- create a new database

Synopsis

CREATE DATABASE *name*

Description

CREATE DATABASE creates a new database.

To create a database, you must be a superuser or have the special CREATEDB privilege. Normally, the creator becomes the owner of the new database. Non-superusers with CREATEDB privilege can only create databases owned by them.

The new database will be created by cloning the standard system database template1.

Parameters

*name*

The name of the database to be created.

Notes

CREATE DATABASE cannot be executed inside a transaction block.

Errors along the line of “could not initialize database directory” are most likely related to insufficient permissions on the data directory, a full disk, or other file system problems.

Examples

To create a new database:

CREATE DATABASE employees;

<span id="_Ref183414058" class="anchor"></span>

### CREATE \[PUBLIC\] DATABASE LINK

Name

CREATE \[PUBLIC\] DATABASE LINK -- create a new database link.

Synopsis

CREATE \[ PUBLIC \] DATABASE LINK *name*

CONNECT TO { CURRENT\_USER |

*username* IDENTIFIED BY ‘*password*’}

USING { libpq *'libpq*\_*connection*\_*string'* |

\[ oci \] *'oracle*\_*connection*\_*string'* }

Description

CREATE DATABASE LINK creates a new database link. A database link is an object that allows a reference to a table or view in a remote database within a DELETE, INSERT, SELECT or UPDATE command. A database link is referenced by appending @*dblink* to the table or view name referenced in the SQL command where *dblink* is the name of the database link.

Database links can be public or private. A *public database link* is one that can be used by any user. A *private database link* can be used only by the database link’s owner. Specification of the PUBLIC option creates a public database link. If omitted, a private database link is created.

When the CREATE DATABASE LINK command is given, the database link name and the given connection attributes are stored in the Postgres Plus Advanced Server system table named, pg\_catalog.edb\_dblink. When using a given database link, the database containing the edb\_dblink entry defining this database link is called the *local database*. The server and database whose connection attributes are defined within the edb\_dblink entry is called the *remote database*.

A SQL command containing a reference to a database link must be issued while connected to the local database. When the SQL command is executed, the appropriate authentication and connection is made to the remote database to access the table or view to which the @*dblink* reference is appended.

For Advanced Server 9.4, the CREATE DATABASE LINK command is tested against and certified for use with Oracle version 10g Release 2 (10.2) and Oracle version 11g Release 2 (11.2).

Parameters

PUBLIC

Create a public database link that can be used by any user. If omitted, then the database link is private and can only be used by the database link’s owner.

*name*

The name of the database link.

*username*

The username to be used for connecting to the remote database.

CURRENT\_USER

> Include CURRENT\_USER to specify that Advanced Server should use the user mapping associated with the role that is using the link when establishing a connection to the remote server.

*password*

The password for *username*.

libpq

Specifies a libpq connection to a remote Postgres Plus Advanced Server database.

*libpq*\_*connection*\_*string*

> Specify the connection information for a libpq connection.

oci

Specifies a connection to a remote Oracle database. This is Advanced Server’s default behavior.

*oracle\_connection\_string*

Specify the connection information for an oci connection.

Notes

To create a non-public database link you must have the CREATE DATABASE LINK privilege. To create a public database link you must have the CREATE PUBLIC DATABASE LINK privilege.

If you are executing a SQL command that references a database link to a remote Oracle database, Advanced Server needs a way to know where the correct Oracle installation resides on disk. Set the LD\_LIBRARY\_PATH environment variable on Linux (or PATH on Windows) to the lib directory of the Oracle client installation directory.

For Windows only, you can instead set the value of the oracle\_home configuration parameter in the postgresql.conf file. The value specified in the oracle\_home configuration parameter will override the Windows PATH environment variable.

The LD\_LIBRARY\_PATH environment variable on Linux (PATH environment variable or oracle\_home configuration parameter on Windows) must be set properly each time you start Advanced Server.

**For Windows only:** To set the oracle\_home configuration parameter in the postgresql.conf file, edit the file, adding the following line:

> oracle\_home = '*lib\_directory* '

Substitute the name of the Windows directory that contains oci.dll for *lib\_directory*.

After setting the oracle\_home configuration parameter, you must restart the server for the changes to take effect. Restart the server from the Windows Services console.

Examples

***Creating an oci-dblink Database Link***

The following example demonstrates using the CREATE DATABASE LINK command to create a database link (named chicago) that connects an instance of Advanced Server to an Oracle server via an oci-dblink connection. The connection information tells Advanced Server to log in to Oracle as user admin, whose password is mypassword. Including the oci option tells Advanced Server that this is an oci-dblink connection; the connection string, '//127.0.0.1/acctg' specifies the server address and name of the database.

> CREATE DATABASE LINK chicago
>
> CONNECT TO admin IDENTIFIED BY 'mypassword'
>
> USING oci '//127.0.0.1/acctg';

Note: You can specify a hostname in the connection string (in place of an IP address).

***Creating a libpq Database Link***

The following example demonstrates using the CREATE DATABASE LINK command to create a database link (named boston) that connects an instance of Advanced Server to a Postgres Server via a libpq connection. The connection information tells Advanced Server to log in to Postgres as user admin, whose password is mypassword. Including the libpq option tells Advanced Server that this is a libpq connection; the connection string, 'host=127.0.0.1 dbname=sales' specifies the server address and name of the database.

> CREATE DATABASE LINK boston
>
> CONNECT TO admin IDENTIFIED BY 'mypassword'
>
> USING libpq 'host=127.0.0.1 dbname=sales';

Note: You can specify a hostname in the connection string (in place of an IP address).

***Using a Database Link***

The following examples demonstrate using a database link with Advanced Server to connect to an Oracle database. The examples assume that a copy of the Postgres Plus Advanced Server sample application’s emp table has been created in an Oracle database and a second Postgres Plus Advanced Server database cluster with the sample application is accepting connections at port 5443.

Create a public database link named, oralink, to an Oracle database named, xe, located at 127.0.0.1 on port 1521. Connect to the Oracle database with username, edb, and password, password.

CREATE PUBLIC DATABASE LINK oralink CONNECT TO edb IDENTIFIED BY 'password' USING '//127.0.0.1:1521/xe';

Issue a SELECT command on the emp table in the Oracle database using database link, oralink.

SELECT \* FROM emp@oralink;

empno | ename | job | mgr | hiredate | sal | comm | deptno

\-------+--------+-----------+------+--------------------+------+------+--------

7369 | SMITH | CLERK | 7902 | 17-DEC-80 00:00:00 | 800 | | 20

7499 | ALLEN | SALESMAN | 7698 | 20-FEB-81 00:00:00 | 1600 | 300 | 30

7521 | WARD | SALESMAN | 7698 | 22-FEB-81 00:00:00 | 1250 | 500 | 30

7566 | JONES | MANAGER | 7839 | 02-APR-81 00:00:00 | 2975 | | 20

7654 | MARTIN | SALESMAN | 7698 | 28-SEP-81 00:00:00 | 1250 | 1400 | 30

7698 | BLAKE | MANAGER | 7839 | 01-MAY-81 00:00:00 | 2850 | | 30

7782 | CLARK | MANAGER | 7839 | 09-JUN-81 00:00:00 | 2450 | | 10

7788 | SCOTT | ANALYST | 7566 | 19-APR-87 00:00:00 | 3000 | | 20

7839 | KING | PRESIDENT | | 17-NOV-81 00:00:00 | 5000 | | 10

7844 | TURNER | SALESMAN | 7698 | 08-SEP-81 00:00:00 | 1500 | 0 | 30

7876 | ADAMS | CLERK | 7788 | 23-MAY-87 00:00:00 | 1100 | | 20

7900 | JAMES | CLERK | 7698 | 03-DEC-81 00:00:00 | 950 | | 30

7902 | FORD | ANALYST | 7566 | 03-DEC-81 00:00:00 | 3000 | | 20

7934 | MILLER | CLERK | 7782 | 23-JAN-82 00:00:00 | 1300 | | 10

(14 rows)

Create a private database link named, edblink, to a Postgres Plus Advanced Server database named, edb, located on localhost, running on port 5443. Connect to the Postgres Plus Advanced Server database with username, enterprisedb, and password, password.

CREATE DATABASE LINK edblink CONNECT TO enterprisedb IDENTIFIED BY 'password' USING libpq 'host=localhost port=5443 dbname=edb';

Display attributes of database links, oralink and edblink, from the local edb\_dblink system table:

SELECT lnkname, lnkuser, lnkconnstr FROM pg\_catalog.edb\_dblink;

lnkname | lnkuser | lnkconnstr

\---------+--------------+-------------------------------------

oralink | edb | //127.0.0.1:1521/xe

edblink | enterprisedb | host=localhost port=5443 dbname=edb

(2 rows)

Perform a join of the emp table from the Oracle database with the dept table from the Postgres Plus Advanced Server database:

SELECT d.deptno, d.dname, e.empno, e.ename, e.job, e.sal, e.comm FROM emp@oralink e, dept@edblink d WHERE e.deptno = d.deptno ORDER BY 1, 3;

deptno | dname | empno | ename | job | sal | comm

\--------+------------+-------+--------+-----------+------+------

10 | ACCOUNTING | 7782 | CLARK | MANAGER | 2450 |

10 | ACCOUNTING | 7839 | KING | PRESIDENT | 5000 |

10 | ACCOUNTING | 7934 | MILLER | CLERK | 1300 |

20 | RESEARCH | 7369 | SMITH | CLERK | 800 |

20 | RESEARCH | 7566 | JONES | MANAGER | 2975 |

20 | RESEARCH | 7788 | SCOTT | ANALYST | 3000 |

20 | RESEARCH | 7876 | ADAMS | CLERK | 1100 |

20 | RESEARCH | 7902 | FORD | ANALYST | 3000 |

30 | SALES | 7499 | ALLEN | SALESMAN | 1600 | 300

30 | SALES | 7521 | WARD | SALESMAN | 1250 | 500

30 | SALES | 7654 | MARTIN | SALESMAN | 1250 | 1400

30 | SALES | 7698 | BLAKE | MANAGER | 2850 |

30 | SALES | 7844 | TURNER | SALESMAN | 1500 | 0

30 | SALES | 7900 | JAMES | CLERK | 950 |

(14 rows)

See Also

[DROP DATABASE LINK](\\l)

<span id="_CREATE_DIRECTORY" class="anchor"></span>

### CREATE DIRECTORY

Name

CREATE DIRECTORY -- create an alias for a file system directory path

Synopsis

CREATE DIRECTORY *name* AS '*pathname*'

Description

The CREATE DIRECTORY command creates an alias for a file system directory pathname. You must be a database superuser to use this command.

When the alias is specified as the appropriate parameter to the programs of the UTL\_FILE package, the operating system files are created in, or accessed from the directory corresponding to the given alias. See [Section 7.16](#utl_file) for information about the UTL\_FILE package.

Parameters

*name*

The directory alias name.

*pathname*

The fully-qualified directory path represented by the alias name. The CREATE DIRECTORY command does not create the operating system directory. The physical directory must be created independently using the appropriate operating system commands.

Notes

The operating system user id, enterprisedb, must have the appropriate read and/or write privileges on the directory if the UTL\_FILE package is to be used to create and/or read files using the directory.

The directory alias is stored in the pg\_catalog.edb\_dir system catalog table. Note that edb\_dir is not an Oracle compatible table.

Use the DROP DIRECTORY command to delete the directory alias. When a directory alias is deleted, the corresponding physical file system directory is not affected. The file system directory must be deleted using the appropriate operating system commands.

In a Linux system, the directory name separator is a forward slash (/).

In a Windows system, the directory name separator can be specified as a forward slash (/) or two consecutive backslashes (\\\\).

Examples

Create an alias named empdir for directory /tmp/empdir on Linux:

CREATE DIRECTORY empdir AS '/tmp/empdir';

Create an alias named empdir for directory C:\\TEMP\\EMPDIR on Windows:

CREATE DIRECTORY empdir AS 'C:/TEMP/EMPDIR';

View all of the directory aliases:

SELECT \* FROM pg\_catalog.edb\_dir;

dirname | dirpath

\---------+----------------

empdir | C:/TEMP/EMPDIR

(1 row)

See Also

[DROP DIRECTORY](#_Ref178410995)

<span id="_CREATE_FUNCTION" class="anchor"></span>

### CREATE FUNCTION

Name

CREATE FUNCTION -- define a new function

Synopsis

CREATE \[ OR REPLACE \] FUNCTION *name*

\[ (*argname* \[ IN | IN OUT | OUT \] *argtype* \[ DEFAULT *value* \]

\[, ...\]) \]

RETURN *rettype* \[DETERMINISTIC\]

\[ AUTHID { DEFINER | CURRENT\_USER } \]

{ IS | AS }

\[ *declaration*; \] \[, ...\]

BEGIN

*statement*; \[...\]

\[ EXCEPTION

{ WHEN *exception* \[ OR *exception* \] \[...\] THEN

*statement*; \[, ...\] } \[, ...\]

\]

END \[ *name* \]

Description

CREATE FUNCTION defines a new function. CREATE OR REPLACE FUNCTION will either create a new function, or replace an existing definition.

If a schema name is included, then the function is created in the specified schema. Otherwise it is created in the current schema. The name of the new function must not match any existing function with the same argument types in the same schema. However, functions of different input argument types may share a name (this is called overloading). (Overloading of functions is a Postgres Plus Advanced Server feature - overloading of stored functions is not Oracle compatible.)

To update the definition of an existing function, use CREATE OR REPLACE FUNCTION. It is not possible to change the name or argument types of a function this way (if you tried, you would actually be creating a new, distinct function). Also, CREATE OR REPLACE FUNCTION will not let you change the return type of an existing function. To do that, you must drop and recreate the function.

The user that creates the function becomes the owner of the function.

See Section <span class="underline"></span>4.2.4 for more information on functions.

Parameters

*name*

The name (optionally schema-qualified) of the function to create.

*argname*

The name of an argument. The argument is referenced by this name within the function body.

IN | IN OUT | OUT

The argument mode. IN declares the argument for input only. This is the default. IN OUT allows the argument to receive a value as well as return a value. OUT specifies the argument is for output only.

*argtype*

The data type(s) of the function’s arguments. The argument types may be a base data type, a copy of the type of an existing column using %TYPE, or a user-defined type such as a nested table or an object type. A length must not be specified for any base type – for example, specify VARCHAR2, not VARCHAR2(10).

The type of a column is referenced by writing *tablename*.*columnname*%TYPE; using this can sometimes help make a function independent from changes to the definition of a table.

DEFAULT *value*

Supplies a default value for an input argument if one is not supplied in the function call. DEFAULT may not be specified for arguments with modes IN OUT or OUT.

*rettype*

The return data type, which may be any of the types listed for *argtype*. As for *argtype*, a length must not be specified for *rettype*.

DETERMINISTIC

Include DETERMINISTIC to specify that the function will always return the same result when given the same argument values. A DETERMINISTIC function must not modify the database.

Note: the DETERMINISTIC keyword is equivalent to the PostgreSQL IMMUTABLE option.

DEFINER | CURRENT\_USER

Specifies whether the privileges of the function owner (DEFINER) or the privileges of the current user executing the function (CURRENT\_USER) are to be used to determine whether or not access is allowed to database objects referenced in the function. DEFINER is the default.

*declaration*

A variable, type, or REF CURSOR declaration.

*statement*

An SPL program statement. Note that a DECLARE - BEGIN - END block is considered an SPL statement unto itself. Thus, the function body may contain nested blocks.

*exception*

An exception condition name such as NO\_DATA\_FOUND, OTHERS, etc.

Notes

Postgres Plus Advanced Server allows function overloading; that is, the same name can be used for several different functions so long as they have distinct input (IN, IN OUT) argument data types.

Examples

The function emp\_comp takes two numbers as input and returns a computed value. The SELECT command illustrates use of the function.

CREATE OR REPLACE FUNCTION emp\_comp (

p\_sal NUMBER,

p\_comm NUMBER

) RETURN NUMBER

IS

BEGIN

RETURN (p\_sal + NVL(p\_comm, 0)) \* 24;

END;

SELECT ename "Name", sal "Salary", comm "Commission", emp\_comp(sal, comm)

"Total Compensation" FROM emp;

Name | Salary | Commission | Total Compensation

\--------+---------+------------+--------------------

SMITH | 800.00 | | 19200.00

ALLEN | 1600.00 | 300.00 | 45600.00

WARD | 1250.00 | 500.00 | 42000.00

JONES | 2975.00 | | 71400.00

MARTIN | 1250.00 | 1400.00 | 63600.00

BLAKE | 2850.00 | | 68400.00

CLARK | 2450.00 | | 58800.00

SCOTT | 3000.00 | | 72000.00

KING | 5000.00 | | 120000.00

TURNER | 1500.00 | 0.00 | 36000.00

ADAMS | 1100.00 | | 26400.00

JAMES | 950.00 | | 22800.00

FORD | 3000.00 | | 72000.00

MILLER | 1300.00 | | 31200.00

(14 rows)

Function sal\_range returns a count of the number of employees whose salary falls in the specified range. The following anonymous block calls the function a number of times using the arguments’ default values for the first two calls.

CREATE OR REPLACE FUNCTION sal\_range (

p\_sal\_min NUMBER DEFAULT 0,

p\_sal\_max NUMBER DEFAULT 10000

) RETURN INTEGER

IS

v\_count INTEGER;

BEGIN

SELECT COUNT(\*) INTO v\_count FROM emp

WHERE sal BETWEEN p\_sal\_min AND p\_sal\_max;

RETURN v\_count;

END;

BEGIN

DBMS\_OUTPUT.PUT\_LINE('Number of employees with a salary: ' ||

sal\_range);

DBMS\_OUTPUT.PUT\_LINE('Number of employees with a salary of at least '

|| '$2000.00: ' || sal\_range(2000.00));

DBMS\_OUTPUT.PUT\_LINE('Number of employees with a salary between '

|| '$2000.00 and $3000.00: ' || sal\_range(2000.00, 3000.00));

END;

Number of employees with a salary: 14

Number of employees with a salary of at least $2000.00: 6

Number of employees with a salary between $2000.00 and $3000.00: 5

**Pragmas**

PRAGMA RESTRICT\_REFERENCE

> Advanced Server accepts but ignores syntax referencing pragma restrict\_reference.

**See Also** [DROP FUNCTION](#_DROP_FUNCTION)

<span id="_CREATE_INDEX" class="anchor"></span>

### CREATE INDEX

Name

CREATE INDEX -- define a new index

Synopsis

CREATE \[ UNIQUE \] INDEX *name* ON *table*

( { *column* | ( *expression* ) } )

\[ TABLESPACE *tablespace* \]

Description

CREATE INDEX constructs an index, *name*, on the specified table. Indexes are primarily used to enhance database performance (though inappropriate use will result in slower performance).

The key field(s) for the index are specified as column names, or alternatively as expressions written in parentheses. Multiple fields can be specified to create multicolumn indexes.

An index field can be an expression computed from the values of one or more columns of the table row. This feature can be used to obtain fast access to data based on some transformation of the basic data. For example, an index computed on UPPER(col) would allow the clause WHERE UPPER(col) = 'JIM' to use an index.

Postgres Plus Advanced Server provides the B-tree index method. The B-tree index method is an implementation of Lehman-Yao high-concurrency B-trees.

Indexes are not used for IS NULL clauses by default.

All functions and operators used in an index definition must be "immutable", that is, their results must depend only on their arguments and never on any outside influence (such as the contents of another table or the current time). This restriction ensures that the behavior of the index is well-defined. To use a user-defined function in an index expression remember to mark the function immutable when you create it.

If you are create an index on a partitioned table, the CREATE INDEX command does not propagate indexes to the table's subpartitions.

Parameters

UNIQUE

Causes the system to check for duplicate values in the table when the index is created (if data already exist) and each time data is added. Attempts to insert or update data which would result in duplicate entries will generate an error.

*name*

The name of the index to be created. No schema name can be included here; the index is always created in the same schema as its parent table.

*table*

The name (possibly schema-qualified) of the table to be indexed.

*column*

The name of a column in the table.

*expression*

An expression based on one or more columns of the table. The expression usually must be written with surrounding parentheses, as shown in the syntax. However, the parentheses may be omitted if the expression has the form of a function call.

*tablespace*

The tablespace in which to create the index. If not specified, default\_tablespace is used, or the database’s default tablespace if default\_tablespace is an empty string.

Notes

Up to 32 fields may be specified in a multicolumn index.

Examples

To create a B-tree index on the column, ename, in the table, emp:

CREATE INDEX name\_idx ON emp (ename);

To create the same index as above, but have it reside in the index\_tblspc tablespace:

CREATE INDEX name\_idx ON emp (ename) TABLESPACE index\_tblspc;

**See Also**

[DROP INDEX](#_Ref178500676), [ALTER INDEX](#_Ref178500664)

### CREATE MATERIALIZED VIEW

Name

CREATE MATERIALIZED VIEW -- define a new materialized view

Synopsis

CREATE MATERIALIZED VIEW *name*
\[*build*\_*clause*\]\[*create*\_*mv*\_*refresh*\] AS subquery

> Where *build*\_*clause* is:
>
> BUILD {IMMEDIATE | DEFERRED}
>
> Where *create*\_*mv*\_*refresh* is:
>
> REFRESH \[COMPLETE\] \[ON DEMAND\]

Description

CREATE MATERIALIZED VIEW defines a view of a query that is not updated each time the view is referenced in a query. By default, the view is populated when the view is created; you can include the BUILD DEFERRED keywords to delay the population of the view.

A materialized view may be schema-qualified; if you specify a schema name when invoking the CREATE MATERIALIZED VIEW command, the view will be created in the specified schema. The view name must be distinct from the name of any other view, table, sequence, or index in the same schema.

Parameters

*name*

The name (optionally schema-qualified) of a view to be created.

*subquery*

A SELECT statement that specifies the contents of the view. Refer to SELECT for more information about valid queries.

*build\_clause*

Include a *build\_clause* to specify when the view should be populated. Specify BUILD IMMEDIATE, or BUILD DEFERRED:
 - BUILD IMMEDIATE instructs the server to populate the view immediately. This is the default behavior.
 - BUILD DEFERRED instructs the server to populate the view at a later time (during a REFRESH operation).

*create\_mv\_refresh*

Include the *create\_mv\_refresh* clause to specify when the contents of a materialized view should be updated. The clause contains the REFRESH keyword followed by COMPLETE and/or ON DEMAND, where:
 - COMPLETE instructs the server to discard the current content and reload the materialized view by executing the view's defining query when the materialized view is refreshed.
 - ON DEMAND instructs the server to refresh the materialized view on demand by calling the DBMS\_MVIEW package or by calling the Postgres REFRESH MATERIALIZED VIEW statement. This is the default behavior.

Notes

Materialized views are read only - the server will not allow an INSERT, UPDATE, or DELETE on a view.

Access to tables referenced in the view is determined by permissions of the view owner; the user of a view must have permissions to call all functions used by the view.

For more information about using the DBMS\_MVIEW package to refresh a materialized view, please see [Section 7.6](#dbms_mview).

For more information about the Postgres REFRESH MATERIALIZED VIEW command, please see the PostgreSQL Core Documentation, available at:

<http://www.enterprisedb.com/docs/en/9.4/pg/sql-refreshmaterializedview.html>

Examples

The following statement creates a materialized view named dept\_30:

CREATE MATERIALIZED VIEW dept\_30 BUILD IMMEDIATE AS SELECT \* FROM emp WHERE deptno = 30;

The view contains information retrieved from the emp table about any employee that works in department 30.

<span id="_CREATE_PACKAGE" class="anchor"></span>

### CREATE PACKAGE

Name

CREATE PACKAGE -- define a new package specification

Synopsis

CREATE \[ OR REPLACE \] PACKAGE *name*

\[ AUTHID { DEFINER | CURRENT\_USER } \]

{ IS | AS }

\[ *declaration*; \] \[, ...\]

\[ { PROCEDURE *proc\_name*

\[ (*argname* \[ IN | IN OUT | OUT \] *argtype* \[ DEFAULT *value* \]

\[, ...\]) \];

|

FUNCTION *func\_name*

\[ (*argname* \[ IN | IN OUT | OUT \] *argtype* \[ DEFAULT *value* \]

\[, ...\]) \]

RETURN *rettype*;

}

\] \[, ...\]

END \[ *name* \]

Description

CREATE PACKAGE defines a new package specification. CREATE OR REPLACE PACKAGE will either create a new package specification, or replace an existing specification.

If a schema name is included, then the package is created in the specified schema. Otherwise it is created in the current schema. The name of the new package must not match any existing package in the same schema unless the intent is to update the definition of an existing package, in which case use CREATE OR REPLACE PACKAGE.

The user that creates the procedure becomes the owner of the package.

See Section <span class="underline">6</span> for more information about packages.

Parameters

*name*

The name (optionally schema-qualified) of the package to create.

DEFINER | CURRENT\_USER

Specifies whether the privileges of the package owner (DEFINER) or the privileges of the current user executing a program in the package (CURRENT\_USER) are to be used to determine whether or not access is allowed to database objects referenced in the package. DEFINER is the default.

*declaration*

A public variable, type, cursor, or REF CURSOR declaration.

*proc\_name*

The name of a public procedure.

*argname*

The name of an argument.

IN | IN OUT | OUT

The argument mode.

*argtype*

The data type(s) of the program’s arguments.

DEFAULT *value*

Default value of an input argument.

*func\_name*

The name of a public function.

*rettype*

The return data type.

Examples

The package specification, empinfo, contains three public components - a public variable, a public procedure, and a public function. See the CREATE PACKAGE BODY command for the package body for this example.

CREATE OR REPLACE PACKAGE empinfo

IS

emp\_name VARCHAR2(10);

PROCEDURE get\_name (

p\_empno NUMBER

);

FUNCTION display\_counter

RETURN INTEGER;

END;

**See Also**

[DROP PACKAGE](#_DROP_PACKAGE)

<span id="_CREATE_PACKAGE_BODY" class="anchor"></span>

### CREATE PACKAGE BODY

Name

CREATE BODY PACKAGE -- define a new package body

Synopsis

CREATE \[ OR REPLACE \] PACKAGE BODY *name*

{ IS | AS }

\[ *declaration*; \] \[, ...\]

\[ { PROCEDURE *proc\_name*

\[ (*argname* \[ IN | IN OUT | OUT \] *argtype* \[ DEFAULT *value* \]

\[, ...\]) \]

{ IS | AS }

*program\_body*

END \[ *proc\_name* \];

|

FUNCTION *func\_name*

\[ (*argname* \[ IN | IN OUT | OUT \] *argtype* \[ DEFAULT *value* \]

\[, ...\]) \]

RETURN *rettype*

{ IS | AS }

*program\_body*

END \[ *func\_name* \];

}

\] \[, ...\]

\[ BEGIN

*statement*; \[, ...\] \]

END \[ *name* \]

Description

CREATE PACKAGE BODY defines a new package body. CREATE OR REPLACE PACKAGE BODY will either create a new package body, or replace an existing body.

If a schema name is included, then the package body is created in the specified schema. Otherwise it is created in the current schema. The name of the new package body must match an existing package specification in the same schema. The new package body name must not match any existing package body in the same schema unless the intent is to update the definition of an existing package body, in which case use CREATE OR REPLACE PACKAGE BODY.

See Sections <span class="underline">6.1.2</span> and <span class="underline">6.2.2</span> for more information on the package body.

Parameters

*name*

The name (optionally schema-qualified) of the package body to create.

*declaration*

A private variable, type, cursor, or REF CURSOR declaration.

*proc\_name*

The name of a public or private procedure. If *proc\_name* exists in the package specification with an identical signature, then it is public, otherwise it is private.

*argname*

The name of an argument.

IN | IN OUT | OUT

The argument mode.

*argtype*

The data type(s) of the program’s arguments.

DEFAULT *value*

Default value of an input argument.

*program\_body*

The declarations and SPL statements that comprise the body of the function or procedure.

*func\_name*

The name of a public or private function. If *func\_name* exists in the package specification with an identical signature, then it is public, otherwise it is private.

*rettype*

The return data type.

*statement*

An SPL program statement. Statements in the package initialization section are executed once per session the first time the package is referenced.

Examples

The following is the package body for the empinfo package.

CREATE OR REPLACE PACKAGE BODY empinfo

IS

v\_counter INTEGER;

PROCEDURE get\_name (

p\_empno NUMBER

)

IS

BEGIN

SELECT ename INTO emp\_name FROM emp WHERE empno = p\_empno;

v\_counter := v\_counter + 1;

END;

FUNCTION display\_counter

RETURN INTEGER

IS

BEGIN

RETURN v\_counter;

END;

BEGIN

v\_counter := 0;

DBMS\_OUTPUT.PUT\_LINE('Initialized counter');

END;

The following two anonymous blocks execute the procedure and function in the empinfo package and display the public variable.

BEGIN

empinfo.get\_name(7369);

DBMS\_OUTPUT.PUT\_LINE('Employee Name : ' || empinfo.emp\_name);

DBMS\_OUTPUT.PUT\_LINE('Number of queries: ' || empinfo.display\_counter);

END;

Initialized counter

Employee Name : SMITH

Number of queries: 1

BEGIN

empinfo.get\_name(7900);

DBMS\_OUTPUT.PUT\_LINE('Employee Name : ' || empinfo.emp\_name);

DBMS\_OUTPUT.PUT\_LINE('Number of queries: ' || empinfo.display\_counter);

END;

Employee Name : JAMES

Number of queries: 2

See Also

[CREATE PACKAGE](#_CREATE_PACKAGE), [DROP PACKAGE](#_DROP_PACKAGE)

<span id="_CREATE_PROCEDURE" class="anchor"></span>

### CREATE PROCEDURE

Name

CREATE PROCEDURE -- define a new stored procedure

Synopsis

CREATE \[ OR REPLACE \] PROCEDURE *name*

\[ (*argname* \[ IN | IN OUT | OUT \] *argtype* \[ DEFAULT *value* \]

\[, ...\]) \]

\[ AUTHID { DEFINER | CURRENT\_USER } \]

{ IS | AS }

\[ *declaration*; \] \[, ...\]

BEGIN

*statement*; \[...\]

\[ EXCEPTION

{ WHEN *exception* \[ OR *exception* \] \[...\] THEN

*statement*; \[, ...\] } \[, ...\]

\]

END \[ *name* \]

Description

CREATE PROCEDURE defines a new stored procedure. CREATE OR REPLACE PROCEDURE will either create a new procedure, or replace an existing definition.

If a schema name is included, then the procedure is created in the specified schema. Otherwise it is created in the current schema. The name of the new procedure must not match any existing procedure in the same schema unless the intent is to update the definition of an existing procedure, in which case use CREATE OR REPLACE PROCEDURE.

The user that creates the procedure becomes the owner of the procedure.

See Section <span class="underline"></span>4.2.3 for more information on procedures.

Parameters

*name*

The name (optionally schema-qualified) of the procedure to create.

*argname*

The name of an argument. The argument is referenced by this name within the procedure body.

IN | IN OUT | OUT

The argument mode. IN declares the argument for input only. This is the default. IN OUT allows the argument to receive a value as well as return a value. OUT specifies the argument is for output only.

*argtype*

The data type(s) of the procedure’s arguments. The argument types may be a base data type, a copy of the type of an existing column using %TYPE, or a user-defined type such as a nested table or an object type. A length must not be specified for any base type - for example, specify VARCHAR2, not VARCHAR2(10).

The type of a column is referenced by writing *tablename*.*columnname*%TYPE; using this can sometimes help make a procedure independent from changes to the definition of a table.

DEFAULT *value*

Supplies a default value for an input argument if one is not supplied in the procedure call. DEFAULT may not be specified for arguments with modes IN OUT or OUT.

DEFINER | CURRENT\_USER

Specifies whether the privileges of the procedure owner (DEFINER) or the privileges of the current user executing the procedure (CURRENT\_USER) are to be used to determine whether or not access is allowed to database objects referenced in the procedure. DEFINER is the default.

*declaration*

A variable, type, or REF CURSOR declaration.

*statement*

An SPL program statement. Note that a DECLARE - BEGIN - END block is considered an SPL statement unto itself. Thus, the function body may contain nested blocks.

*exception*

An exception condition name such as NO\_DATA\_FOUND, OTHERS, etc.

Examples

The following procedure lists the employees in the emp table:

CREATE OR REPLACE PROCEDURE list\_emp

IS

v\_empno NUMBER(4);

v\_ename VARCHAR2(10);

CURSOR emp\_cur IS

SELECT empno, ename FROM emp ORDER BY empno;

BEGIN

OPEN emp\_cur;

DBMS\_OUTPUT.PUT\_LINE('EMPNO ENAME');

DBMS\_OUTPUT.PUT\_LINE('----- -------');

LOOP

FETCH emp\_cur INTO v\_empno, v\_ename;

EXIT WHEN emp\_cur%NOTFOUND;

DBMS\_OUTPUT.PUT\_LINE(v\_empno || ' ' || v\_ename);

END LOOP;

CLOSE emp\_cur;

END;

EXEC list\_emp;

EMPNO ENAME

\----- -------

7369 SMITH

7499 ALLEN

7521 WARD

7566 JONES

7654 MARTIN

7698 BLAKE

7782 CLARK

7788 SCOTT

7839 KING

7844 TURNER

7876 ADAMS

7900 JAMES

7902 FORD

7934 MILLER

The following procedure uses IN OUT and OUT arguments to return an employee’s number, name, and job based upon a search using first, the given employee number, and if that is not found, then using the given name. An anonymous block calls the procedure.

CREATE OR REPLACE PROCEDURE emp\_job (

p\_empno IN OUT emp.empno%TYPE,

p\_ename IN OUT emp.ename%TYPE,

p\_job OUT emp.job%TYPE

)

IS

v\_empno emp.empno%TYPE;

v\_ename emp.ename%TYPE;

v\_job emp.job%TYPE;

BEGIN

SELECT ename, job INTO v\_ename, v\_job FROM emp WHERE empno = p\_empno;

p\_ename := v\_ename;

p\_job := v\_job;

DBMS\_OUTPUT.PUT\_LINE('Found employee \# ' || p\_empno);

EXCEPTION

WHEN NO\_DATA\_FOUND THEN

BEGIN

SELECT empno, job INTO v\_empno, v\_job FROM emp

WHERE ename = p\_ename;

p\_empno := v\_empno;

p\_job := v\_job;

DBMS\_OUTPUT.PUT\_LINE('Found employee ' || p\_ename);

EXCEPTION

WHEN NO\_DATA\_FOUND THEN

DBMS\_OUTPUT.PUT\_LINE('Could not find an employee with ' ||

'number, ' || p\_empno || ' nor name, ' || p\_ename);

p\_empno := NULL;

p\_ename := NULL;

p\_job := NULL;

END;

END;

DECLARE

v\_empno emp.empno%TYPE;

v\_ename emp.ename%TYPE;

v\_job emp.job%TYPE;

BEGIN

v\_empno := 0;

v\_ename := 'CLARK';

emp\_job(v\_empno, v\_ename, v\_job);

DBMS\_OUTPUT.PUT\_LINE('Employee No: ' || v\_empno);

DBMS\_OUTPUT.PUT\_LINE('Name : ' || v\_ename);

DBMS\_OUTPUT.PUT\_LINE('Job : ' || v\_job);

END;

Found employee CLARK

Employee No: 7782

Name : CLARK

Job : MANAGER

**See Also**

[DROP PROCEDURE](#_Ref178475597)

<span id="_CREATE_ROLE" class="anchor"></span>

### CREATE ROLE

Name

CREATE ROLE -- define a new database role

Synopsis

CREATE ROLE *name* \[ IDENTIFIED BY *password* \]

Description

CREATE ROLE adds a new role to a Postgres Plus Advanced Server database cluster. A role is an entity that can own database objects and have database privileges; a role can be considered a “user”, a “group”, or both depending on how it is used. The newly created role does not have the LOGIN attribute, so it cannot be used to start a session. Use the ALTER ROLE command to give the role LOGIN rights. You must have CREATEROLE privilege or be a database superuser to use the CREATE ROLE command.

If the IDENTIFIED BY clause is specified, the CREATE ROLE command also creates a schema owned by, and with the same name as the newly created role.

Note that roles are defined at the database cluster level, and so are valid in all databases in the cluster.

Parameters

*name*

The name of the new role.

IDENTIFIED BY *password*

Sets the role’s password. (A password is only of use for roles having the LOGIN attribute, but you can nonetheless define one for roles without it.) If you do not plan to use password authentication you can omit this option.

Notes

Use ALTER ROLE to change the attributes of a role, and DROP ROLE to remove a role. The attributes specified by CREATE ROLE can be modified by later ALTER ROLE commands.

Use GRANT and REVOKE to add and remove members of roles that are being used as groups.

The maximum length limit for role name and password is 63 characters.

Examples

Create a role (and a schema) named, admins, with a password:

CREATE ROLE admins IDENTIFIED BY Rt498zb;

**See Also**

[ALTER ROLE](#_ALTER_ROLE), [DROP ROLE](#_DROP_ROLE), [GRANT](#_GRANT_on_Roles), [REVOKE](#_REVOKE), [SET ROLE](#_SET_ROLE)

### CREATE SCHEMA

Name

CREATE SCHEMA -- define a new schema

Synopsis

CREATE SCHEMA AUTHORIZATION *username* *schema\_element* \[ ... \]

Description

This variation of the CREATE SCHEMA command creates a new schema owned by *username* and populated with one or more objects. The creation of the schema and objects occur within a single transaction so either all objects are created or none of them including the schema. (Please note: if you are using an Oracle database, no new schema is created – *username*, and therefore the schema, must pre-exist.)

A schema is essentially a namespace: it contains named objects (tables, views, etc.) whose names may duplicate those of other objects existing in other schemas. Named objects are accessed either by “qualifying” their names with the schema name as a prefix, or by setting a search path that includes the desired schema(s). Unqualified objects are created in the current schema (the one at the front of the search path, which can be determined with the function CURRENT\_SCHEMA). (The search path concept and the CURRENT\_SCHEMA function are not Oracle compatible.)

CREATE SCHEMA includes subcommands to create objects within the schema. The subcommands are treated essentially the same as separate commands issued after creating the schema. All the created objects will be owned by the specified user.

Parameters

*username*

The name of the user who will own the new schema. The schema will be named the same as *username*. Only superusers may create schemas owned by users other than themselves. (Please note: In Postgres Plus Advanced Server the role, *username*, must already exist, but the schema must not exist. In Oracle, the user (equivalently, the schema) must exist.)

*schema\_element*

An SQL statement defining an object to be created within the schema. CREATE TABLE, CREATE VIEW, and GRANT are accepted as clauses within CREATE SCHEMA. Other kinds of objects may be created in separate commands after the schema is created.

Notes

To create a schema, the invoking user must have the CREATE privilege for the current database. (Of course, superusers bypass this check.)

In Postgres Plus Advanced Server, there are other forms of the CREATE SCHEMA command that are not Oracle compatible.

Examples

CREATE SCHEMA AUTHORIZATION enterprisedb

CREATE TABLE empjobs (ename VARCHAR2(10), job VARCHAR2(9))

CREATE VIEW managers AS SELECT ename FROM empjobs WHERE job = 'MANAGER'

GRANT SELECT ON managers TO PUBLIC;

<span id="_Ref176073097" class="anchor"></span>

### CREATE SEQUENCE

Name

CREATE SEQUENCE -- define a new sequence generator

Synopsis

CREATE SEQUENCE *name* \[ INCREMENT BY *increment* \]

\[ { NOMINVALUE | MINVALUE *minvalue* } \]

\[ { NOMAXVALUE | MAXVALUE *maxvalue* } \]

\[ START WITH *start* \] \[ CACHE *cache* | NOCACHE \] \[ CYCLE \]

Description

CREATE SEQUENCE creates a new sequence number generator. This involves creating and initializing a new special single-row table with the name, *name*. The generator will be owned by the user issuing the command.

If a schema name is given then the sequence is created in the specified schema, otherwise it is created in the current schema. The sequence name must be distinct from the name of any other sequence, table, index, or view in the same schema.

After a sequence is created, use the functions NEXTVAL and CURRVAL to operate on the sequence. These functions are documented in Section <span class="underline"> </span> <span class="underline">3.5.9</span>.

Parameters

*name*

The name (optionally schema-qualified) of the sequence to be created.

*increment*

The optional clause INCREMENT BY *increment* specifies the value to add to the current sequence value to create a new value. A positive value will make an ascending sequence, a negative one a descending sequence. The default value is 1.

NOMINVALUE | MINVALUE *minvalue*

The optional clause MINVALUE *minvalue* determines the minimum value a sequence can generate. If this clause is not supplied, then defaults will be used. The defaults are 1 and -2<sup>63</sup>-1 for ascending and descending sequences, respectively. Note that the key words, NOMINVALUE, may be used to set this behavior to the default.

NOMAXVALUE | MAXVALUE *maxvalue*

The optional clause MAXVALUE *maxvalue* determines the maximum value for the sequence. If this clause is not supplied, then default values will be used. The defaults are 2<sup>63</sup>-1 and -1 for ascending and descending sequences, respectively. Note that the key words, NOMAXVALUE, may be used to set this behavior to the default.

*start*

The optional clause START WITH *start* allows the sequence to begin anywhere. The default starting value is *minvalue* for ascending sequences and *maxvalue* for descending ones.

*cache*

The optional clause CACHE *cache* specifies how many sequence numbers are to be preallocated and stored in memory for faster access. The minimum value is 1 (only one value can be generated at a time, i.e., NOCACHE), and this is also the default.

CYCLE

The CYCLE option allows the sequence to wrap around when the *maxvalue* or *minvalue* has been reached by an ascending or descending sequence respectively. If the limit is reached, the next number generated will be the *minvalue* or *maxvalue*, respectively.

If CYCLE is omitted (the default), any calls to NEXTVAL after the sequence has reached its maximum value will return an error. Note that the key words, NO CYCLE, may be used to obtain the default behavior, however, this term is not Oracle compatible.

Notes

Sequences are based on big integer arithmetic, so the range cannot exceed the range of an eight-byte integer (-9223372036854775808 to 9223372036854775807). On some older platforms, there may be no compiler support for eight-byte integers, in which case sequences use regular INTEGER arithmetic (range -2147483648 to +2147483647).

Unexpected results may be obtained if a *cache* setting greater than one is used for a sequence object that will be used concurrently by multiple sessions. Each session will allocate and cache successive sequence values during one access to the sequence object and increase the sequence object’s last value accordingly. Then, the next *cache*-1 uses of NEXTVAL within that session simply return the preallocated values without touching the sequence object. So, any numbers allocated but not used within a session will be lost when that session ends, resulting in "holes" in the sequence.

Furthermore, although multiple sessions are guaranteed to allocate distinct sequence values, the values may be generated out of sequence when all the sessions are considered. For example, with a *cache* setting of 10, session A might reserve values 1..10 and return NEXTVAL=1, then session B might reserve values 11..20 and return NEXTVAL=11 before session A has generated NEXTVAL=2. Thus, with a *cache* setting of one it is safe to assume that NEXTVAL values are generated sequentially; with a *cache* setting greater than one you should only assume that the NEXTVAL values are all distinct, not that they are generated purely sequentially. Also, the last value will reflect the latest value reserved by any session, whether or not it has yet been returned by NEXTVAL.

Examples

Create an ascending sequence called serial, starting at 101:

CREATE SEQUENCE serial START WITH 101;

Select the next number from this sequence:

SELECT serial.NEXTVAL FROM DUAL;

nextval

\---------

101

(1 row)

Create a sequence called supplier\_seq with the NOCACHE option:

CREATE SEQUENCE supplier\_seq

MINVALUE 1

START WITH 1

INCREMENT BY 1

NOCACHE;

Select the next number from this sequence:

SELECT supplier\_seq.NEXTVAL FROM DUAL;

nextval

\---------

1

(1 row)

**See Also**

[ALTER SEQUENCE](#_ALTER_SEQUENCE), [DROP SEQUENCE](#_DROP_SEQUENCE)

### CREATE SYNONYM

Name

CREATE SYNONYM -- define a new synonym

Synopsis

CREATE \[OR REPLACE\] \[PUBLIC\] SYNONYM \[*schema*.\]*syn*\_*name*
FOR *object*\_*schema*.*object*\_*name*\[*@dblink\_name*\];

Description

CREATE SYNONYM defines a synonym for certain types of database objects. Postgres Plus Advanced Server supports synonyms for:
 - tables
 - views
 - sequences
 - stored procedures
 - stored functions
 - types
 - objects that are accessible through a database link
 - other synonyms

A synonym is an alternate name that refers to a database object. See Section <span class="underline"></span>2.2.4 for additional information on synonyms.

Parameters:

*syn\_name*

> *syn\_name* is the name of the synonym. A synonym name must be unique within a schema.

*schema*

> *schema* specifies the name of the schema that the synonym resides in. If you do not specify a schema name, the synonym is created in the first existing schema in your search path.

*object\_name*

> *object\_name* specifies the name of the object.

*object\_schema*

> *object\_schema* specifies the name of the schema that the referenced object resides in.

*dblink\_name*

> *dblink\_name* specifies the name of the database link through which a target object may be accessed.

Include the REPLACE clause to replace an existing synonym definition with a new synonym definition.

Include the PUBLIC clause to create the synonym in the public schema. The Oracle-compatible CREATE PUBLIC SYNONYM command creates a synonym that resides in the public schema:

> CREATE \[OR REPLACE\] PUBLIC SYNONYM *syn*\_*name* FOR *object\_schema*.*object\_name*;

This just a shorthand way to write:

> CREATE \[OR REPLACE\] SYNONYM public.*syn*\_*name* FOR *object\_schema*.*object\_name*;

Notes

Access to the object referenced by the synonym is determined by the permissions of the current user of the synonym; the synonym user must have the appropriate permissions on the underlying database object.

Examples

Create a synonym for the emp table in a schema named enterprisedb:

CREATE SYNONYM personnel FOR enterprisedb.emp;

See Also

[DROP SYNONYM](#_DROP_SYNONYM)

<span id="_CREATE_TABLE" class="anchor"></span>

###  CREATE TABLE

Name

CREATE TABLE -- define a new table

Synopsis

CREATE \[ GLOBAL TEMPORARY \] TABLE *table\_name* (

{ *column\_name* *data\_type* \[ DEFAULT *default\_expr* \]

\[ *column\_constraint* \[ ... \] \] | *table\_constraint* } \[, ...\]

)

\[ ON COMMIT { PRESERVE ROWS | DELETE ROWS } \]

\[ TABLESPACE *tablespace* \]

where *column\_constraint* is:

\[ CONSTRAINT *constraint\_name* \]

{ NOT NULL |

NULL |

UNIQUE \[ USING INDEX TABLESPACE *tablespace* \] |

PRIMARY KEY \[ USING INDEX TABLESPACE *tablespace* \] |

CHECK (*expression*) |

REFERENCES *reftable* \[ ( *refcolumn* ) \]

\[ ON DELETE *action* \] }

\[ DEFERRABLE | NOT DEFERRABLE \] \[ INITIALLY DEFERRED |

INITIALLY IMMEDIATE \]

and *table\_constraint* is:

\[ CONSTRAINT *constraint\_name* \]

{ UNIQUE ( *column\_name* \[, ...\] )

\[ USING INDEX TABLESPACE *tablespace* \] |

PRIMARY KEY ( *column\_name* \[, ...\] )

\[ USING INDEX TABLESPACE *tablespace* \] |

CHECK ( *expression* ) |

FOREIGN KEY ( *column\_name* \[, ...\] )

REFERENCES *reftable* \[ ( *refcolumn* \[, ...\] ) \]

\[ ON DELETE *action* \] }

\[ DEFERRABLE | NOT DEFERRABLE \]

\[ INITIALLY DEFERRED | INITIALLY IMMEDIATE \]

Description

CREATE TABLE will create a new, initially empty table in the current database. The table will be owned by the user issuing the command.

If a schema name is given (for example, CREATE TABLE *myschema*.*mytable* ...) then the table is created in the specified schema. Otherwise it is created in the current schema. Temporary tables exist in a special schema, so a schema name may not be given when creating a temporary table. The table name must be distinct from the name of any other table, sequence, index, or view in the same schema.

CREATE TABLE also automatically creates a data type that represents the composite type corresponding to one row of the table. Therefore, tables cannot have the same name as any existing data type in the same schema.

A table cannot have more than 1600 columns. (In practice, the effective limit is lower because of tuple-length constraints).

The optional constraint clauses specify constraints (or tests) that new or updated rows must satisfy for an insert or update operation to succeed. A constraint is an SQL object that helps define the set of valid values in the table in various ways.

There are two ways to define constraints: table constraints and column constraints. A column constraint is defined as part of a column definition. A table constraint definition is not tied to a particular column, and it can encompass more than one column. Every column constraint can also be written as a table constraint; a column constraint is only a notational convenience if the constraint only affects one column.

Parameters

GLOBAL TEMPORARY

If specified, the table is created as a temporary table. Temporary tables are automatically dropped at the end of a session, or optionally at the end of the current transaction (see ON COMMIT below). Existing permanent tables with the same name are not visible to the current session while the temporary table exists, unless they are referenced with schema-qualified names. In addition, temporary tables are not visible outside the session in which it was created. (This aspect of global temporary tables is not Oracle compatible.) Any indexes created on a temporary table are automatically temporary as well.

*table\_name*

The name (optionally schema-qualified) of the table to be created.

*column\_name*

The name of a column to be created in the new table.

*data\_type*

The data type of the column. This may include array specifiers. For more information on the data types included with Postgres Plus Advanced Server, refer to Section <span class="underline">3.2</span>.

DEFAULT *default\_expr*

The DEFAULT clause assigns a default data value for the column whose column definition it appears within. The value is any variable-free expression (subqueries and cross-references to other columns in the current table are not allowed). The data type of the default expression must match the data type of the column.

The default expression will be used in any insert operation that does not specify a value for the column. If there is no default for a column, then the default is null.

CONSTRAINT *constraint\_name*

An optional name for a column or table constraint. If not specified, the system generates a name.

NOT NULL

The column is not allowed to contain null values.

NULL

The column is allowed to contain null values. This is the default.

This clause is only available for compatibility with non-standard SQL databases. Its use is discouraged in new applications.

UNIQUE - column constraint
UNIQUE (*column\_name* \[, ...\] ) - table constraint

The UNIQUE constraint specifies that a group of one or more distinct columns of a table may contain only unique values. The behavior of the unique table constraint is the same as that for column constraints, with the additional capability to span multiple columns.

For the purpose of a unique constraint, null values are not considered equal.

Each unique table constraint must name a set of columns that is different from the set of columns named by any other unique or primary key constraint defined for the table. (Otherwise it would just be the same constraint listed twice.)

PRIMARY KEY - column constraint
PRIMARY KEY ( *column\_name* \[, ...\] ) - table constraint

The primary key constraint specifies that a column or columns of a table may contain only unique (non-duplicate), non-null values. Technically, PRIMARY KEY is merely a combination of UNIQUE and NOT NULL, but identifying a set of columns as primary key also provides metadata about the design of the schema, as a primary key implies that other tables may rely on this set of columns as a unique identifier for rows.

Only one primary key can be specified for a table, whether as a column constraint or a table constraint.

The primary key constraint should name a set of columns that is different from other sets of columns named by any unique constraint defined for the same table.

CHECK (*expression*)

The CHECK clause specifies an expression producing a Boolean result which new or updated rows must satisfy for an insert or update operation to succeed. Expressions evaluating to TRUE or “unknown” succeed. Should any row of an insert or update operation produce a FALSE result an error exception is raised and the insert or update does not alter the database. A check constraint specified as a column constraint should reference that column’s value only, while an expression appearing in a table constraint may reference multiple columns.

Currently, CHECK expressions cannot contain subqueries nor refer to variables other than columns of the current row.

REFERENCES reftable \[ ( *refcolumn* ) \] \[ ON DELETE *action* \] - column constraint
FOREIGN KEY ( *column* \[, ...\] ) REFERENCES *reftable* \[ ( *refcolumn* \[, ...\] ) \] \[ ON DELETE *action* \] - table constraint

These clauses specify a foreign key constraint, which requires that a group of one or more columns of the new table must only contain values that match values in the referenced column(s) of some row of the referenced table. If *refcolumn* is omitted, the primary key of the *reftable* is used. The referenced columns must be the columns of a unique or primary key constraint in the referenced table.

In addition, when the data in the referenced columns is changed, certain actions are performed on the data in this table’s columns. The ON DELETE clause specifies the action to perform when a referenced row in the referenced table is being deleted. Referential actions cannot be deferred even if the constraint is deferrable. Here are the following possible actions for each clause:

CASCADE

> Delete any rows referencing the deleted row, or update the value of the referencing column to the new value of the referenced column, respectively.

SET NULL

> Set the referencing column(s) to NULL.

If the referenced column(s) are changed frequently, it may be wise to add an index to the foreign key column so that referential actions associated with the foreign key column can be performed more efficiently.

DEFERRABLE
NOT DEFERRABLE

This controls whether the constraint can be deferred. A constraint that is not deferrable will be checked immediately after every command. Checking of constraints that are deferrable may be postponed until the end of the transaction (using the SET CONSTRAINTS command). NOT DEFERRABLE is the default. Only foreign key constraints currently accept this clause. All other constraint types are not deferrable.

INITIALLY IMMEDIATE
INITIALLY DEFERRED

If a constraint is deferrable, this clause specifies the default time to check the constraint. If the constraint is INITIALLY IMMEDIATE, it is checked after each statement. This is the default. If the constraint is INITIALLY DEFERRED, it is checked only at the end of the transaction. The constraint check time can be altered with the SET CONSTRAINTS command.

ON COMMIT

The behavior of temporary tables at the end of a transaction block can be controlled using ON COMMIT. The two options are:

PRESERVE ROWS

> No special action is taken at the ends of transactions. This is the default behavior. (Note that this aspect is not Oracle compatible. The Oracle default is DELETE ROWS.)

DELETE ROWS

> All rows in the temporary table will be deleted at the end of each transaction block. Essentially, an automatic TRUNCATE is done at each commit.

TABLESPACE *tablespace*

The *tablespace* is the name of the tablespace in which the new table is to be created. If not specified, default tablespace is used, or the database’s default tablespace if default\_tablespace is an empty string.

USING INDEX TABLESPACE *tablespace*

This clause allows selection of the tablespace in which the index associated with a UNIQUE or PRIMARY KEY constraint will be created. If not specified, default tablespace is used, or the database’s default tablespace if default\_tablespace is an empty string.

Notes

Postgres Plus Advanced Server automatically creates an index for each unique constraint and primary key constraint to enforce the uniqueness. Thus, it is not necessary to create an explicit index for primary key columns. (See CREATE INDEX for more information.)

Examples

Create table dept and table emp:

CREATE TABLE dept (

deptno NUMBER(2) NOT NULL CONSTRAINT dept\_pk PRIMARY KEY,

dname VARCHAR2(14),

loc VARCHAR2(13)

);

CREATE TABLE emp (

empno NUMBER(4) NOT NULL CONSTRAINT emp\_pk PRIMARY KEY,

ename VARCHAR2(10),

job VARCHAR2(9),

mgr NUMBER(4),

hiredate DATE,

sal NUMBER(7,2),

comm NUMBER(7,2),

deptno NUMBER(2) CONSTRAINT emp\_ref\_dept\_fk

REFERENCES dept(deptno)

);

Define a unique table constraint for the table dept. Unique table constraints can be defined on one or more columns of the table.

CREATE TABLE dept (

deptno NUMBER(2) NOT NULL CONSTRAINT dept\_pk PRIMARY KEY,

dname VARCHAR2(14) CONSTRAINT dept\_dname\_uq UNIQUE,

loc VARCHAR2(13)

);

Define a check column constraint:

CREATE TABLE emp (

empno NUMBER(4) NOT NULL CONSTRAINT emp\_pk PRIMARY KEY,

ename VARCHAR2(10),

job VARCHAR2(9),

mgr NUMBER(4),

hiredate DATE,

sal NUMBER(7,2) CONSTRAINT emp\_sal\_ck CHECK (sal \> 0),

comm NUMBER(7,2),

deptno NUMBER(2) CONSTRAINT emp\_ref\_dept\_fk

REFERENCES dept(deptno)

);

Define a check table constraint:

CREATE TABLE emp (

empno NUMBER(4) NOT NULL CONSTRAINT emp\_pk PRIMARY KEY,

ename VARCHAR2(10),

job VARCHAR2(9),

mgr NUMBER(4),

hiredate DATE,

sal NUMBER(7,2),

comm NUMBER(7,2),

deptno NUMBER(2) CONSTRAINT emp\_ref\_dept\_fk

REFERENCES dept(deptno),

CONSTRAINT new\_emp\_ck CHECK (ename IS NOT NULL AND empno \> 7000)

);

Define a primary key table constraint for the table jobhist. Primary key table constraints can be defined on one or more columns of the table.

CREATE TABLE jobhist (

empno NUMBER(4) NOT NULL,

startdate DATE NOT NULL,

enddate DATE,

job VARCHAR2(9),

sal NUMBER(7,2),

comm NUMBER(7,2),

deptno NUMBER(2),

chgdesc VARCHAR2(80),

CONSTRAINT jobhist\_pk PRIMARY KEY (empno, startdate)

);

This assigns a literal constant default value for the column, job and makes the default value of hiredate be the date at which the row is inserted.

CREATE TABLE emp (

empno NUMBER(4) NOT NULL CONSTRAINT emp\_pk PRIMARY KEY,

ename VARCHAR2(10),

job VARCHAR2(9) DEFAULT 'SALESMAN',

mgr NUMBER(4),

hiredate DATE DEFAULT SYSDATE,

sal NUMBER(7,2),

comm NUMBER(7,2),

deptno NUMBER(2) CONSTRAINT emp\_ref\_dept\_fk

REFERENCES dept(deptno)

);

Create table dept in tablespace diskvol1:

CREATE TABLE dept (

deptno NUMBER(2) NOT NULL CONSTRAINT dept\_pk PRIMARY KEY,

dname VARCHAR2(14),

loc VARCHAR2(13)

) TABLESPACE diskvol1;

**See Also**

[ALTER TABLE](#_ALTER_TABLE), [DROP TABLE](#_DROP_TABLE)

### CREATE TABLE AS

Name

CREATE TABLE AS -- define a new table from the results of a query

Synopsis

CREATE \[ GLOBAL TEMPORARY \] TABLE *table\_name*

\[ (*column\_name* \[, ...\] ) \]

\[ ON COMMIT { PRESERVE ROWS | DELETE ROWS } \]

\[ TABLESPACE *tablespace* \]

AS *query*

Description

CREATE TABLE AS creates a table and fills it with data computed by a SELECT command. The table columns have the names and data types associated with the output columns of the SELECT (except that you can override the column names by giving an explicit list of new column names).

CREATE TABLE AS bears some resemblance to creating a view, but it is really quite different: it creates a new table and evaluates the query just once to fill the new table initially. The new table will not track subsequent changes to the source tables of the query. In contrast, a view re-evaluates its defining SELECT statement whenever it is queried.

Parameters

GLOBAL TEMPORARY

> If specified, the table is created as a temporary table. Refer to CREATE TABLE for details.

*table\_name*

The name (optionally schema-qualified) of the table to be created.

*column\_name*

The name of a column in the new table. If column names are not provided, they are taken from the output column names of the query.

*query*

> A query statement ( a SELECT command). Refer to SELECT for a description of the allowed syntax.<span id="AEN39804" class="anchor"></span>

###  CREATE TRIGGER

Name

CREATE TRIGGER -- define a new trigger

Synopsis

CREATE \[ OR REPLACE \] TRIGGER name

{ BEFORE | AFTER |INSTEAD OF}

{ INSERT | UPDATE | DELETE }

\[ OR { INSERT | UPDATE | DELETE } \] \[, ...\]

ON table

\[ FOR EACH ROW \]

\[ WHEN *condition* \]

\[ DECLARE

declaration; \[, ...\] \]

BEGIN

statement; \[, ...\]

\[ EXCEPTION

{ WHEN *exception* \[ OR *exception* \] \[...\] THEN

*statement*; \[, ...\] } \[, ...\]

\]

END

Description

CREATE TRIGGER defines a new trigger. CREATE OR REPLACE TRIGGER will either create a new trigger, or replace an existing definition.

If you are using the CREATE TRIGGER keywords to create a new trigger, the name of the new trigger must not match any existing trigger defined on the same table. New triggers will be created in the same schema as the table on which the triggering event is defined.

If you are updating the definition of an existing trigger, use the CREATE OR REPLACE TRIGGER keywords.

When you use Oracle-compatible syntax to create a trigger, the trigger runs as a SECURITY DEFINER function.

See [Section 5](#triggers) for more information about triggers.

Parameters

*name*

The name of the trigger to create.

BEFORE | AFTER

Determines whether the trigger is fired before or after the triggering event.

INSERT | UPDATE | DELETE

Defines the triggering event.

*table*

The name of the table on which the triggering event occurs.

*condition*

> *condition* is a Boolean expression that determines if the trigger will actually be executed; if *condition* evaluates to TRUE, the trigger will fire.
>
> If the trigger definition includes the FOR EACH ROW keywords, the WHEN clause can refer to columns of the old and/or new row values by writing OLD.*column\_name* or NEW.*column\_name* respectively. INSERT triggers cannot refer to OLD and DELETE triggers cannot refer to NEW.
>
> If the trigger includes the INSTEAD OF keywords, it may not include a WHEN clause. A WHEN clause cannot contain subqueries.

FOR EACH ROW

Determines whether the trigger should be fired once for every row affected by the triggering event, or just once per SQL statement. If specified, the trigger is fired once for every affected row (row-level trigger), otherwise the trigger is a statement-level trigger.

*declaration*

A variable, type, or REF CURSOR declaration.

*statement*

An SPL program statement. Note that a DECLARE - BEGIN - END block is considered an SPL statement unto itself. Thus, the trigger body may contain nested blocks.

*exception*

An exception condition name such as NO\_DATA\_FOUND, OTHERS, etc.

Examples

The following is a statement-level trigger that fires after the triggering statement (insert, update, or delete on table emp) is executed.

CREATE OR REPLACE TRIGGER user\_audit\_trig

AFTER INSERT OR UPDATE OR DELETE ON emp

DECLARE

v\_action VARCHAR2(24);

BEGIN

IF INSERTING THEN

v\_action := ' added employee(s) on ';

ELSIF UPDATING THEN

v\_action := ' updated employee(s) on ';

ELSIF DELETING THEN

v\_action := ' deleted employee(s) on ';

END IF;

DBMS\_OUTPUT.PUT\_LINE('User ' || USER || v\_action ||

TO\_CHAR(SYSDATE,'YYYY-MM-DD'));

END;

The following is a row-level trigger that fires before each row is either inserted, updated, or deleted on table emp.

CREATE OR REPLACE TRIGGER emp\_sal\_trig

BEFORE DELETE OR INSERT OR UPDATE ON emp

FOR EACH ROW

DECLARE

sal\_diff NUMBER;

BEGIN

IF INSERTING THEN

DBMS\_OUTPUT.PUT\_LINE('Inserting employee ' || :NEW.empno);

DBMS\_OUTPUT.PUT\_LINE('..New salary: ' || :NEW.sal);

END IF;

IF UPDATING THEN

sal\_diff := :NEW.sal - :OLD.sal;

DBMS\_OUTPUT.PUT\_LINE('Updating employee ' || :OLD.empno);

DBMS\_OUTPUT.PUT\_LINE('..Old salary: ' || :OLD.sal);

DBMS\_OUTPUT.PUT\_LINE('..New salary: ' || :NEW.sal);

DBMS\_OUTPUT.PUT\_LINE('..Raise : ' || sal\_diff);

END IF;

IF DELETING THEN

DBMS\_OUTPUT.PUT\_LINE('Deleting employee ' || :OLD.empno);

DBMS\_OUTPUT.PUT\_LINE('..Old salary: ' || :OLD.sal);

END IF;

END;

See Also

[DROP TRIGGER](#_DROP_TRIGGER)

<span id="CREATE_TYPE" class="anchor"></span>

### CREATE TYPE

Name

CREATE TYPE -- define a new user-defined type

Synopsis

CREATE \[ OR REPLACE \] TYPE *name*

\[ AUTHID { DEFINER | CURRENT\_USER } \]

{ IS | AS } OBJECT

( { *attribute* { *datatype* | *objtype* | *collecttype* } }

\[, ...\]

\[ *method\_spec* \] \[, ...\]

) \[ \[ NOT \] { FINAL | INSTANTIABLE } \] ...

where *method\_spec* is:

\[ \[ NOT \] { FINAL | INSTANTIABLE } \] ...

\[ OVERRIDING \]

*subprogram\_spec*

and *subprogram\_spec* is:

{ MEMBER | STATIC }

{ PROCEDURE *proc\_name*

\[ ( \[ SELF \[ IN | IN OUT \] *name* \]

\[, *argname* \[ IN | IN OUT | OUT \] *argtype*

\[ DEFAULT *value* \]

\] ...)

\]

|

FUNCTION *func\_name*

\[ ( \[ SELF \[ IN | IN OUT \] name \]

\[, *argname* \[ IN | IN OUT | OUT \] *argtype*

\[ DEFAULT *value* \]

\] ...)

\]

RETURN *rettype*

}

CREATE \[ OR REPLACE \] TYPE *name* { IS | AS } TABLE OF

{ *datatype* | *objtype* | *collecttype* }

CREATE \[ OR REPLACE \] TYPE *name* { IS | AS }

{ VARRAY | VARYING ARRAY } (*maxsize*) OF { *datatype* | *objtype* }

Description

CREATE TYPE defines a new user-defined data type. The types that can be created are an object type, a nested table type, or a varray type. (Nested table and varray types belong to the category of types known as *collections*. See Section <span class="underline">4.10</span> for information on collections.) CREATE OR REPLACE TYPE will either create a new type definition, or replace an existing type definition.

If a schema name is included, then the type is created in the specified schema, otherwise it is created in the current schema. The name of the new type must not match any existing type in the same schema unless the intent is to update the definition of an existing type, in which case use CREATE OR REPLACE TYPE.

**Note:** The OR REPLACE option cannot be currently used to add, delete, or modify the attributes of an existing object type. Use the DROP TYPE command to first delete the existing object type. The OR REPLACE option can be used to add, delete, or modify the methods in an existing object type.

**Note:** The PostgreSQL form of the ALTER TYPE ALTER ATTRIBUTE command can be used to change the data type of an attribute in an existing object type. However, the ALTER TYPE command cannot add or delete attributes in the object type.

The user that creates the type becomes the owner of the type.

See Section <span class="underline">4.10.2</span> for more information on nested table types. See Section <span class="underline">4.10.3</span> for more information on varray types. See [Section 8](#object-types-and-objects) for more information on object types.

Parameters

*name*

The name (optionally schema-qualified) of the type to create.

DEFINER | CURRENT\_USER

Specifies whether the privileges of the object type owner (DEFINER) or the privileges of the current user executing a method in the object type (CURRENT\_USER) are to be used to determine whether or not access is allowed to database objects referenced in the object type. DEFINER is the default.

*attribute*

The name of an attribute in the object type.

*datatype*

The data type that defines an attribute of the object type or the elements of the collection type that is being created.

*objtype*

The name of an object type that defines an attribute of the object type or the elements of the collection type that is being created.

*collecttype*

The name of a collection type that defines an attribute of the object type or the elements of the collection type that is being created.

FINAL
NOT FINAL

For an object type, specifies whether or not a subtype can be derived from the object type. FINAL (subtype cannot be derived from the object type) is the default.

For *method\_spec*, specifies whether or not the method may be overridden in a subtype. NOT FINAL (method may be overridden in a subtype) is the default.

INSTANTIABLE
NOT INSTANTIABLE

For an object type, specifies whether or not an object instance can be created of this object type. INSTANTIABLE (an instance of this object type can be created) is the default. If NOT INSTANTIABLE is specified, then NOT FINAL must be specified as well. If *method\_spec* for any method in the object type contains the NOT INSTANTIABLE qualifier, then the object type, itself, must be defined with NOT INSTANTIABLE and NOT FINAL following the closing parenthesis of the object type specification.

For *method\_spec*, specifies whether or not the object type definition provides an implementation for the method. INSTANTIABLE (the CREATE TYPE BODY command for the object type provides the implementation of the method) is the default. If NOT INSTANTIABLE is specified, then the CREATE TYPE BODY command for the object type must not contain the implementation of the method.

OVERRIDING

If OVERRIDING is specified, *method\_spec* overrides an identically named method with the same number of identically named method arguments with the same data types, in the same order, and the same return type (if the method is a function) as defined in a supertype.

MEMBER
STATIC

Specify MEMBER if the subprogram operates on an object instance. Specify STATIC if the subprogram operates independently of any particular object instance.

*proc\_name*

The name of the procedure to create.

SELF \[ IN | IN OUT \] *name*

For a member method there is an implicit, built-in parameter named SELF whose data type is that of the object type being defined. SELF refers to the object instance that is currently invoking the method. SELF can be explicitly declared as an IN or IN OUT parameter in the parameter list. If explicitly declared, SELF must be the first parameter in the parameter list. If SELF is not explicitly declared, its parameter mode defaults to IN OUT for member procedures and IN for member functions.

*argname*

The name of an argument. The argument is referenced by this name within the method body.

*argtype*

The data type(s) of the method’s arguments. The argument types may be a base data type or a user-defined type such as a nested table or an object type. A length must not be specified for any base type - for example, specify VARCHAR2, not VARCHAR2(10).

DEFAULT *value*

Supplies a default value for an input argument if one is not supplied in the method call. DEFAULT may not be specified for arguments with modes IN OUT or OUT.

*func\_name*

The name of the function to create.

*rettype*

The return data type, which may be any of the types listed for *argtype*. As for *argtype*, a length must not be specified for *rettype*.

*maxsize*

The maximum number of elements permitted in the varray.

Examples

Create object type addr\_obj\_typ.

CREATE OR REPLACE TYPE addr\_obj\_typ AS OBJECT (

street VARCHAR2(30),

city VARCHAR2(20),

state CHAR(2),

zip NUMBER(5)

);

Create object type emp\_obj\_typ that includes a member method display\_emp.

CREATE OR REPLACE TYPE emp\_obj\_typ AS OBJECT (

empno NUMBER(4),

ename VARCHAR2(20),

addr ADDR\_OBJ\_TYP,

MEMBER PROCEDURE display\_emp (SELF IN OUT emp\_obj\_typ)

);

Create object type dept\_obj\_typ that includes a static method get\_dname.

CREATE OR REPLACE TYPE dept\_obj\_typ AS OBJECT (

deptno NUMBER(2),

STATIC FUNCTION get\_dname (p\_deptno IN NUMBER) RETURN VARCHAR2,

MEMBER PROCEDURE display\_dept

);

Create a nested table type, budget\_tbl\_typ, of data type, NUMBER(8,2).

CREATE OR REPLACE TYPE budget\_tbl\_typ IS TABLE OF NUMBER(8,2);

See Also

[CREATE TYPE BODY](#_CREATE_TYPE_BODY), [DROP TYPE](#DROP_TYPE)

<span id="_CREATE_TYPE_BODY" class="anchor"></span>

### CREATE TYPE BODY

Name

CREATE TYPE BODY -- define a new object type body

Synopsis

CREATE \[ OR REPLACE \] TYPE BODY *name*

{ IS | AS }

*method\_spec* \[...\]

END

where *method\_spec* is:

*subprogram\_spec*

and *subprogram\_spec* is:

{ MEMBER | STATIC }

{ PROCEDURE *proc\_name*

\[ ( \[ SELF \[ IN | IN OUT \] *name* \]

\[, *argname* \[ IN | IN OUT | OUT \] *argtype*

\[ DEFAULT *value* \]

\] ...)

\]

{ IS | AS }

*program\_body*

END;

|

FUNCTION *func\_name*

\[ ( \[ SELF \[ IN | IN OUT \] name \]

\[, *argname* \[ IN | IN OUT | OUT \] *argtype*

\[ DEFAULT *value* \]

\] ...)

\]

RETURN *rettype*

{ IS |AS }

*program\_body*

END;

}

Description

CREATE TYPE BODY defines a new object type body. CREATE OR REPLACE TYPE BODY will either create a new object type body, or replace an existing body.

If a schema name is included, then the object type body is created in the specified schema. Otherwise it is created in the current schema. The name of the new object type body must match an existing object type specification in the same schema. The new object type body name must not match any existing object type body in the same schema unless the intent is to update the definition of an existing object type body, in which case use CREATE OR REPLACE TYPE BODY.

See Section <span class="underline">8.2.2</span> for more information on the object type body.

Parameters

*name*

The name (optionally schema-qualified) of the object type for which a body is to be created.

MEMBER
STATIC

Specify MEMBER if the subprogram operates on an object instance. Specify STATIC if the subprogram operates independently of any particular object instance.

*proc\_name*

The name of the procedure to create.

SELF \[ IN | IN OUT \] *name*

For a member method there is an implicit, built-in parameter named SELF whose data type is that of the object type being defined. SELF refers to the object instance that is currently invoking the method. SELF can be explicitly declared as an IN or IN OUT parameter in the parameter list. If explicitly declared, SELF must be the first parameter in the parameter list. If SELF is not explicitly declared, its parameter mode defaults to IN OUT for member procedures and IN for member functions.

*argname*

The name of an argument. The argument is referenced by this name within the method body.

*argtype*

The data type(s) of the method’s arguments. The argument types may be a base data type or a user-defined type such as a nested table or an object type. A length must not be specified for any base type - for example, specify VARCHAR2, not VARCHAR2(10).

DEFAULT *value*

Supplies a default value for an input argument if one is not supplied in the method call. DEFAULT may not be specified for arguments with modes IN OUT or OUT.

*program\_body*

The declarations and SPL statements that comprise the body of the function or procedure.

*func\_name*

The name of the function to create.

*rettype*

The return data type, which may be any of the types listed for *argtype*. As for *argtype*, a length must not be specified for *rettype*.

Examples

Create the object type body for object type emp\_obj\_typ given in the example for the CREATE TYPE command.

CREATE OR REPLACE TYPE BODY emp\_obj\_typ AS

MEMBER PROCEDURE display\_emp (SELF IN OUT emp\_obj\_typ)

IS

BEGIN

    DBMS\_OUTPUT.PUT\_LINE('Employee No  : ' || empno);

    DBMS\_OUTPUT.PUT\_LINE('Name          : ' || ename);

    DBMS\_OUTPUT.PUT\_LINE('Street        : ' || addr.street);

    DBMS\_OUTPUT.PUT\_LINE('City/State/Zip: ' || addr.city || ', ' ||

        addr.state || ' ' || LPAD(addr.zip,5,'0'));

END;

END;

Create the object type body for object type dept\_obj\_typ given in the example for the CREATE TYPE command.

CREATE OR REPLACE TYPE BODY dept\_obj\_typ AS

STATIC FUNCTION get\_dname (p\_deptno IN NUMBER) RETURN VARCHAR2

IS

v\_dname VARCHAR2(14);

BEGIN

CASE p\_deptno

WHEN 10 THEN v\_dname := 'ACCOUNING';

WHEN 20 THEN v\_dname := 'RESEARCH';

WHEN 30 THEN v\_dname := 'SALES';

WHEN 40 THEN v\_dname := 'OPERATIONS';

ELSE v\_dname := 'UNKNOWN';

END CASE;

RETURN v\_dname;

END;

MEMBER PROCEDURE display\_dept

IS

BEGIN

DBMS\_OUTPUT.PUT\_LINE('Dept No : ' || SELF.deptno);

DBMS\_OUTPUT.PUT\_LINE('Dept Name : ' ||

dept\_obj\_typ.get\_dname(SELF.deptno));

END;

END;

See Also

[CREATE TYPE](#CREATE_TYPE), [DROP TYPE](#DROP_TYPE)

<span id="_CREATE_USER" class="anchor"></span>

### CREATE USER

Name

CREATE USER -- define a new database user account

Synopsis

CREATE USER *name* IDENTIFIED BY *password*

Description

CREATE USER adds a new user to a Postgres Plus Advanced Server database cluster. You must be a database superuser to use this command.

When the CREATE USER command is given, a schema will also be created with the same name as the new user and owned by the new user. Objects with unqualified names created by this user will be created in this schema.

Parameters

*name*

The name of the user.

*password*

Sets the user’s password. The password can be changed later using ALTER USER.

Notes

The maximum length allowed for the user name and password is 63 characters.

Examples

Create a user named, john.

CREATE USER john IDENTIFIED BY abc;

**See Also**

[DROP USER](#_DROP_USER)

<span id="_CREATE_VIEW" class="anchor"></span>

### CREATE VIEW

Name

CREATE VIEW -- define a new view

Synopsis

CREATE \[ OR REPLACE \] VIEW *name* \[ ( *column\_name* \[, ...\] ) \]

AS *query*

Description

CREATE VIEW defines a view of a query. The view is not physically materialized. Instead, the query is run every time the view is referenced in a query.

CREATE OR REPLACE VIEW is similar, but if a view of the same name already exists, it is replaced.

If a schema name is given (for example, CREATE VIEW myschema.myview ...) then the view is created in the specified schema. Otherwise it is created in the current schema. The view name must be distinct from the name of any other view, table, sequence, or index in the same schema.

Parameters

*name*

The name (optionally schema-qualified) of a view to be created.

*column\_name*

An optional list of names to be used for columns of the view. If not given, the column names are deduced from the query.

*query*

A query (that is, a SELECT statement) which will provide the columns and rows of the view.

Refer to SELECT for more information about valid queries.

Notes

Currently, views are read only - the system will not allow an insert, update, or delete on a view. You can get the effect of an updatable view by creating rules that rewrite inserts, etc. on the view into appropriate actions on other tables. See the CREATE RULE command in the Postgres Plus documentation set.

Access to tables referenced in the view is determined by permissions of the view owner. However, functions called in the view are treated the same as if they had been called directly from the query using the view. Therefore the user of a view must have permissions to call all functions used by the view.

Examples

Create a view consisting of all employees in department 30:

CREATE VIEW dept\_30 AS SELECT \* FROM emp WHERE deptno = 30;

**See Also**

[DROP VIEW](#_Ref178500676)

<span id="_DELETE" class="anchor"></span>

### DELETE

Name

DELETE -- delete rows of a table

Synopsis

DELETE \[ *optimizer\_hint* \] FROM *table*\[@*dblink* \]

\[ WHERE *condition* \]

\[ RETURNING *return\_expression* \[, ...\]

{ INTO { *record* | *variable* \[, ...\] }

| BULK COLLECT INTO *collection* \[, ...\] } \]

Description

DELETE deletes rows that satisfy the WHERE clause from the specified table. If the WHERE clause is absent, the effect is to delete all rows in the table. The result is a valid, but empty table.

**Note**: The TRUNCATE command provides a faster mechanism to remove all rows from a table.

The RETURNING INTO { *record* | *variable* \[, ...\] } clause may only be specified if the DELETE command is used within an SPL program. In addition the result set of the DELETE command must not include more than one row, otherwise an exception is thrown. If the result set is empty, then the contents of the target record or variables are set to null.

The RETURNING BULK COLLECT INTO *collection* \[, ...\] clause may only be specified if the DELETE command is used within an SPL program. If more than one *collection* is specified as the target of the BULK COLLECT INTO clause, then each *collection* must consist of a single, scalar field – i.e., *collection* must not be a record. The result set of the DELETE command may contain none, one, or more rows. *return\_expression* evaluated for each row of the result set, becomes an element in *collection* starting with the first element. Any existing rows in *collection* are deleted. If the result set is empty, then *collection* will be empty.

You must have the DELETE privilege on the table to delete from it, as well as the SELECT privilege for any table whose values are read in the condition.

Parameters

*optimizer\_hint*

Comment-embedded hints to the optimizer for selection of an execution plan. See [Section 3.4](#_Optimizer_Hints_1) for information on optimizer hints.

*table*

The name (optionally schema-qualified) of an existing table.

*dblink*

> Database link name identifying a remote database. See the CREATE DATABASE LINK command for information on database links.

*condition*

A value expression that returns a value of type BOOLEAN that determines the rows which are to be deleted.

*return\_expression*

An expression that may include one or more columns from *table*. If a column name from *table* is specified in *return\_expression*, the value substituted for the column when *return\_expression* is evaluated is the value from the deleted row.

*record*

A record whose field the evaluated *return\_expression* is to be assigned. The first *return\_expression* is assigned to the first field in *record*, the second *return\_expression* is assigned to the second field in *record*, etc. The number of fields in *record* must exactly match the number of expressions and the fields must be type-compatible with their assigned expressions.

*variable*

A variable to which the evaluated *return\_expression* is to be assigned. If more than one *return\_expression* and *variable* are specified, the *first return\_expression* is assigned to the first *variable*, the second *return\_expression* is assigned to the second *variable*, etc. The number of variables specified following the INTO keyword must exactly match the number of expressions following the RETURNING keyword and the variables must be type-compatible with their assigned expressions.

*collection*

A collection in which an element is created from the evaluated *return\_expression*. There can be either a single collection which may be a collection of a single field or a collection of a record type, or there may be more than one collection in which case each collection must consist of a single field. The number of return expressions must match in number and order the number of fields in all specified collections. Each corresponding *return\_expression* and *collection* field must be type-compatible.

Examples

Delete all rows for employee 7900 from the jobhist table:

DELETE FROM jobhist WHERE empno = 7900;

Clear the table jobhist:

DELETE FROM jobhist;

See Also

[TRUNCATE](#_TRUNCATE)

### DROP DATABASE LINK

Name

DROP DATABASE LINK -- remove a database link

Synopsis

DROP \[ PUBLIC \] DATABASE LINK *name*

Description

DROP DATABASE LINK drops existing database links. To execute this command you must be a superuser or the owner of the database link.

Parameters

*name*

The name of a database link to be removed.

PUBLIC

Indicates that *name* is a public database link.

Examples

Remove the public database link named, oralink:

DROP PUBLIC DATABASE LINK oralink;

Remove the private database link named, edblink:

DROP DATABASE LINK edblink;

**See Also**

[CREATE DATABASE LINK](#_Ref183414058)

<span id="_Ref178410995" class="anchor"></span>

### DROP DIRECTORY

Name

DROP DIRECTORY -- remove a directory alias for a file system directory path

Synopsis

DROP DIRECTORY *name*

Description

DROP DIRECTORY drops an existing alias for a file system directory path that was created with the CREATE DIRECTORY command. To execute this command you must be a superuser.

When a directory alias is deleted, the corresponding physical file system directory is not affected. The file system directory must be deleted using the appropriate operating system commands.

Parameters

*name*

The name of a directory alias to be removed.

Examples

Remove the directory alias named empdir:

DROP DIRECTORY empdir;

See Also

[CREATE DIRECTORY](#_CREATE_DIRECTORY)

<span id="_DROP_FUNCTION" class="anchor"></span>

###  DROP FUNCTION

Name

DROP FUNCTION -- remove a function

Synopsis

DROP FUNCTION *name*

\[ (\[ \[ *argmode* \] \[ *argname* \] *argtype* \] \[, ...\]) \]

Description

DROP FUNCTION removes the definition of an existing function. To execute this command you must be a superuser or the owner of the function. All input (IN, IN OUT) argument data types to the function must be specified if there is at least one input argument. (This requirement is not Oracle compatible. In Oracle, only the function name is specified. Postgres Plus Advanced Server allows overloading of function names, so the function signature given by the input argument data types is required in the Postgres Plus Advanced Server DROP FUNCTION command.)

Parameters

*name*

The name (optionally schema-qualified) of an existing function.

*argmode*

The mode of an argument: IN, IN OUT, or OUT. If omitted, the default is IN. Note that DROP FUNCTION does not actually pay any attention to OUT arguments, since only the input arguments are needed to determine the function’s identity. So it is sufficient to list only the IN and IN OUT arguments. (Specification of *argmode* is not Oracle compatible and applies only to Postgres Plus Advanced Server.)

*argname*

The name of an argument. Note that DROP FUNCTION does not actually pay any attention to argument names, since only the argument data types are needed to determine the function’s identity. (Specification of *argname* is not Oracle compatible and applies only to Postgres Plus Advanced Server.)

*argtype*

The data type of an argument of the function. (Specification of *argtype* is not Oracle compatible and applies only to Postgres Plus Advanced Server.)

Examples

The following command removes the emp\_comp function.

DROP FUNCTION emp\_comp(NUMBER, NUMBER);

**See Also**

[CREATE FUNCTION](#_CREATE_FUNCTION)

<span id="_Ref178500676" class="anchor"></span>

### DROP INDEX

Name

DROP INDEX -- remove an index

Synopsis

DROP INDEX *name*

Description

DROP INDEX drops an existing index from the database system. To execute this command you must be a superuser or the owner of the index. If any objects depend on the index, an error will be given and the index will not be dropped.

Parameters

*name*

The name (optionally schema-qualified) of an index to remove.

Examples

This command will remove the index, name\_idx:

DROP INDEX name\_idx;

>

**See Also**

[ALTER INDEX](#_Ref178500664), [CREATE INDEX](#_CREATE_INDEX)

<span id="_DROP_PACKAGE" class="anchor"></span>

### DROP PACKAGE

Name

DROP PACKAGE -- remove a package

Synopsis

DROP PACKAGE \[ BODY \] *name*

Description

DROP PACKAGE drops an existing package. To execute this command you must be a superuser or the owner of the package. If BODY is specified, only the package body is removed – the package specification is not dropped. If BODY is omitted, both the package specification and body are removed.

Parameters

*name*

The name (optionally schema-qualified) of a package to remove.

Examples

This command will remove the emp\_admin package:

DROP PACKAGE emp\_admin;

See Also

[CREATE PACKAGE](#_CREATE_PACKAGE), [CREATE PACKAGE BODY](#_CREATE_PACKAGE_BODY)

<span id="_Ref178475597" class="anchor"></span>

### DROP PROCEDURE

Name

DROP PROCEDURE -- remove a procedure

Synopsis

DROP PROCEDURE *name*

Description

DROP PROCEDURE removes the definition of an existing procedure. To execute this command you must be a superuser or the owner of the procedure.

Parameters

*name*

The name (optionally schema-qualified) of an existing procedure.

Examples

The following command removes the select\_emp procedure.

DROP PROCEDURE select\_emp;

See Also

[CREATE PROCEDURE](#_CREATE_PROCEDURE)

<span id="_DROP_SYNONYM" class="anchor"></span>

### DROP SYNONYM

Name

DROP SYNONYM -- remove a synonym

Synopsis

DROP \[PUBLIC\] SYNONYM \[*schema*.\]*syn\_name*

Description

DROP SYNONYM deletes existing synonyms. To execute this command you must be a superuser or the owner of the synonym, and have USAGE privileges on the schema in which the synonym resides. See [Section 2.2.4](#_Synonyms_1) for additional information about synonyms.

Parameters:

*syn\_name*

> *syn\_name* is the name of the synonym. A synonym name must be unique within a schema.

*schema*

> *schema* specifies the name of the schema that the synonym resides in.

Like any other object that can be schema-qualified, you may have two synonyms with the same name in your search path. To disambiguate the name of the synonym that you are dropping, include a schema name. Unless a synonym is schema qualified in the DROP SYNONYM command, Advanced Server deletes the first instance of the synonym it finds in your search path.

You can optionally include the PUBLIC clause to drop a synonym that resides in the public schema. The Oracle-compatible DROP PUBLIC SYNONYM command drops a synonym that resides in the public schema:

> DROP PUBLIC SYNONYM *syn*\_*name*;

The following example drops the synonym, personnel:

DROP SYNONYM personnel;

<span id="_DROP_ROLE" class="anchor"></span>

### DROP ROLE

Name

DROP ROLE -- remove a database role

Synopsis

DROP ROLE *name* \[ CASCADE \]

Description

DROP ROLE removes the specified role. To drop a superuser role, you must be a superuser yourself; to drop non-superuser roles, you must have CREATEROLE privilege.

A role cannot be removed if it is still referenced in any database of the cluster; an error will be raised if so. Before dropping the role, you must drop all the objects it owns (or reassign their ownership) and revoke any privileges the role has been granted.

It is not necessary to remove role memberships involving the role; DROP ROLE automatically revokes any memberships of the target role in other roles, and of other roles in the target role. The other roles are not dropped nor otherwise affected.

Alternatively, if the only objects owned by the role belong within a schema that is owned by the role and has the same name as the role, the CASCADE option can be specified. In this case the issuer of the DROP ROLE *name* CASCADE command must be a superuser and the named role, the schema, and all objects within the schema will be deleted.

Parameters

*name*

The name of the role to remove.

CASCADE

If specified, also drops the schema owned by, and with the same name as the role (and all objects owned by the role belonging to the schema) as long as no other dependencies on the role or the schema exist.

Examples

To drop a role:

DROP ROLE admins;

**See Also**

[CREATE ROLE](#_CREATE_ROLE), [SET ROLE](#_SET_ROLE), [GRANT](#_GRANT), [REVOKE](#_REVOKE)

<span id="_DROP_SEQUENCE" class="anchor"></span>

### DROP SEQUENCE

Name

DROP SEQUENCE -- remove a sequence

Synopsis

DROP SEQUENCE *name* \[, ...\]

Description

DROP SEQUENCE removes sequence number generators. To execute this command you must be a superuser or the owner of the sequence.

Parameters

*name*

The name (optionally schema-qualified) of a sequence.

Examples

To remove the sequence, serial:

DROP SEQUENCE serial;

**See Also**

[ALTER SEQUENCE](#_ALTER_SEQUENCE), [CREATE SEQUENCE](#_Ref176073097)

<span id="_DROP_TABLE" class="anchor"></span>

### DROP TABLE

Name

DROP TABLE -- remove a table

Synopsis

DROP TABLE *name* \[CASCADE | RESTRICT | CASCADE CONSTRAINTS\]

Description

DROP TABLE removes tables from the database. Only its owner may destroy a table. To empty a table of rows, without destroying the table, use DELETE. DROP TABLE always removes any indexes, rules, triggers, and constraints that exist for the target table.

Parameters

*name*

The name (optionally schema-qualified) of the table to drop.

Include the RESTRICT keyword to specify that the server should refuse to drop the table if any objects depend on it. This is the default behavior; the DROP TABLE command will report an error if any objects depend on the table.

Include the CASCADE clause to drop any objects that depend on the table.

Include the CASCADE CONSTRAINTS clause to specify that Advanced Server should drop any dependent constraints (excluding other object types) on the specified table.

Examples

The following command drops a table named emp that has no dependencies:

DROP TABLE emp;

The outcome of a DROP TABLE command will vary depending on whether the table has any dependencies - you can control the outcome by specifying a *drop behavior.* For example, if you create two tables, orders and items, where the items table is dependent on the orders table:

CREATE TABLE orders
(order\_id int PRIMARY KEY, order\_date date, …);

CREATE TABLE items
(order\_id REFERENCES orders, quantity int, …);

Advanced Server will perform one of the following actions when dropping the orders table, depending on the drop behavior that you specify:
 - If you specify DROP TABLE orders RESTRICT, Advanced Server will report an error.
 - If you specify DROP TABLE orders CASCADE, Advanced Server will drop the orders table *and* the items table.
 - If you specify DROP TABLE orders CASCADE CONSTRAINTS, Advanced Server will drop the orders table and remove the foreign key specification from the items table, but not drop the items table.

**See Also**

[ALTER TABLE](#_ALTER_TABLE), [CREATE TABLE](#_CREATE_TABLE)

<span id="_DROP_TABLESPACE" class="anchor"></span>

### DROP TABLESPACE

Name

DROP TABLESPACE -- remove a tablespace

Synopsis

DROP TABLESPACE *tablespacename*

Description

DROP TABLESPACE removes a tablespace from the system.

A tablespace can only be dropped by its owner or a superuser. The tablespace must be empty of all database objects before it can be dropped. It is possible that objects in other databases may still reside in the tablespace even if no objects in the current database are using the tablespace.

Parameters

*tablespacename*

The name of a tablespace.

Examples

To remove tablespace employee\_space from the system:

DROP TABLESPACE employee\_space;

**See Also**

[ALTER TABLESPACE](#_ALTER_TABLESPACE)

<span id="_DROP_TRIGGER" class="anchor"></span>

### DROP TRIGGER

Name

DROP TRIGGER -- remove a trigger

Synopsis

DROP TRIGGER *name*

Description

DROP TRIGGER removes a trigger from its associated table. The command must be run by a superuser or the owner of the table on which the trigger is defined.

Parameters

*name*

The name of a trigger to remove.

Examples

Remove trigger emp\_sal\_trig:

DROP TRIGGER emp\_sal\_trig;

**See Also**

[CREATE TRIGGER](#AEN39804)

<span id="DROP_TYPE" class="anchor"></span>

### DROP TYPE

**Name**

DROP TYPE -- remove a type definition

**Synopsis**

DROP TYPE \[ BODY \] *name*

**Description**

DROP TYPE removes the type definition. To execute this command you must be a superuser or the owner of the type.

The optional BODY qualifier applies only to object type definitions, not to collection types. If BODY is specified, only the object type body is removed – the object type specification is not dropped. If BODY is omitted, both the object type specification and body are removed.

The type will not be deleted if there are other database objects dependent upon the named type.

**Parameters**

*name*

The name of a type definition to remove.

**Examples**

Drop object type addr\_obj\_typ.

DROP TYPE addr\_obj\_typ;

Drop nested table type budget\_tbl\_typ.

DROP TYPE budget\_tbl\_typ;

**See Also**

[CREATE TYPE](#CREATE_TYPE), [CREATE TYPE BODY](#_CREATE_TYPE_BODY)

<span id="_DROP_USER" class="anchor"></span>

### DROP USER

Name

DROP USER -- remove a database user account

Synopsis

DROP USER *name* \[ CASCADE \]

Description

DROP USER removes the specified user. To drop a superuser, you must be a superuser yourself; to drop non-superusers, you must have CREATEROLE privilege.

A user cannot be removed if it is still referenced in any database of the cluster; an error will be raised if so. Before dropping the user, you must drop all the objects it owns (or reassign their ownership) and revoke any privileges the user has been granted.

However, it is not necessary to remove role memberships involving the user; DROP USER automatically revokes any memberships of the target user in other roles, and of other roles in the target user. The other roles are not dropped nor otherwise affected.

Alternatively, if the only objects owned by the user belong within a schema that is owned by the user and has the same name as the user, the CASCADE option can be specified. In this case the issuer of the DROP USER *name* CASCADE command must be a superuser and the named user, the schema, and all objects within the schema will be deleted.

Parameters

*name*

The name of the user to remove.

CASCADE

If specified, also drops the schema owned by, and with the same name as the user (and all objects owned by the user belonging to the schema) as long as no other dependencies on the user or the schema exist.

Examples

To drop a user account who owns no objects nor has been granted any privileges on other objects:

DROP USER john;

To drop user account, john, who has not been granted any privileges on any objects, and does not own any objects outside of a schema named, john, that is owned by user, john:

DROP USER john CASCADE;

See Also

[CREATE USER](#_CREATE_USER), [ALTER USER](#_ALTER_USER)

<span id="_Ref175642753" class="anchor"></span>

### DROP VIEW

Name

DROP VIEW -- remove a view

Synopsis

DROP VIEW *name*

Description

DROP VIEW drops an existing view. To execute this command you must be a database superuser or the owner of the view. The named view will not be deleted if other objects are dependent upon this view (such as a view of a view).

The Oracle-compatible form of the DROP VIEW command does not support a CASCADE clause; to drop a view and it's dependencies, use the PostgreSQL-compatible form of the DROP VIEW command. For more information, see the PostgreSQL core documentation at:

> <http://www.enterprisedb.com/docs/en/9.4/pg/sql-dropview.html>

Parameters

*name*

The name (optionally schema-qualified) of the view to remove.

Examples

This command will remove the view called dept\_30:

DROP VIEW dept\_30;

See Also

[CREATE VIEW](#_CREATE_VIEW)

### EXEC

Name

EXEC

Synopsis

EXEC *function\_name* \['('\[*argument*\_*list*\]')'\]

Description

EXECUTE .

Parameters

*procedure\_name*

*procedure\_name* is the (optionally schema-qualified) function name.

*argument\_list*

> *argument\_list* specifies a comma-separated list of arguments required by the function. Note that each member of *argument\_list* corresponds to a formal argument expected by the function. Each formal argument may be an IN parameter, an OUT parameter, or an INOUT parameter.

Examples

The EXEC statement may take one of several forms, depending on the arguments required by the function:

EXEC update\_balance;
EXEC update\_balance();
EXEC update\_balance(1,2,3);

<span id="_GRANT" class="anchor"></span>

### GRANT

Name

GRANT -- define access privileges

Synopsis

GRANT { { SELECT | INSERT | UPDATE | DELETE | REFERENCES }

\[,...\] | ALL \[ PRIVILEGES \] }

ON *tablename*

TO { *username* | *groupname* | PUBLIC } \[, ...\]

\[ WITH GRANT OPTION \]

GRANT { { INSERT | UPDATE | REFERENCES } (*column* \[, ...\]) }

\[, ...\]

ON *tablename*

TO { *username* | *groupname* | PUBLIC } \[, ...\]

\[ WITH GRANT OPTION \]

GRANT { SELECT | ALL \[ PRIVILEGES \] }

ON *sequencename*

TO { *username* | *groupname* | PUBLIC } \[, ...\]

\[ WITH GRANT OPTION \]

GRANT { EXECUTE | ALL \[ PRIVILEGES \] }

ON FUNCTION *progname*

( \[ \[ *argmode* \] \[ *argname* \] *argtype* \] \[, ...\] )

TO { *username* | *groupname* | PUBLIC } \[, ...\]

\[ WITH GRANT OPTION \]

GRANT { EXECUTE | ALL \[ PRIVILEGES \] }

ON PROCEDURE *progname*

\[ ( \[ \[ *argmode* \] \[ *argname* \] *argtype* \] \[, ...\] ) \]

TO { *username* | *groupname* | PUBLIC } \[, ...\]

\[ WITH GRANT OPTION \]

GRANT { EXECUTE | ALL \[ PRIVILEGES \] }

ON PACKAGE *packagename*

TO { *username* | *groupname* | PUBLIC } \[, ...\]

\[ WITH GRANT OPTION \]

GRANT *role* \[, ...\]

TO { *username* | *groupname* | PUBLIC } \[, ...\]

\[ WITH ADMIN OPTION \]

GRANT { CONNECT | RESOURCE | DBA } \[, ...\]

TO { *username* | *groupname* } \[, ...\]

\[ WITH ADMIN OPTION \]

GRANT CREATE \[ PUBLIC \] DATABASE LINK

TO { *username* | *groupname* }

GRANT DROP PUBLIC DATABASE LINK

TO { *username* | *groupname* }

GRANT EXEMPT ACCESS POLICY

TO { *username* | *groupname* }

Description

The GRANT command has three basic variants: one that grants privileges on a database object (table, view, sequence, or program), one that grants membership in a role, and one that grants system privileges. These variants are similar in many ways, but they are different enough to be described separately.

In Postgres Plus Advanced Server, the concept of users and groups has been unified into a single type of entity called a *role*. In this context, a *user* is a role that has the LOGIN attribute – the role may be used to create a session and connect to an application. A *group* is a role that does not have the LOGIN attribute – the role may not be used to create a session or connect to an application.

A role may be a member of one or more other roles, so the traditional concept of users belonging to groups is still valid. However, with the generalization of users and groups, users may “belong” to users, groups may “belong” to groups, and groups may “belong” to users, forming a general multi-level hierarchy of roles. User names and group names share the same namespace therefore it is not necessary to distinguish whether a grantee is a user or a group in the GRANT command.

### GRANT on Database Objects

This variant of the GRANT command gives specific privileges on a database object to a role. These privileges are added to those already granted, if any.

The key word PUBLIC indicates that the privileges are to be granted to all roles, including those that may be created later. PUBLIC may be thought of as an implicitly defined group that always includes all roles. Any particular role will have the sum of privileges granted directly to it, privileges granted to any role it is presently a member of, and privileges granted to PUBLIC.

If the WITH GRANT OPTION is specified, the recipient of the privilege may in turn grant it to others. Without a grant option, the recipient cannot do that. Grant options cannot be granted to PUBLIC.

There is no need to grant privileges to the owner of an object (usually the user that created it), as the owner has all privileges by default. (The owner could, however, choose to revoke some of his own privileges for safety.) The right to drop an object or to alter its definition in any way is not described by a grantable privilege; it is inherent in the owner, and cannot be granted or revoked. The owner implicitly has all grant options for the object as well.

Depending on the type of object, the initial default privileges may include granting some privileges to PUBLIC. The default is no public access for tables and EXECUTE privilege for functions, procedures, and packages. The object owner may of course revoke these privileges. (For maximum security, issue the REVOKE in the same transaction that creates the object; then there is no window in which another user may use the object.)

The possible privileges are:

SELECT

> Allows SELECT from any column of the specified table, view, or sequence. For sequences, this privilege also allows the use of the currval function.

INSERT

> Allows INSERT of a new row into the specified table.

UPDATE

Allows UPDATE of a column of the specified table. SELECT ... FOR UPDATE also requires this privilege (besides the SELECT privilege).

DELETE

Allows DELETE of a row from the specified table.

REFERENCES

To create a foreign key constraint, it is necessary to have this privilege on both the referencing and referenced tables.

EXECUTE

Allows the use of the specified package, procedure, or function. When applied to a package, allows the use of all of the package’s public procedures, public functions, public variables, records, cursors and other public objects and object types. This is the only type of privilege that is applicable to functions, procedures, and packages.

The Postgres Plus Advanced Server syntax for granting the EXECUTE privilege is not fully Oracle compatible. Postgres Plus Advanced Server requires qualification of the program name by one of the keywords, FUNCTION, PROCEDURE, or PACKAGE whereas these keywords must be omitted in Oracle. In addition for functions, Postgres Plus Advanced Server requires all input (IN, IN OUT) argument data types after the function name (including an empty parenthesis if there are no function arguments). For procedures, all input argument data types must be specified if the procedure has one or more input arguments. In Oracle, function and procedure signatures must be omitted. This is due to the fact that all programs share the same namespace in Oracle, whereas functions, procedures, and packages have their own individual namespace in Postgres Plus Advanced Server to allow program name overloading to a certain extent.

ALL PRIVILEGES

Grant all of the available privileges at once.

The privileges required by other commands are listed on the reference page of the respective command.

<span id="_GRANT_on_Roles" class="anchor"></span>

### GRANT on Roles

This variant of the GRANT command grants membership in a role to one or more other roles. Membership in a role is significant because it conveys the privileges granted to a role to each of its members.

If the WITH ADMIN OPTION is specified, the member may in turn grant membership in the role to others, and revoke membership in the role as well. Without the admin option, ordinary users cannot do that.

Database superusers can grant or revoke membership in any role to anyone. Roles having the CREATEROLE privilege can grant or revoke membership in any role that is not a superuser.

There are three pre-defined roles that have the following meanings:

CONNECT

Granting the CONNECT role is equivalent to giving the grantee the LOGIN privilege. The grantor must have the CREATEROLE privilege.

RESOURCE

Granting the RESOURCE role is equivalent to granting the CREATE and USAGE privileges on a schema that has the same name as the grantee. This schema must exist before the grant is given. The grantor must have the privilege to grant CREATE or USAGE privileges on this schema to the grantee.

DBA

Granting the DBA role is equivalent to making the grantee a superuser. The grantor must be a superuser.

Notes

The REVOKE command is used to revoke access privileges.

When a non-owner of an object attempts to GRANT privileges on the object, the command will fail outright if the user has no privileges whatsoever on the object. As long as a privilege is available, the command will proceed, but it will grant only those privileges for which the user has grant options. The GRANT ALL PRIVILEGES forms will issue a warning message if no grant options are held, while the other forms will issue a warning if grant options for any of the privileges specifically named in the command are not held. (In principle these statements apply to the object owner as well, but since the owner is always treated as holding all grant options, the cases can never occur.)

It should be noted that database superusers can access all objects regardless of object privilege settings. This is comparable to the rights of root in a Unix system. As with root, it’s unwise to operate as a superuser except when absolutely necessary.

If a superuser chooses to issue a GRANT or REVOKE command, the command is performed as though it were issued by the owner of the affected object. In particular, privileges granted via such a command will appear to have been granted by the object owner. (For role membership, the membership appears to have been granted by the containing role itself.)

GRANT and REVOKE can also be done by a role that is not the owner of the affected object, but is a member of the role that owns the object, or is a member of a role that holds privileges WITH GRANT OPTION on the object. In this case the privileges will be recorded as having been granted by the role that actually owns the object or holds the privileges WITH GRANT OPTION.

> For example, if table t1 is owned by role g1, of which role u1 is a member, then u1 can grant privileges on t1 to u2, but those privileges will appear to have been granted directly by g1. Any other member of role g1 could revoke them later.

If the role executing GRANT holds the required privileges indirectly via more than one role membership path, it is unspecified which containing role will be recorded as having done the grant. In such cases it is best practice to use SET ROLE to become the specific role you want to do the GRANT as.

Currently, Postgres Plus Advanced Server does not support granting or revoking privileges for individual columns of a table. One possible workaround is to create a view having just the desired columns and then grant privileges to that view.

Examples

Grant insert privilege to all users on table emp:

GRANT INSERT ON emp TO PUBLIC;

Grant all available privileges to user mary on view salesemp:

GRANT ALL PRIVILEGES ON salesemp TO mary;

Note that while the above will indeed grant all privileges if executed by a superuser or the owner of emp, when executed by someone else it will only grant those permissions for which the someone else has grant options.

Grant membership in role admins to user joe:

GRANT admins TO joe;

Grant CONNECT privilege to user joe:

GRANT CONNECT TO joe;

**See Also**

[REVOKE](#_REVOKE), [SET ROLE](#_SET_ROLE)

### GRANT on System Privileges

This variant of the GRANT command gives a role the ability to perform certain *system* operations within a database. System privileges relate to the ability to create or delete certain database objects that are not necessarily within the confines of one schema. Only database superusers can grant system privileges.

CREATE \[PUBLIC\] DATABASE LINK

The CREATE \[PUBLIC\] DATABASE LINK privilege allows the specified role to create a database link. Include the PUBLIC keyword to allow the role to create public database links; omit the PUBLIC keyword to allow the specified role to create private database links.

DROP PUBLIC DATABASE LINK

The DROP PUBLIC DATABASE LINK privilege allows a role to drop a public database link. System privileges are not required to drop a private database link. A private database link may be dropped by the link owner or a database superuser.

EXEMPT ACCESS POLICY

The EXEMPT ACCESS POLICY privilege allows a role to execute a SQL command without invoking any policy function that may be associated with the target database object. That is, the role is exempt from all security policies in the database. See [Section 7.11](#dbms_rls) for information about DBMS\_RLS security policies.

The EXEMPT ACCESS POLICY privilege is not inheritable by membership to a role that has the EXEMPT ACCESS POLICY privilege. For example, the following sequence of GRANT commands does not result in user joe obtaining the EXEMPT ACCESS POLICY privilege even though joe is granted membership to the enterprisedb role, which has been granted the EXEMPT ACCESS POLICY privilege:

GRANT EXEMPT ACCESS POLICY TO enterprisedb;

GRANT enterprisedb TO joe;

The rolpolicyexempt column of the system catalog table pg\_authid is set to true if a role has the EXEMPT ACCESS POLICY privilege.

Examples

Grant CREATE PUBLIC DATABASE LINK privilege to user joe:

GRANT CREATE PUBLIC DATABASE LINK TO joe;

Grant DROP PUBLIC DATABASE LINK privilege to user joe:

GRANT DROP PUBLIC DATABASE LINK TO joe;

Grant the EXEMPT ACCESS POLICY privilege to user joe:

GRANT EXEMPT ACCESS POLICY TO joe;

**Using the ALTER ROLE Command to Assign System Privileges**

The Advanced Server ALTER ROLE command also supports syntax that you can use to assign:
 - the privilege required to create a public or private database link.
 - the privilege required to drop a public database link.
 - the EXEMPT ACCESS POLICY privilege.

The ALTER ROLE syntax is functionally equivalent to the respective Oracle compatible commands. For more information about using the ALTER ROLE command to manage database link privileges, see [Section 3.3.3](#_ALTER_ROLE), ALTER ROLE.

See Also

[REVOKE](#_REVOKE)

### INSERT

Name

INSERT -- create new rows in a table

Synopsis

INSERT INTO *table*\[@*dblink* \] \[ ( *column* \[, ...\] ) \]

{ VALUES ( { *expression* | DEFAULT } \[, ...\] )

\[ RETURNING *return\_expression* \[, ...\]

{ INTO { *record* | *variable* \[, ...\] }

| BULK COLLECT INTO *collection* \[, ...\] } \]

| *query* }

Description

INSERT allows you to insert new rows into a table. You can insert a single row at a time or several rows as a result of a query.

The columns in the target list may be listed in any order. Each column not present in the target list will be inserted using a default value, either its declared default value or null.

If the expression for each column is not of the correct data type, automatic type conversion will be attempted.

The RETURNING INTO { *record* | *variable* \[, ...\] } clause may only be specified when the INSERT command is used within an SPL program and only when the VALUES clause is used.

The RETURNING BULK COLLECT INTO *collection* \[, ...\] clause may only be specified if the INSERT command is used within an SPL program. If more than one *collection* is specified as the target of the BULK COLLECT INTO clause, then each *collection* must consist of a single, scalar field – i.e., *collection* must not be a record. *return\_expression* evaluated for each inserted row, becomes an element in *collection* starting with the first element. Any existing rows in *collection* are deleted. If the result set is empty, then *collection* will be empty.

You must have INSERT privilege to a table in order to insert into it. If you use the *query* clause to insert rows from a query, you also need to have SELECT privilege on any table used in the query.

Parameters

*table*

The name (optionally schema-qualified) of an existing table.

*dblink*

> Database link name identifying a remote database. See the CREATE DATABASE LINK command for information on database links.

*column*

The name of a column in *table*.

*expression*

An expression or value to assign to *column*.

DEFAULT

This column will be filled with its default value.

*query*

> A query (SELECT statement) that supplies the rows to be inserted. Refer to the SELECT command for a description of the syntax.

*return\_expression*

An expression that may include one or more columns from *table*. If a column name from *table* is specified in *return\_expression*, the value substituted for the column when *return\_expression* is evaluated is determined as follows:

> If the column specified in *return\_expression* is assigned a value in the INSERT command, then the assigned value is used in the evaluation of *return\_expression*.
>
> If the column specified in *return\_expression* is not assigned a value in the INSERT command and there is no default value for the column in the table’s column definition, then null is used in the evaluation of *return\_expression*.
>
> If the column specified in *return\_expression* is not assigned a value in the INSERT command and there is a default value for the column in the table’s column definition, then the default value is used in the evaluation of *return\_expression*.

*record*

A record whose field the evaluated *return\_expression* is to be assigned. The first *return\_expression* is assigned to the first field in *record*, the second *return\_expression* is assigned to the second field in *record*, etc. The number of fields in *record* must exactly match the number of expressions and the fields must be type-compatible with their assigned expressions.

*variable*

A variable to which the evaluated *return\_expression* is to be assigned. If more than one *return\_expression* and *variable* are specified, the first *return\_expression* is assigned to the first *variable*, the second *return\_expression* is assigned to the second *variable*, etc. The number of variables specified following the INTO keyword must exactly match the number of expressions following the RETURNING keyword and the variables must be type-compatible with their assigned expressions.

*collection*

A collection in which an element is created from the evaluated *return\_expression*. There can be either a single collection which may be a collection of a single field or a collection of a record type, or there may be more than one collection in which case each collection must consist of a single field. The number of return expressions must match in number and order the number of fields in all specified collections. Each corresponding *return\_expression* and *collection* field must be type-compatible.

Examples

Insert a single row into table emp:

INSERT INTO emp VALUES (8021,'JOHN','SALESMAN',7698,'22-FEB-07',1250,500,30);

In this second example, the column, comm, is omitted and therefore it will have the default value of null:

INSERT INTO emp (empno, ename, job, mgr, hiredate, sal, deptno)

VALUES (8022,'PETERS','CLERK',7698,'03-DEC-06',950,30);

The third example uses the DEFAULT clause for the hiredate and comm columns rather than specifying a value:

INSERT INTO emp VALUES (8023,'FORD','ANALYST',7566,NULL,3000,NULL,20);

This example creates a table for the department names and then inserts into the table by selecting from the dname column of the dept table:

CREATE TABLE deptnames (

deptname VARCHAR2(14)

);

INSERT INTO deptnames SELECT dname FROM dept;

### LOCK

Name

LOCK -- lock a table

Synopsis

LOCK TABLE *name* \[, ...\] IN *lockmode* MODE \[ NOWAIT \]

where *lockmode* is one of:

ROW SHARE | ROW EXCLUSIVE | SHARE | SHARE ROW EXCLUSIVE | EXCLUSIVE

Description

LOCK TABLE obtains a table-level lock, waiting if necessary for any conflicting locks to be released. If NOWAIT is specified, LOCK TABLE does not wait to acquire the desired lock: if it cannot be acquired immediately, the command is aborted and an error is emitted. Once obtained, the lock is held for the remainder of the current transaction. (There is no UNLOCK TABLE command; locks are always released at transaction end.)

When acquiring locks automatically for commands that reference tables, Postgres Plus Advanced Server always uses the least restrictive lock mode possible. LOCK TABLE provides for cases when you might need more restrictive locking. For example, suppose an application runs a transaction at the isolation level read committed and needs to ensure that data in a table remains stable for the duration of the transaction. To achieve this you could obtain SHARE lock mode over the table before querying. This will prevent concurrent data changes and ensure subsequent reads of the table see a stable view of committed data, because SHARE lock mode conflicts with the ROW EXCLUSIVE lock acquired by writers, and your LOCK TABLE name IN SHARE MODE statement will wait until any concurrent holders of ROW EXCLUSIVE mode locks commit or roll back. Thus, once you obtain the lock, there are no uncommitted writes outstanding; furthermore none can begin until you release the lock.

To achieve a similar effect when running a transaction at the isolation level serializable, you have to execute the LOCK TABLE statement before executing any data modification statement. A serializable transaction’s view of data will be frozen when its first data modification statement begins. A later LOCK TABLE will still prevent concurrent writes - but it won’t ensure that what the transaction reads corresponds to the latest committed values.

If a transaction of this sort is going to change the data in the table, then it should use SHARE ROW EXCLUSIVE lock mode instead of SHARE mode.

This ensures that only one transaction of this type runs at a time. Without this, a deadlock is possible: two transactions might both acquire SHARE mode, and then be unable to also acquire ROW EXCLUSIVE mode to actually perform their updates. (Note that a transaction’s own locks never conflict, so a transaction can acquire ROW EXCLUSIVE mode when it holds SHARE mode - but not if anyone else holds SHARE mode.) To avoid deadlocks, make sure all transactions acquire locks on the same objects in the same order, and if multiple lock modes are involved for a single object, then transactions should always acquire the most restrictive mode first.

Parameters

*name*

The name (optionally schema-qualified) of an existing table to lock.

The command LOCK TABLE a, b; is equivalent to LOCK TABLE a; LOCK TABLE b. The tables are locked one-by-one in the order specified in the LOCK TABLE command.

*lockmode*

The lock mode specifies which locks this lock conflicts with.

If no lock mode is specified, then ACCESS EXCLUSIVE, the most restrictive mode, is used. (ACCESS EXCLUSIVE is not an Oracle compatible term. In Postgres Plus Advanced Server, this mode ensures that no other transaction can access the locked table in any manner.)

NOWAIT

Specifies that LOCK TABLE should not wait for any conflicting locks to be released: if the specified lock cannot be immediately acquired without waiting, the transaction is aborted.

Notes

All forms of LOCK require UPDATE and/or DELETE privileges.

LOCK TABLE is useful only inside a transaction block since the lock is dropped as soon as the transaction ends. A LOCK TABLE command appearing outside any transaction block forms a self-contained transaction, so the lock will be dropped as soon as it is obtained.

LOCK TABLE only deals with table-level locks, and so the mode names involving ROW are all misnomers. These mode names should generally be read as indicating the intention of the user to acquire row-level locks within the locked table. Also, ROW EXCLUSIVE mode is a sharable table lock. Keep in mind that all the lock modes have identical semantics so far as LOCK TABLE is concerned, differing only in the rules about which modes conflict with which.

<span id="_REVOKE" class="anchor"></span>

### REVOKE

Name

REVOKE -- remove access privileges

Synopsis

REVOKE { { SELECT | INSERT | UPDATE | DELETE | REFERENCES }

\[,...\] | ALL \[ PRIVILEGES \] }

ON *tablename*

FROM { *username* | *groupname* | PUBLIC } \[, ...\]

\[ CASCADE | RESTRICT \]

REVOKE { SELECT | ALL \[ PRIVILEGES \] }

ON *sequencename*

FROM { *username* | *groupname* | PUBLIC } \[, ...\]

\[ CASCADE | RESTRICT \]

REVOKE { EXECUTE | ALL \[ PRIVILEGES \] }

ON FUNCTION *progname*

( \[ \[ *argmode* \] \[ *argname* \] *argtype* \] \[, ...\] )

FROM { *username* | *groupname* | PUBLIC } \[, ...\]

\[ CASCADE | RESTRICT \]

REVOKE { EXECUTE | ALL \[ PRIVILEGES \] }

ON PROCEDURE *progname*

\[ ( \[ \[ *argmode* \] \[ *argname* \] *argtype* \] \[, ...\] ) \]

FROM { *username* | *groupname* | PUBLIC } \[, ...\]

\[ CASCADE | RESTRICT \]

REVOKE { EXECUTE | ALL \[ PRIVILEGES \] }

ON PACKAGE *packagename*

FROM { *username* | *groupname* | PUBLIC } \[, ...\]

\[ CASCADE | RESTRICT \]

REVOKE *role* \[, ...\] FROM { *username* | *groupname* | PUBLIC }

\[, ...\]

\[ CASCADE | RESTRICT \]

REVOKE { CONNECT | RESOURCE | DBA } \[, ...\]

FROM { *username* | *groupname* } \[, ...\]

REVOKE CREATE \[ PUBLIC \] DATABASE LINK

FROM { *username* | *groupname* }

REVOKE DROP PUBLIC DATABASE LINK

FROM { *username* | *groupname* }

REVOKE EXEMPT ACCESS POLICY

FROM { *username* | *groupname* }

Description

The REVOKE command revokes previously granted privileges from one or more roles. The key word PUBLIC refers to the implicitly defined group of all roles.

See the description of the GRANT command for the meaning of the privilege types.

Note that any particular role will have the sum of privileges granted directly to it, privileges granted to any role it is presently a member of, and privileges granted to PUBLIC. Thus, for example, revoking SELECT privilege from PUBLIC does not necessarily mean that all roles have lost SELECT privilege on the object: those who have it granted directly or via another role will still have it.

If the privilege had been granted with the grant option, the grant option for the privilege is revoked as well as the privilege, itself.

If a user holds a privilege with grant option and has granted it to other users then the privileges held by those other users are called dependent privileges. If the privilege or the grant option held by the first user is being revoked and dependent privileges exist, those dependent privileges are also revoked if CASCADE is specified, else the revoke action will fail. This recursive revocation only affects privileges that were granted through a chain of users that is traceable to the user that is the subject of this REVOKE command. Thus, the affected users may effectively keep the privilege if it was also granted through other users.

**Note**: CASCADE is not an Oracle compatible option. By default Oracle always cascades dependent privileges, but Postgres Plus Advanced Server requires the CASCADE keyword to be explicitly given, otherwise the REVOKE command will fail.

When revoking membership in a role, GRANT OPTION is instead called ADMIN OPTION, but the behavior is similar.

Notes

A user can only revoke privileges that were granted directly by that user. If, for example, user A has granted a privilege with grant option to user B, and user B has in turned granted it to user C, then user A cannot revoke the privilege directly from C. Instead, user A could revoke the grant option from user B and use the CASCADE option so that the privilege is in turn revoked from user C. For another example, if both A and B have granted the same privilege to C, A can revoke his own grant but not B’s grant, so C will still effectively have the privilege.

When a non-owner of an object attempts to REVOKE privileges on the object, the command will fail outright if the user has no privileges whatsoever on the object. As long as some privilege is available, the command will proceed, but it will revoke only those privileges for which the user has grant options. The REVOKE ALL PRIVILEGES forms will issue a warning message if no grant options are held, while the other forms will issue a warning if grant options for any of the privileges specifically named in the command are not held. (In principle these statements apply to the object owner as well, but since the owner is always treated as holding all grant options, the cases can never occur.)

If a superuser chooses to issue a GRANT or REVOKE command, the command is performed as though it were issued by the owner of the affected object. Since all privileges ultimately come from the object owner (possibly indirectly via chains of grant options), it is possible for a superuser to revoke all privileges, but this may require use of CASCADE as stated above.

REVOKE can also be done by a role that is not the owner of the affected object, but is a member of the role that owns the object, or is a member of a role that holds privileges WITH GRANT OPTION on the object. In this case the command is performed as though it were issued by the containing role that actually owns the object or holds the privileges WITH GRANT OPTION. For example, if table t1 is owned by role g1, of which role u1 is a member, then u1 can revoke privileges on t1 that are recorded as being granted by g1. This would include grants made by u1 as well as by other members of role g1.

If the role executing REVOKE holds privileges indirectly via more than one role membership path, it is unspecified which containing role will be used to perform the command. In such cases it is best practice to use SET ROLE to become the specific role you want to do the REVOKE as. Failure to do so may lead to revoking privileges other than the ones you intended, or not revoking anything at all.

Please Note: The Advanced Server ALTER ROLE command also supports syntax that revokes the system privileges required to create a public or private database link, or exemptions from fine-grained access control policies (DBMS\_RLS). The ALTER ROLE syntax is functionally equivalent to the respective Oracle compatible REVOKE command. For more information about using the ALTER ROLE command to manage system privileges, see [Section 3.3.3](#_ALTER_ROLE), ALTER ROLE.

Examples

Revoke insert privilege for the public on table emp:

REVOKE INSERT ON emp FROM PUBLIC;

Revoke all privileges from user mary on view salesemp:

REVOKE ALL PRIVILEGES ON salesemp FROM mary;

Note that this actually means “revoke all privileges that I granted”.

Revoke membership in role admins from user joe:

REVOKE admins FROM joe;

Revoke CONNECT privilege from user joe:

REVOKE CONNECT FROM joe;

Revoke CREATE DATABASE LINK privilege from user joe:

REVOKE CREATE DATABASE LINK FROM joe;

Revoke the EXEMPT ACCESS POLICY privilege from user joe:

REVOKE EXEMPT ACCESS POLICY FROM joe;

**See Also**

[GRANT](#_GRANT), [SET ROLE](#_SET_ROLE)

<span id="_Ref177374233" class="anchor"></span>

### ROLLBACK

Name

ROLLBACK -- abort the current transaction

Synopsis

ROLLBACK \[ WORK \]

Description

ROLLBACK rolls back the current transaction and causes all the updates made by the transaction to be discarded.

Parameters

WORK

Optional key word - has no effect.

Notes

Use COMMIT to successfully terminate a transaction.

Issuing ROLLBACK when not inside a transaction does no harm.

Examples

To abort all changes:

ROLLBACK;

**See Also**

[COMMIT](#_Ref177374273), [ROLLBACK TO SAVEPOINT](#_Ref177375870), [SAVEPOINT](#_SAVEPOINT)

<span id="_Ref177375870" class="anchor"></span>

### ROLLBACK TO SAVEPOINT

Name

ROLLBACK TO SAVEPOINT -- roll back to a savepoint

Synopsis

ROLLBACK \[ WORK \] TO \[ SAVEPOINT \] *savepoint\_name*

Description

Roll back all commands that were executed after the savepoint was established. The savepoint remains valid and can be rolled back to again later, if needed.

ROLLBACK TO SAVEPOINT implicitly destroys all savepoints that were established after the named savepoint.

Parameters

*savepoint\_name*

The savepoint to which to roll back.

Notes

Specifying a savepoint name that has not been established is an error.

ROLLBACK TO SAVEPOINT is not supported within SPL programs.

Examples

To undo the effects of the commands executed savepoint depts was established:

\\set AUTOCOMMIT off

INSERT INTO dept VALUES (50, 'HR', 'NEW YORK');

SAVEPOINT depts;

INSERT INTO emp (empno, ename, deptno) VALUES (9001, 'JONES', 50);

INSERT INTO emp (empno, ename, deptno) VALUES (9002, 'ALICE', 50);

ROLLBACK TO SAVEPOINT depts;

**See Also**

[COMMIT](#_Ref177374273), [ROLLBACK](#_Ref177374233), [SAVEPOINT](#_SAVEPOINT)

<span id="_SAVEPOINT" class="anchor"></span>

### SAVEPOINT

Name

SAVEPOINT -- define a new savepoint within the current transaction

Synopsis

SAVEPOINT *savepoint\_name*

Description

SAVEPOINT establishes a new savepoint within the current transaction.

A savepoint is a special mark inside a transaction that allows all commands that are executed after it was established to be rolled back, restoring the transaction state to what it was at the time of the savepoint.

Parameters

*savepoint\_name*

The name to be given to the savepoint.

Notes

Use ROLLBACK TO SAVEPOINT to roll back to a savepoint.

Savepoints can only be established when inside a transaction block. There can be multiple savepoints defined within a transaction.

When another savepoint is established with the same name as a previous savepoint, the old savepoint is kept, though only the more recent one will be used when rolling back.

SAVEPOINT is not supported within SPL programs.

Examples

To establish a savepoint and later undo the effects of all commands executed after it was established:

\\set AUTOCOMMIT off

INSERT INTO dept VALUES (50, 'HR', 'NEW YORK');

SAVEPOINT depts;

INSERT INTO emp (empno, ename, deptno) VALUES (9001, 'JONES', 50);

INSERT INTO emp (empno, ename, deptno) VALUES (9002, 'ALICE', 50);

SAVEPOINT emps;

INSERT INTO jobhist VALUES (9001,'17-SEP-07',NULL,'CLERK',800,NULL,50,'New Hire');

INSERT INTO jobhist VALUES (9002,'20-SEP-07',NULL,'CLERK',700,NULL,50,'New Hire');

ROLLBACK TO depts;

COMMIT;

The above transaction will commit a row into the dept table, but the inserts into the emp and jobhist tables are rolled back.

**See Also**

[COMMIT](#_Ref177374273), [ROLLBACK](#_Ref177374233), [ROLLBACK TO SAVEPOINT](#_Ref177375870)

### SELECT

Name

SELECT -- retrieve rows from a table or view

Synopsis

SELECT \[ *optimizer\_hint* \] \[ ALL | DISTINCT \]

\* | *expression* \[ AS *output\_name* \] \[, ...\]

FROM *from\_item* \[, ...\]

\[ WHERE *condition* \]

\[ \[ START WITH *start\_expression* \]

CONNECT BY { PRIOR *parent\_expr* = *child\_expr* |

*child\_expr* = PRIOR *parent\_expr* }

\[ ORDER SIBLINGS BY *expression* \[ ASC | DESC \] \[, ...\] \] \]

\[ GROUP BY { *expression* | ROLLUP ( *expr\_list* ) |

CUBE ( *expr\_list* ) | GROUPING SETS ( *expr\_list* ) } \[, ...\]

\[ LEVEL \] \]

\[ HAVING *condition* \[, ...\] \]

\[ { UNION \[ ALL \] | INTERSECT | MINUS } *select* \]

\[ ORDER BY *expression* \[ ASC | DESC \] \[, ...\] \]

\[ FOR UPDATE \]

where *from\_item* can be one of:

*table\_name*\[@*dblink* \] \[ *alias* \]

( *select* ) *alias*

*from\_item* \[ NATURAL \] *join\_type* *from\_item*

\[ ON *join\_condition* | USING ( *join\_column* \[, ...\] ) \]

Description

SELECT retrieves rows from one or more tables. The general processing of SELECT is as follows:

1.  All elements in the FROM list are computed. (Each element in the FROM list is a real or virtual table.) If more than one element is specified in the FROM list, they are cross-joined together. (See FROM clause, below.)

2.  If the WHERE clause is specified, all rows that do not satisfy the condition are eliminated from the output. (See WHERE clause, below.)

3.  If the GROUP BY clause is specified, the output is divided into groups of rows that match on one or more values. If the HAVING clause is present, it eliminates groups that do not satisfy the given condition. (See GROUP BY clause and HAVING clause below.)

4.  Using the operators UNION, INTERSECT, and MINUS, the output of more than one SELECT statement can be combined to form a single result set. The UNION operator returns all rows that are in one or both of the result sets. The INTERSECT operator returns all rows that are strictly in both result sets. The MINUS operator returns the rows that are in the first result set but not in the second. In all three cases, duplicate rows are eliminated. In the case of the UNION operator, if ALL is specified then duplicates are not eliminated. (See UNION clause, INTERSECT clause, and MINUS clause below.)

5.  The actual output rows are computed using the SELECT output expressions for each selected row. (See SELECT list below.)

6.  The CONNECT BY clause is used to select data that has a hierarchical relationship. Such data has a parent-child relationship between rows. (See CONNECT BY clause.)

7.  If the ORDER BY clause is specified, the returned rows are sorted in the specified order. If ORDER BY is not given, the rows are returned in whatever order the system finds fastest to produce. (See ORDER BY clause below.)

8.  DISTINCT eliminates duplicate rows from the result. ALL (the default) will return all candidate rows, including duplicates. (See DISTINCT clause below.)

9.  The FOR UPDATE clause causes the SELECT statement to lock the selected rows against concurrent updates. (See FOR UPDATE clause below.)

You must have SELECT privilege on a table to read its values. The use of FOR UPDATE requires UPDATE privilege as well.

Parameters

*optimizer\_hint*

Comment-embedded hints to the optimizer for selection of an execution plan. See [Section 3.4](#_Optimizer_Hints_2) for information about optimizer hints.

The remaining parameters are discussed within the following sections.

####

#### FROM Clause

The FROM clause specifies one or more source tables for the SELECT. If multiple sources are specified, the result is the Cartesian product (cross join) of all the sources. Usually qualification conditions are added to restrict the returned rows to a small subset of the Cartesian product.

The FROM clause can contain the following elements:

*table\_name*\[@*dblink* \]

> The name (optionally schema-qualified) of an existing table or view. *dblink* is a database link name identifying a remote database. See the CREATE DATABASE LINK command for information on database links.

*alias*

A substitute name for the FROM item containing the alias. An alias is used for brevity or to eliminate ambiguity for self-joins (where the same table is scanned multiple times). When an alias is provided, it completely hides the actual name of the table or function; for example given FROM foo AS f, the remainder of the SELECT must refer to this FROM item as f not foo.

*select*

A sub-SELECT can appear in the FROM clause. This acts as though its output were created as a temporary table for the duration of this single SELECT command. Note that the sub-SELECT must be surrounded by parentheses, and an alias must be provided for it.

*join\_type*

One of

\[ INNNER \] JOIN

LEFT \[ OUTER \] JOIN

RIGHT \[ OUTER \] JOIN

FULL \[ OUTER \] JOIN

CROSS JOIN

For the INNER and OUTER join types, a join condition must be specified, namely exactly one of NATURAL, ON *join\_condition*, or USING (join\_column \[, ...\] ). See below for the meaning. For CROSS JOIN, none of these clauses may appear.

A JOIN clause combines two FROM items. Use parentheses if necessary to determine the order of nesting. In the absence of parentheses, JOINs nest left-to-right. In any case JOIN binds more tightly than the commas separating FROM items.

CROSS JOIN and INNER JOIN produce a simple Cartesian product, the same result as you get from listing the two items at the top level of FROM, but restricted by the join condition (if any). CROSS JOIN is equivalent to INNER JOIN ON (TRUE), that is, no rows are removed by qualification. These join types are just a notational convenience, since they do nothing you couldn’t do with plain FROM and WHERE.

LEFT OUTER JOIN returns all rows in the qualified Cartesian product (i.e., all combined rows that pass its join condition), plus one copy of each row in the left-hand table for which there was no right-hand row that passed the join condition. This left-hand row is extended to the full width of the joined table by inserting null values for the right-hand columns. Note that only the JOIN clause’s own condition is considered while deciding which rows have matches. Outer conditions are applied afterwards.

Conversely, RIGHT OUTER JOIN returns all the joined rows, plus one row for each unmatched right-hand row (extended with nulls on the left). This is just a notational convenience, since you could convert it to a LEFT OUTER JOIN by switching the left and right inputs.

FULL OUTER JOIN returns all the joined rows, plus one row for each unmatched left-hand row (extended with nulls on the right), plus one row for each unmatched right-hand row (extended with nulls on the left).

ON *join\_condition*

*join\_condition* is an expression resulting in a value of type BOOLEAN (similar to a WHERE clause) that specifies which rows in a join are considered to match.

USING (*join\_column* \[, ...\] )

A clause of the form USING (a, b, ... ) is shorthand for ON left\_table.a = right\_table.a AND left\_table.b = right\_table.b .... Also, USING implies that only one of each pair of equivalent columns will be included in the join output, not both.

NATURAL

NATURAL is shorthand for a USING list that mentions all columns in the two tables that have the same names.

#### WHERE Clause

The optional WHERE clause has the general form

WHERE *condition*

where *condition* is any expression that evaluates to a result of type BOOLEAN. Any row that does not satisfy this condition will be eliminated from the output. A row satisfies the condition if it returns TRUE when the actual row values are substituted for any variable references.

#### GROUP BY Clause

The optional GROUP BY clause has the general form

GROUP BY { *expression* | ROLLUP ( *expr\_list* ) |

CUBE ( *expr\_list* ) | GROUPING SETS ( *expr\_list* ) } \[, ...\]

GROUP BY will condense into a single row all selected rows that share the same values for the grouped expressions. *expression* can be an input column name, or the name or ordinal number of an output column (SELECT list item), or an arbitrary expression formed from input-column values. In case of ambiguity, a GROUP BY name will be interpreted as an input-column name rather than an output column name.

ROLLUP, CUBE, and GROUPING SETS are extensions to the GROUP BY clause for supporting multidimensional analysis. See Section <span class="underline"></span>3.3.59.4 for information on using these extensions.

Aggregate functions, if any are used, are computed across all rows making up each group, producing a separate value for each group (whereas without GROUP BY, an aggregate produces a single value computed across all the selected rows). When GROUP BY is present, it is not valid for the SELECT list expressions to refer to ungrouped columns except within aggregate functions, since there would be more than one possible value to return for an ungrouped column.

#### HAVING Clause

The optional HAVING clause has the general form

HAVING *condition*

where *condition* is the same as specified for the WHERE clause.

HAVING eliminates group rows that do not satisfy the condition. HAVING is different from WHERE; WHERE filters individual rows before the application of GROUP BY, while HAVING filters group rows created by GROUP BY. Each column referenced in condition must unambiguously reference a grouping column, unless the reference appears within an aggregate function.

#### SELECT List

The SELECT list (between the key words SELECT and FROM) specifies expressions that form the output rows of the SELECT statement. The expressions can (and usually do) refer to columns computed in the FROM clause. Using the clause AS *output\_name*, another name can be specified for an output column. This name is primarily used to label the column for display. It can also be used to refer to the column’s value in ORDER BY and GROUP BY clauses, but not in the WHERE or HAVING clauses; there you must write out the expression instead.

Instead of an expression, \* can be written in the output list as a shorthand for all the columns of the selected rows.

#### UNION Clause

The UNION clause has this general form:

*select\_statement* UNION \[ ALL \] *select\_statement*

*select\_statement* is any SELECT statement without an ORDER BY or FOR UPDATE clause. (ORDER BY can be attached to a sub-expression if it is enclosed in parentheses. Without parentheses, these clauses will be taken to apply to the result of the UNION, not to its right-hand input expression.)

The UNION operator computes the set union of the rows returned by the involved SELECT statements. A row is in the set union of two result sets if it appears in at least one of the result sets. The two SELECT statements that represent the direct operands of the UNION must produce the same number of columns, and corresponding columns must be of compatible data types.

The result of UNION does not contain any duplicate rows unless the ALL option is specified. ALL prevents elimination of duplicates.

Multiple UNION operators in the same SELECT statement are evaluated left to right, unless otherwise indicated by parentheses.

Currently, FOR UPDATE may not be specified either for a UNION result or for any input of a UNION.

#### INTERSECT Clause

The INTERSECT clause has this general form:

*select\_statement* INTERSECT *select\_statement*

*select\_statement* is any SELECT statement without an ORDER BY or FOR UPDATE clause.

The INTERSECT operator computes the set intersection of the rows returned by the involved SELECT statements. A row is in the intersection of two result sets if it appears in both result sets.

The result of INTERSECT does not contain any duplicate rows.

Multiple INTERSECT operators in the same SELECT statement are evaluated left to right, unless parentheses dictate otherwise. INTERSECT binds more tightly than UNION. That is, A UNION B INTERSECT C will be read as A UNION (B INTERSECT C).

#### MINUS Clause

The MINUS clause has this general form:

*select\_statement* MINUS *select\_statement*

*select\_statement* is any SELECT statement without an ORDER BY or FOR UPDATE clause.

The MINUS operator computes the set of rows that are in the result of the left SELECT statement but not in the result of the right one.

The result of MINUS does not contain any duplicate rows.

Multiple MINUS operators in the same SELECT statement are evaluated left to right, unless parentheses dictate otherwise. MINUS binds at the same level as UNION.

#### CONNECT BY Clause

The CONNECT BY clause determines the parent-child relationship of rows when performing a hierarchical query. It has the general form:

CONNECT BY { PRIOR *parent\_expr* = *child\_expr* |

*child\_expr* = PRIOR *parent\_expr* }

*parent\_expr* is evaluated on a candidate parent row. If *parent\_expr* = *child\_expr* results in TRUE for a row returned by the FROM clause, then this row is considered a child of the parent.

The following optional clauses may be specified in conjunction with the CONNECT BY clause:

START WITH *start\_expression*

The rows returned by the FROM clause on which *start\_expression* evaluates to TRUE become the root nodes of the hierarchy.

ORDER SIBLINGS BY *expression* \[ ASC | DESC \] \[, ...\]

Sibling rows of the hierarchy are ordered by *expression* in the result set.

**Note**: Advanced Server does not support the use of AND (or other operators) in the CONNECT BY clause.

(See Section [2.2.5](#hierarchical-queries) for additional information on hierarchical queries.)

#### ORDER BY Clause

The optional ORDER BY clause has this general form:

ORDER BY *expression* \[ ASC | DESC \] \[, ...\]

*expression* can be the name or ordinal number of an output column (SELECT list item), or it can be an arbitrary expression formed from input-column values.

The ORDER BY clause causes the result rows to be sorted according to the specified expressions. If two rows are equal according to the leftmost expression, they are compared according to the next expression and so on. If they are equal according to all specified expressions, they are returned in an implementation-dependent order.

The ordinal number refers to the ordinal (left-to-right) position of the result column. This feature makes it possible to define an ordering on the basis of a column that does not have a unique name. This is never absolutely necessary because it is always possible to assign a name to a result column using the AS clause.

It is also possible to use arbitrary expressions in the ORDER BY clause, including columns that do not appear in the SELECT result list. Thus the following statement is valid:

SELECT ename FROM emp ORDER BY empno;

A limitation of this feature is that an ORDER BY clause applying to the result of a UNION, INTERSECT, or MINUS clause may only specify an output column name or number, not an expression.

If an ORDER BY expression is a simple name that matches both a result column name and an input column name, ORDER BY will interpret it as the result column name. This is the opposite of the choice that GROUP BY will make in the same situation. This inconsistency is made to be compatible with the SQL standard.

Optionally one may add the key word ASC (ascending) or DESC (descending) after any expression in the ORDER BY clause. If not specified, ASC is assumed by default.

The null value sorts higher than any other value. In other words, with ascending sort order, null values sort at the end, and with descending sort order, null values sort at the beginning.

Character-string data is sorted according to the locale-specific collation order that was established when the database cluster was initialized.

#### DISTINCT Clause

If DISTINCT is specified, all duplicate rows are removed from the result set (one row is kept from each group of duplicates). ALL specifies the opposite: all rows are kept; that is the default.

#### FOR UPDATE Clause

The FOR UPDATE clause has this form:

FOR UPDATE

FOR UPDATE causes the rows retrieved by the SELECT statement to be locked as though for update. This prevents them from being modified or deleted by other transactions until the current transaction ends. That is, other transactions that attempt UPDATE, DELETE, or SELECT FOR UPDATE of these rows will be blocked until the current transaction ends. Also, if an UPDATE, DELETE, or SELECT FOR UPDATE from another transaction has already locked a selected row or rows, SELECT FOR UPDATE will wait for the other transaction to complete, and will then lock and return the updated row (or no row, if the row was deleted).

FOR UPDATE cannot be used in contexts where returned rows can’t be clearly identified with individual table rows; for example it can't be used with aggregation.

Examples

To join table, dept with table, emp:

SELECT d.deptno, d.dname, e.empno, e.ename, e.mgr, e.hiredate

FROM emp e, dept d

WHERE d.deptno = e.deptno;

deptno | dname | empno | ename | mgr | hiredate

\--------+------------+-------+--------+------+--------------------

10 | ACCOUNTING | 7934 | MILLER | 7782 | 23-JAN-82 00:00:00

10 | ACCOUNTING | 7782 | CLARK | 7839 | 09-JUN-81 00:00:00

10 | ACCOUNTING | 7839 | KING | | 17-NOV-81 00:00:00

20 | RESEARCH | 7788 | SCOTT | 7566 | 19-APR-87 00:00:00

20 | RESEARCH | 7566 | JONES | 7839 | 02-APR-81 00:00:00

20 | RESEARCH | 7369 | SMITH | 7902 | 17-DEC-80 00:00:00

20 | RESEARCH | 7876 | ADAMS | 7788 | 23-MAY-87 00:00:00

20 | RESEARCH | 7902 | FORD | 7566 | 03-DEC-81 00:00:00

30 | SALES | 7521 | WARD | 7698 | 22-FEB-81 00:00:00

30 | SALES | 7844 | TURNER | 7698 | 08-SEP-81 00:00:00

30 | SALES | 7499 | ALLEN | 7698 | 20-FEB-81 00:00:00

30 | SALES | 7698 | BLAKE | 7839 | 01-MAY-81 00:00:00

30 | SALES | 7654 | MARTIN | 7698 | 28-SEP-81 00:00:00

30 | SALES | 7900 | JAMES | 7698 | 03-DEC-81 00:00:00

(14 rows)

To sum the column, sal of all employees and group the results by department number:

SELECT deptno, SUM(sal) AS total

FROM emp

GROUP BY deptno;

deptno | total

\--------+----------

10 | 8750.00

20 | 10875.00

30 | 9400.00

(3 rows)

To sum the column, sal of all employees, group the results by department number and show those group totals that are less than 10000:

SELECT deptno, SUM(sal) AS total

FROM emp

GROUP BY deptno

HAVING SUM(sal) \< 10000;

deptno | total

\--------+---------

10 | 8750.00

30 | 9400.00

(2 rows)

The following two examples are identical ways of sorting the individual results according to the contents of the second column (dname):

SELECT \* FROM dept ORDER BY dname;

deptno | dname | loc

\--------+------------+----------

10 | ACCOUNTING | NEW YORK

40 | OPERATIONS | BOSTON

20 | RESEARCH | DALLAS

30 | SALES | CHICAGO

(4 rows)

SELECT \* FROM dept ORDER BY 2;

deptno | dname | loc

\--------+------------+----------

10 | ACCOUNTING | NEW YORK

40 | OPERATIONS | BOSTON

20 | RESEARCH | DALLAS

30 | SALES | CHICAGO

(4 rows)

### SET CONSTRAINTS

Name

SET CONSTRAINTS -- set constraint checking modes for the current transaction

Synopsis

SET CONSTRAINTS { ALL | *name* \[, ...\] } { DEFERRED | IMMEDIATE }

Description

SET CONSTRAINTS sets the behavior of constraint checking within the current transaction. IMMEDIATE constraints are checked at the end of each statement. DEFERRED constraints are not checked until transaction commit. Each constraint has its own IMMEDIATE or DEFERRED mode.

Upon creation, a constraint is given one of three characteristics: DEFERRABLE INITIALLY DEFERRED, DEFERRABLE INITIALLY IMMEDIATE, or NOT DEFERRABLE. The third class is always IMMEDIATE and is not affected by the SET CONSTRAINTS command. The first two classes start every transaction in the indicated mode, but their behavior can be changed within a transaction by SET CONSTRAINTS.

SET CONSTRAINTS with a list of constraint names changes the mode of just those constraints (which must all be deferrable). If there are multiple constraints matching any given name, all are affected. SET CONSTRAINTS ALL changes the mode of all deferrable constraints.

When SET CONSTRAINTS changes the mode of a constraint from DEFERRED to IMMEDIATE, the new mode takes effect retroactively: any outstanding data modifications that would have been checked at the end of the transaction are instead checked during the execution of the SET CONSTRAINTS command. If any such constraint is violated, the SET CONSTRAINTS fails (and does not change the constraint mode). Thus, SET CONSTRAINTS can be used to force checking of constraints to occur at a specific point in a transaction.

Currently, only foreign key constraints are affected by this setting. Check and unique constraints are always effectively not deferrable.

Notes

This command only alters the behavior of constraints within the current transaction. Thus, if you execute this command outside of a transaction block it will not appear to have any effect.

<span id="_SET_ROLE" class="anchor"></span>

### SET ROLE

Name

SET ROLE -- set the current user identifier of the current session

Synopsis

SET ROLE { *rolename* | NONE }

Description

This command sets the current user identifier of the current SQL session context to be *rolename*. After SET ROLE, permissions checking for SQL commands is carried out as though the named role were the one that had logged in originally.

The specified *rolename* must be a role that the current session user is a member of. (If the session user is a superuser, any role can be selected.)

NONE resets the current user identifier to be the current session user identifier. These forms may be executed by any user.

Notes

Using this command, it is possible to either add privileges or restrict one’s privileges. If the session user role has the INHERITS attribute, then it automatically has all the privileges of every role that it could SET ROLE to; in this case SET ROLE effectively drops all the privileges assigned directly to the session user and to the other roles it is a member of, leaving only the privileges available to the named role. On the other hand, if the session user role has the NOINHERITS attribute, SET ROLE drops the privileges assigned directly to the session user and instead acquires the privileges available to the named role. In particular, when a superuser chooses to SET ROLE to a non-superuser role, she loses her superuser privileges.

Examples

User mary takes on the identity of role admins:

SET ROLE admins;

User mary reverts back to her own identity:

SET ROLE NONE;

### SET TRANSACTION

Name

SET TRANSACTION -- set the characteristics of the current transaction

Synopsis

SET TRANSACTION *transaction\_mode*

where *transaction\_mode* is one of:

ISOLATION LEVEL { SERIALIZABLE | READ COMMITTED }

READ WRITE | READ ONLY

Description

The SET TRANSACTION command sets the characteristics of the current transaction. It has no effect on any subsequent transactions. The available transaction characteristics are the transaction isolation level and the transaction access mode (read/write or read-only). The isolation level of a transaction determines what data the transaction can see when other transactions are running concurrently:

READ COMMITTED

A statement can only see rows committed before it began. This is the default.

SERIALIZABLE

All statements of the current transaction can only see rows committed before the first query or data-modification statement was executed in this transaction.

The transaction isolation level cannot be changed after the first query or data-modification statement (SELECT, INSERT, DELETE, UPDATE, or FETCH) of a transaction has been executed. The transaction access mode determines whether the transaction is read/write or read-only. Read/write is the default.

When a transaction is read-only, the following SQL commands are disallowed: INSERT, UPDATE, and DELETE if the table they would write to is not a temporary table; all CREATE, ALTER, and DROP commands; COMMENT, GRANT, REVOKE, TRUNCATE; and EXECUTE if the command it would execute is among those listed. This is a high-level notion of read-only that does not prevent all writes to disk.

<span id="_TRUNCATE" class="anchor"></span>

### TRUNCATE

Name

TRUNCATE -- empty a table

Synopsis

TRUNCATE TABLE *name* \[DROP STORAGE\]

Description

TRUNCATE quickly removes all rows from a table. It has the same effect as an unqualified DELETE but since it does not actually scan the table, it is faster. This is most useful on large tables.

The DROP STORAGE clause is accepted for compatibility, but is ignored.

Parameters

*name*

The name (optionally schema-qualified) of the table to be truncated.

Notes

TRUNCATE cannot be used if there are foreign-key references to the table from other tables. Checking validity in such cases would require table scans, and the whole point is not to do one.

TRUNCATE will not run any user-defined ON DELETE triggers that might exist for the table.

Examples

Truncate the table bigtable:

TRUNCATE TABLE bigtable;

See Also

[DROP VIEW](#_Ref175642753), [DELETE](#_DELETE)

### UPDATE

Name

UPDATE -- update rows of a table

Synopsis

UPDATE \[ *optimizer\_hint* \] *table*\[@*dblink* \]

SET *column* = { *expression* | DEFAULT } \[, ...\]

\[ WHERE *condition* \]

\[ RETURNING *return\_expression* \[, ...\]

{ INTO { *record* | *variable* \[, ...\] }

| BULK COLLECT INTO *collection* \[, ...\] } \]

Description

UPDATE changes the values of the specified columns in all rows that satisfy the condition. Only the columns to be modified need be mentioned in the SET clause; columns not explicitly modified retain their previous values.

The RETURNING INTO { *record* | *variable* \[, ...\] } clause may only be specified within an SPL program. In addition the result set of the UPDATE command must not return more than one row, otherwise an exception is thrown. If the result set is empty, then the contents of the target record or variables are set to null.

The RETURNING BULK COLLECT INTO *collection* \[, ...\] clause may only be specified if the UPDATE command is used within an SPL program. If more than one *collection* is specified as the target of the BULK COLLECT INTO clause, then each *collection* must consist of a single, scalar field – i.e., *collection* must not be a record. The result set of the UPDATE command may contain none, one, or more rows. *return\_expression* evaluated for each row of the result set, becomes an element in *collection* starting with the first element. Any existing rows in *collection* are deleted. If the result set is empty, then *collection* will be empty.

You must have the UPDATE privilege on the table to update it, as well as the SELECT privilege to any table whose values are read in expression or *condition*.

Parameters

*optimizer\_hint*

Comment-embedded hints to the optimizer for selection of an execution plan. See [Section 3.4](#_Optimizer_Hints_3) for information on optimizer hints.

*table*

The name (optionally schema-qualified) of the table to update.

*dblink*

> Database link name identifying a remote database. See the CREATE DATABASE LINK for information on database links.

*column*

The name of a column in table.

*expression*

An expression to assign to the column. The expression may use the old values of this and other columns in the table.

DEFAULT

Set the column to its default value (which will be null if no specific default expression has been assigned to it).

*condition*

An expression that returns a value of type BOOLEAN. Only rows for which this expression returns true will be updated.

*return\_expression*

An expression that may include one or more columns from table. If a column name from table is specified in *return\_expression*, the value substituted for the column when *return\_expression* is evaluated is determined as follows:

> If the column specified in *return\_expression* is assigned a value in the UPDATE command, then the assigned value is used in the evaluation of *return\_expression*.
>
> If the column specified in *return\_expression* is not assigned a value in the UPDATE command, then the column’s current value in the affected row is used in the evaluation of *return\_expression*.

*record*

A record whose field the evaluated *return\_expression* is to be assigned. The first *return\_expression* is assigned to the first field in *record*, the second *return\_expression* is assigned to the second field in *record*, etc. The number of fields in *record* must exactly match the number of expressions and the fields must be type-compatible with their assigned expressions.

*variable*

A variable to which the evaluated *return\_expression* is to be assigned. If more than one *return\_expression* and *variable* are specified, the first *return\_expression* is assigned to the first *variable*, the second *return\_expression* is assigned to the second *variable*, etc. The number of variables specified following the INTO keyword must exactly match the number of expressions following the RETURNING keyword and the variables must be type-compatible with their assigned expressions.

*collection*

A collection in which an element is created from the evaluated *return\_expression*. There can be either a single collection which may be a collection of a single field or a collection of a record type, or there may be more than one collection in which case each collection must consist of a single field. The number of return expressions must match in number and order the number of fields in all specified collections. Each corresponding *return\_expression* and *collection* field must be type-compatible.

Examples

Change the location to AUSTIN for department 20 in the dept table:

UPDATE dept SET loc = 'AUSTIN' WHERE deptno = 20;

For all employees with job = SALESMAN in the emp table, update the salary by 10% and increase the commission by 500.

UPDATE emp SET sal = sal \* 1.1, comm = comm + 500 WHERE job = 'SALESMAN';

## Optimizer Hints

When you invoke a DELETE, INSERT, SELECT or UPDATE command, the server generates a set of execution plans; after analyzing those execution plans, the server selects a plan that will (generally) return the result set in the least amount of time. The server's choice of plan is dependent upon several factors:
 - The estimated execution cost of data handling operations.
 - Parameter values assigned to parameters in the Query Tuning section of the postgresql.conf file.
 - Column statistics that have been gathered by the [ANALYZE](http://www.enterprisedb.com/docs/en/9.3/pg/sql-analyze.html) command.

As a rule, the query planner will select the least expensive plan. You can use an *optimizer* *hint* to influence the server as it selects a query plan.

An optimizer hint is a directive (or multiple directives) embedded in a comment-like syntax that immediately follows a DELETE, INSERT, SELECT or UPDATE command. Keywords in the comment instruct the server to employ or avoid a specific plan when producing the result set.

Synopsis

{ DELETE | INSERT | SELECT | UPDATE } /\*+ { *hint* \[ *comment* \] } \[...\] \*/

*statement\_body*

{ DELETE | INSERT | SELECT | UPDATE } --+ { *hint* \[ *comment* \] } \[...\]

*statement\_body*

Optimizer hints may be included in either of the forms shown above. Note that in both forms, a plus sign (+) must immediately follow the /\* or -- opening comment symbols, with no intervening space, or the server will not interpret the following tokens as hints.

If you are using the first form, the hint and optional comment may span multiple lines. The second form requires all hints and comments to occupy a single line; the remainder of the statement must start on a new line.

Description

Please Note:
 - The database server will always try to use the specified hints if at all possible.
 - If a planner method parameter is set so as to disable a certain plan type, then this plan will not be used even if it is specified in a hint, unless there are no other possible options for the planner. Examples of planner method parameters are enable\_indexscan, enable\_seqscan, enable\_hashjoin, enable\_mergejoin, and enable\_nestloop. These are all Boolean parameters.
 - Remember that the hint is embedded within a comment. As a consequence, if the hint is misspelled or if any parameter to a hint such as view, table, or column name is misspelled, or non-existent in the SQL command, there will be no indication that any sort of error has occurred. No syntax error will be given and the entire hint is simply ignored.
 - If an alias is used for a table or view name in the SQL command, then the alias name, not the original object name, must be used in the hint. For example, in the command, SELECT /\*+ FULL(acct) \*/ \* FROM accounts acct ..., acct, the alias for accounts, must be specified in the FULL hint, not the table name, accounts.
 - Use the EXPLAIN command to ensure that the hint is correctly formed and the planner is using the hint. See the *Postgres Plus* documentation set for information on the EXPLAIN command.
 - In general, optimizer hints should not be used in production applications. Typically, the table data changes throughout the life of the application. By ensuring that the more dynamic columns are ANALYZEd frequently, the column statistics will be updated to reflect value changes and the planner will use such information to produce the least cost plan for any given command execution. Use of optimizer hints defeats the purpose of this process and will result in the same plan regardless of how the table data changes.

Parameters

*hint*

An optimizer hint directive.

*comment*

A string with additional information. Note that there are restrictions as to what characters may be included in the comment. Generally, *comment* may only consist of alphabetic, numeric, the underscore, dollar sign, number sign and space characters. These must also conform to the syntax of an identifier. See Section <span class="underline"></span>3.1.2 for more information on identifiers. Any subsequent hint will be ignored if the comment is not in this form.

*statement\_body*

The remainder of the DELETE, INSERT, SELECT, or UPDATE command.

The following sections describe the optimizer hint directives in more detail.

### Default Optimization Modes

There are a number of optimization modes that can be chosen as the default setting for a Postgres Plus Advanced Server database cluster. This setting can also be changed on a per session basis by using the ALTER SESSION command as well as in individual DELETE, SELECT, and UPDATE commands within an optimizer hint. The configuration parameter that controls these default modes is named OPTIMIZER\_MODE. The following table shows the possible values.

Table 3‑3‑10 Default Optimization Modes

|                   |                                                                                                                                                                                                                        |
| ----------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Hint              | Description                                                                                                                                                                                                            |
| ALL\_ROWS         | Optimizes for retrieval of all rows of the result set.                                                                                                                                                                 |
| CHOOSE            | Does no default optimization based on assumed number of rows to be retrieved from the result set. This is the default.                                                                                                 |
| FIRST\_ROWS       | Optimizes for retrieval of only the first row of the result set.                                                                                                                                                       |
| FIRST\_ROWS\_10   | Optimizes for retrieval of the first 10 rows of the results set.                                                                                                                                                       |
| FIRST\_ROWS\_100  | Optimizes for retrieval of the first 100 rows of the result set.                                                                                                                                                       |
| FIRST\_ROWS\_1000 | Optimizes for retrieval of the first 1000 rows of the result set.                                                                                                                                                      |
| FIRST\_ROWS(*n*)  | Optimizes for retrieval of the first *n* rows of the result set. This form may not be used as the object of the ALTER SESSION SET OPTIMIZER\_MODE command. It may only be used in the form of a hint in a SQL command. |

These optimization modes are based upon the assumption that the client submitting the SQL command is interested in viewing only the first “n” rows of the result set and will then abandon the remainder of the result set. Resources allocated to the query are adjusted as such.

Examples

Alter the current session to optimize for retrieval of the first 10 rows of the result set.

ALTER SESSION SET OPTIMIZER\_MODE = FIRST\_ROWS\_10;

The current value of the OPTIMIZER\_MODE parameter can be shown by using the SHOW command. Note that this command is a utility dependent command. In PSQL, the SHOW command is used as follows:

SHOW OPTIMIZER\_MODE;

optimizer\_mode

\----------------

first\_rows\_10

(1 row)

The Oracle compatible SHOW command has the following syntax:

SHOW PARAMETER OPTIMIZER\_MODE;

NAME

\--------------------------------------------------

VALUE

\--------------------------------------------------

optimizer\_mode

first\_rows\_10

The following example shows an optimization mode used in a SELECT command as a hint:

SELECT /\*+ FIRST\_ROWS(7) \*/ \* FROM emp;

empno | ename | job | mgr | hiredate | sal | comm | deptno

\-------+--------+-----------+------+--------------------+---------+---------+--------

7369 | SMITH | CLERK | 7902 | 17-DEC-80 00:00:00 | 800.00 | | 20

7499 | ALLEN | SALESMAN | 7698 | 20-FEB-81 00:00:00 | 1600.00 | 300.00 | 30

7521 | WARD | SALESMAN | 7698 | 22-FEB-81 00:00:00 | 1250.00 | 500.00 | 30

7566 | JONES | MANAGER | 7839 | 02-APR-81 00:00:00 | 2975.00 | | 20

7654 | MARTIN | SALESMAN | 7698 | 28-SEP-81 00:00:00 | 1250.00 | 1400.00 | 30

7698 | BLAKE | MANAGER | 7839 | 01-MAY-81 00:00:00 | 2850.00 | | 30

7782 | CLARK | MANAGER | 7839 | 09-JUN-81 00:00:00 | 2450.00 | | 10

7788 | SCOTT | ANALYST | 7566 | 19-APR-87 00:00:00 | 3000.00 | | 20

7839 | KING | PRESIDENT | | 17-NOV-81 00:00:00 | 5000.00 | | 10

7844 | TURNER | SALESMAN | 7698 | 08-SEP-81 00:00:00 | 1500.00 | 0.00 | 30

7876 | ADAMS | CLERK | 7788 | 23-MAY-87 00:00:00 | 1100.00 | | 20

7900 | JAMES | CLERK | 7698 | 03-DEC-81 00:00:00 | 950.00 | | 30

7902 | FORD | ANALYST | 7566 | 03-DEC-81 00:00:00 | 3000.00 | | 20

7934 | MILLER | CLERK | 7782 | 23-JAN-82 00:00:00 | 1300.00 | | 10

(14 rows)

### Access Method Hints

The following hints influence how the optimizer accesses relations to create the result set.

Table 3‑3‑11 Access Method Hints

|                                          |                                                       |
| ---------------------------------------- | ----------------------------------------------------- |
| Hint                                     | Description                                           |
| FULL(*table*)                            | Perform a full sequential scan on *table*.            |
| INDEX(*table* \[ *index* \] \[...\])     | Use *index* on *table* to access the relation.        |
| NO\_INDEX(*table* \[ *index* \] \[...\]) | Do not use *index* on *table* to access the relation. |

In addition, the ALL\_ROWS, FIRST\_ROWS, and FIRST\_ROWS(*n*) hints of Table 3‑3‑10 can be used.

Examples

The sample application does not have sufficient data to illustrate the effects of optimizer hints so the remainder of the examples in this section will use a banking database created by the pgbench application located in the PostgresPlus\\9.4AS\\bin subdirectory.

The following steps create a database named, bank, populated by the tables, accounts, branches, tellers, and history. The –s 5 option specifies a scaling factor of five which results in the creation of five branches, each with 100,000 accounts, resulting in a total of 500,000 rows in the accounts table and five rows in the branches table. Ten tellers are assigned to each branch resulting in a total of 50 rows in the tellers table.

Note, if using Linux use the export command instead of the SET PATH command as shown below.

> export PATH=/opt/PostgresPlus/9.4AS/bin:$PATH

The following example was run in Windows.

SET PATH=C:\\PostgresPlus\\9.4AS\\bin;%PATH%

createdb -U enterprisedb bank

CREATE DATABASE

pgbench -i -s 5 -U enterprisedb -d bank

creating tables...

10000 tuples done.

20000 tuples done.

30000 tuples done.

.

.

.

470000 tuples done.

480000 tuples done.

490000 tuples done.

500000 tuples done.

set primary key...

vacuum...done.

Ten transactions per client are then processed for eight clients for a total of 80 transactions. This will populate the history table with 80 rows.

pgbench –U enterprisedb –d bank –c 8 –t 10

.

.

.

transaction type: TPC-B (sort of)

scaling factor: 5

number of clients: 8

number of transactions per client: 10

number of transactions actually processed: 80/80

tps = 6.023189 (including connections establishing)

tps = 7.140944 (excluding connections establishing)

The table definitions are shown below:

\\d accounts

Table "public.accounts"

Column | Type | Modifiers

\----------+---------------+-----------

aid | integer | not null

bid | integer |

abalance | integer |

filler | character(84) |

Indexes:

"accounts\_pkey" PRIMARY KEY, btree (aid)

\\d branches

Table "public.branches"

Column | Type | Modifiers

\----------+---------------+-----------

bid | integer | not null

bbalance | integer |

filler | character(88) |

Indexes:

"branches\_pkey" PRIMARY KEY, btree (bid)

\\d tellers

Table "public.tellers"

Column | Type | Modifiers

\----------+---------------+-----------

tid | integer | not null

bid | integer |

tbalance | integer |

filler | character(84) |

Indexes:

"tellers\_pkey" PRIMARY KEY, btree (tid)

\\d history

Table "public.history"

Column | Type | Modifiers

\--------+-----------------------------+-----------

tid | integer |

bid | integer |

aid | integer |

delta | integer |

mtime | timestamp without time zone |

filler | character(22) |

The EXPLAIN command shows the plan selected by the query planner. In the following example, aid is the primary key column, so an indexed search is used on index, accounts\_pkey.

EXPLAIN SELECT \* FROM accounts WHERE aid = 100;

QUERY PLAN

\-------------------------------------------------------------------------------

Index Scan using accounts\_pkey on accounts (cost=0.00..8.32 rows=1 width=97)

Index Cond: (aid = 100)

(2 rows)

The FULL hint is used to force a full sequential scan instead of using the index as shown below:

EXPLAIN SELECT /\*+ FULL(accounts) \*/ \* FROM accounts WHERE aid = 100;

QUERY PLAN

\-------------------------------------------------------------

Seq Scan on accounts (cost=0.00..14461.10 rows=1 width=97)

Filter: (aid = 100)

(2 rows)

The NO\_INDEX hint also forces a sequential scan as shown below:

EXPLAIN SELECT /\*+ NO\_INDEX(accounts accounts\_pkey) \*/ \* FROM accounts WHERE aid = 100;

QUERY PLAN

\-------------------------------------------------------------

Seq Scan on accounts (cost=0.00..14461.10 rows=1 width=97)

Filter: (aid = 100)

(2 rows)

In addition to using the EXPLAIN command as shown in the prior examples, more detailed information regarding whether or not a hint was used by the planner can be obtained by setting the client\_min\_messages and trace\_hints configuration parameters as follows:

SET client\_min\_messages TO info;

SET trace\_hints TO true;

The SELECT command with the NO\_INDEX hint is repeated below to illustrate the additional information produced when the aforementioned configuration parameters are set.

EXPLAIN SELECT /\*+ NO\_INDEX(accounts accounts\_pkey) \*/ \* FROM accounts WHERE aid = 100;

INFO: \[HINTS\] Index Scan of \[accounts\].\[accounts\_pkey\] rejected because of NO\_INDEX hint.

INFO: \[HINTS\] Bitmap Heap Scan of \[accounts\].\[accounts\_pkey\] rejected because of NO\_INDEX hint.

QUERY PLAN

\-------------------------------------------------------------

Seq Scan on accounts (cost=0.00..14461.10 rows=1 width=97)

Filter: (aid = 100)

(2 rows)

Note that if a hint is ignored, the INFO: \[HINTS\] line will not appear. This may be an indication that there was a syntax error or some other misspelling in the hint as shown in the following example where the index name is misspelled.

EXPLAIN SELECT /\*+ NO\_INDEX(accounts accounts\_xxx) \*/ \* FROM accounts WHERE aid = 100;

QUERY PLAN

\-------------------------------------------------------------------------------

Index Scan using accounts\_pkey on accounts (cost=0.00..8.32 rows=1

width=97)

Index Cond: (aid = 100)

(2 rows

### Specifying a Join Order

Include the ORDERED directive to instruct the query optimizer to join tables in the order in which they are listed in the FROM clause. If you do not include the ORDERED keyword, the query optimizer will choose the order in which to join the tables.

For example, the following command allows the optimizer to choose the order in which to join the tables listed in the FROM clause:

> SELECT e.ename, d.dname, h.startdate
> FROM emp e, dept d, jobhist h
> WHERE d.deptno = e.deptno
> AND h.empno = e.empno;

The following command instructs the optimizer to join the tables in the ordered specified:

> SELECT /\*+ ORDERED \*/ e.ename, d.dname, h.startdate
> FROM emp e, dept d, jobhist h
> WHERE d.deptno = e.deptno
> AND h.empno = e.empno;

In the ORDERED version of the command, Advanced Server will first join emp e with dept d before joining the results with jobhist h. Without the ORDERED directive, the join order is selected by the query optimizer.

Please note: the ORDERED directive does not work for Oracle-style outer joins (those joins that contain a '+' sign).

### Joining Relations Hints

When two tables are to be joined, there are three possible plans that may be used to perform the join.
 - *Nested Loop Join* – The right table is scanned once for every row in the left table.
 - *Merge Sort Join* – Each table is sorted on the join attributes before the join starts. The two tables are then scanned in parallel and the matching rows are combined to form the join rows.
 - *Hash Join* – The right table is scanned and its join attributes are loaded into a hash table using its join attributes as hash keys. The left table is then scanned and its join attributes are used as hash keys to locate the matching rows from the right table.

The following table lists the optimizer hints that can be used to influence the planner to use one type of join plan over another.

Table 3‑3‑12 Join Hints

|                                 |                                                                                |
| ------------------------------- | ------------------------------------------------------------------------------ |
| Hint                            | Description                                                                    |
| USE\_HASH(*table* \[...\])      | Use a hash join with a hash table created from the join attributes of *table*. |
| NO\_USE\_HASH(*table* \[...\])  | Do not use a hash join created from the join attributes of *table*.            |
| USE\_MERGE(*table* \[...\])     | Use a merge sort join for *table*.                                             |
| NO\_USE\_MERGE(*table* \[...\]) | Do not use a merge sort join for *table*.                                      |
| USE\_NL(*table* \[...\])        | Use a nested loop join for *table*.                                            |
| NO\_USE\_NL(*table* \[...\])    | Do not use a nested loop join for *table*.                                     |

Examples

In the following example, a join is performed on the branches and accounts tables. The query plan shows that a hash join is used by creating a hash table from the join attribute of the branches table.

EXPLAIN SELECT b.bid, a.aid, abalance FROM branches b, accounts a WHERE b.bid = a.bid;

QUERY PLAN

\--------------------------------------------------------------------------

Hash Join (cost=1.11..20092.70 rows=500488 width=12)

Hash Cond: (a.bid = b.bid)

\-\> Seq Scan on accounts a (cost=0.00..13209.88 rows=500488 width=12)

\-\> Hash (cost=1.05..1.05 rows=5 width=4)

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

(5 rows)

By using the USE\_HASH(a) hint, the planner is forced to create the hash table from the accounts join attribute instead of from the branches table. Note the use of the alias, a, for the accounts table in the USE\_HASH hint.

EXPLAIN SELECT /\*+ USE\_HASH(a) \*/ b.bid, a.aid, abalance FROM branches b, accounts a WHERE b.bid = a.bid;

QUERY PLAN

\--------------------------------------------------------------------------------

Hash Join (cost=21909.98..30011.52 rows=500488 width=12)

Hash Cond: (b.bid = a.bid)

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

\-\> Hash (cost=13209.88..13209.88 rows=500488 width=12)

\-\> Seq Scan on accounts a (cost=0.00..13209.88 rows=500488 width=12)

(5 rows)

Next, the NO\_USE\_HASH(a b) hint forces the planner to use an approach other than hash tables. The result is a nested loop.

EXPLAIN SELECT /\*+ NO\_USE\_HASH(a b) \*/ b.bid, a.aid, abalance FROM branches b, accounts a WHERE b.bid = a.bid;

QUERY PLAN

\--------------------------------------------------------------------------

Nested Loop (cost=1.05..69515.84 rows=500488 width=12)

Join Filter: (b.bid = a.bid)

\-\> Seq Scan on accounts a (cost=0.00..13209.88 rows=500488 width=12)

\-\> Materialize (cost=1.05..1.11 rows=5 width=4)

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

(5 rows)

Finally, the USE\_MERGE hint forces the planner to use a merge join.

EXPLAIN SELECT /\*+ USE\_MERGE(a) \*/ b.bid, a.aid, abalance FROM branches b, accounts a WHERE b.bid = a.bid;

QUERY PLAN

\--------------------------------------------------------------------------------

Merge Join (cost=69143.62..76650.97 rows=500488 width=12)

Merge Cond: (b.bid = a.bid)

\-\> Sort (cost=1.11..1.12 rows=5 width=4)

Sort Key: b.bid

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

\-\> Sort (cost=69142.52..70393.74 rows=500488 width=12)

Sort Key: a.bid

\-\> Seq Scan on accounts a (cost=0.00..13209.88 rows=500488 width=12)

(8 rows)

In this three-table join example, the planner first performs a hash join on the branches and history tables, then finally performs a nested loop join of the result with the accounts\_pkey index of the accounts table.

EXPLAIN SELECT h.mtime, h.delta, b.bid, a.aid FROM history h, branches b, accounts a WHERE h.bid = b.bid AND h.aid = a.aid;

QUERY PLAN

\--------------------------------------------------------------------------------------

Nested Loop (cost=1.11..207.95 rows=26 width=20)

\-\> Hash Join (cost=1.11..25.40 rows=26 width=20)

Hash Cond: (h.bid = b.bid)

\-\> Seq Scan on history h (cost=0.00..20.20 rows=1020 width=20)

\-\> Hash (cost=1.05..1.05 rows=5 width=4)

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

\-\> Index Scan using accounts\_pkey on accounts a (cost=0.00..7.01 rows=1

width=4)

Index Cond: (h.aid = a.aid)

(8 rows)

This plan is altered by using hints to force a combination of a merge sort join and a hash join.

EXPLAIN SELECT /\*+ USE\_MERGE(h b) USE\_HASH(a) \*/ h.mtime, h.delta, b.bid, a.aid FROM history h, branches b, accounts a WHERE h.bid = b.bid AND h.aid = a.aid;

QUERY PLAN

\-------------------------------------------------------------------------------------------

Merge Join (cost=23480.11..23485.60 rows=26 width=20)

Merge Cond: (h.bid = b.bid)

\-\> Sort (cost=23479.00..23481.55 rows=1020 width=20)

Sort Key: h.bid

\-\> Hash Join (cost=21421.98..23428.03 rows=1020 width=20)

Hash Cond: (h.aid = a.aid)

\-\> Seq Scan on history h (cost=0.00..20.20 rows=1020

width=20)

\-\> Hash (cost=13209.88..13209.88 rows=500488 width=4)

\-\> Seq Scan on accounts a (cost=0.00..13209.88

rows=500488 width=4)

\-\> Sort (cost=1.11..1.12 rows=5 width=4)

Sort Key: b.bid

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

(12 rows)

### Global Hints

Thus far, hints have been applied directly to tables that are referenced in the SQL command. It is also possible to apply hints to tables that appear in a view when the view is referenced in the SQL command. The hint does not appear in the view, itself, but rather in the SQL command that references the view.

When specifying a hint that is to apply to a table within a view, the view and table names are given in dot notation within the hint argument list.

Synopsis

*hint*(*view*.*table*)

Parameters

*hint*

Any of the hints in Table 3‑3‑11 or Table 3‑3‑12.

*view*

The name of the view containing *table*.

*table*

The table on which the hint is to be applied.

Examples

A view named, tx, is created from the three-table join of history, branches, and accounts shown in the final example of Section <span class="underline"></span>3.4.3.

CREATE VIEW tx AS SELECT h.mtime, h.delta, b.bid, a.aid FROM history h, branches b, accounts a WHERE h.bid = b.bid AND h.aid = a.aid;

The query plan produced by selecting from this view is show below:

EXPLAIN SELECT \* FROM tx;

QUERY PLAN

\--------------------------------------------------------------------------------------

Nested Loop (cost=1.11..207.95 rows=26 width=20)

\-\> Hash Join (cost=1.11..25.40 rows=26 width=20)

Hash Cond: (h.bid = b.bid)

\-\> Seq Scan on history h (cost=0.00..20.20 rows=1020 width=20)

\-\> Hash (cost=1.05..1.05 rows=5 width=4)

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

\-\> Index Scan using accounts\_pkey on accounts a (cost=0.00..7.01 rows=1

width=4)

Index Cond: (h.aid = a.aid)

(8 rows)

The same hints that were applied to this join at the end of Section <span class="underline"></span>3.4.3 can be applied to the view as follows:

EXPLAIN SELECT /\*+ USE\_MERGE(tx.h tx.b) USE\_HASH(tx.a) \*/ \* FROM tx;

QUERY PLAN

\------------------------------------------------------------------------------------------

\-

Merge Join (cost=23480.11..23485.60 rows=26 width=20)

Merge Cond: (h.bid = b.bid)

\-\> Sort (cost=23479.00..23481.55 rows=1020 width=20)

Sort Key: h.bid

\-\> Hash Join (cost=21421.98..23428.03 rows=1020 width=20)

Hash Cond: (h.aid = a.aid)

\-\> Seq Scan on history h (cost=0.00..20.20 rows=1020

width=20)

\-\> Hash (cost=13209.88..13209.88 rows=500488 width=4)

\-\> Seq Scan on accounts a (cost=0.00..13209.88

rows=500488 width=4)

\-\> Sort (cost=1.11..1.12 rows=5 width=4)

Sort Key: b.bid

\-\> Seq Scan on branches b (cost=0.00..1.05 rows=5 width=4)

(12 rows)

In addition to applying hints to tables within stored views, hints can be applied to tables within subqueries as illustrated by the following example. In this query on the sample application emp table, employees and their managers are listed by joining the emp table with a subquery of the emp table identified by the alias, b.

SELECT a.empno, a.ename, b.empno "mgr empno", b.ename "mgr ename" FROM emp a, (SELECT \* FROM emp) b WHERE a.mgr = b.empno;

empno | ename | mgr empno | mgr ename

\-------+--------+-----------+-----------

7902 | FORD | 7566 | JONES

7788 | SCOTT | 7566 | JONES

7521 | WARD | 7698 | BLAKE

7844 | TURNER | 7698 | BLAKE

7654 | MARTIN | 7698 | BLAKE

7900 | JAMES | 7698 | BLAKE

7499 | ALLEN | 7698 | BLAKE

7934 | MILLER | 7782 | CLARK

7876 | ADAMS | 7788 | SCOTT

7782 | CLARK | 7839 | KING

7698 | BLAKE | 7839 | KING

7566 | JONES | 7839 | KING

7369 | SMITH | 7902 | FORD

(13 rows)

The plan chosen by the query planner is shown below:

EXPLAIN SELECT a.empno, a.ename, b.empno "mgr empno", b.ename "mgr ename" FROM emp a, (SELECT \* FROM emp) b WHERE a.mgr = b.empno;

QUERY PLAN

\-------------------------------------------------------------------

Merge Join (cost=2.81..3.08 rows=13 width=26)

Merge Cond: (a.mgr = emp.empno)

\-\> Sort (cost=1.41..1.44 rows=14 width=20)

Sort Key: a.mgr

\-\> Seq Scan on emp a (cost=0.00..1.14 rows=14 width=20)

\-\> Sort (cost=1.41..1.44 rows=14 width=13)

Sort Key: emp.empno

\-\> Seq Scan on emp (cost=0.00..1.14 rows=14 width=13)

(8 rows)

A hint can be applied to the emp table within the subquery to perform an index scan on index, emp\_pk, instead of a table scan. Note the difference in the query plans.

EXPLAIN SELECT /\*+ INDEX(b.emp emp\_pk) \*/ a.empno, a.ename, b.empno "mgr empno", b.ename "mgr ename" FROM emp a, (SELECT \* FROM emp) b WHERE a.mgr = b.empno;

QUERY PLAN

\---------------------------------------------------------------------------

Merge Join (cost=1.41..13.21 rows=13 width=26)

Merge Cond: (a.mgr = emp.empno)

\-\> Sort (cost=1.41..1.44 rows=14 width=20)

Sort Key: a.mgr

\-\> Seq Scan on emp a (cost=0.00..1.14 rows=14 width=20)

\-\> Index Scan using emp\_pk on emp (cost=0.00..12.46 rows=14 width=13)

(6 rows)

### Using the APPEND Optimizer Hint

By default, Advanced Server will add new data into the first available free-space in a table (vacated by vacuumed records). Include the APPEND directive after an INSERT or SELECT command to instruct the server to bypass mid-table free space, and affix new rows to the end of the table. This optimizer hint can be particularly useful when bulk loading data.

The syntax is:

> /\*+APPEND\*/

For example, the following Oracle-compatible command instructs the server to append the data in the INSERT statement to the end of the sales table:

> INSERT /\*+APPEND\*/ INTO sales VALUES
> (10, 10, '01-Mar-2011', 10, 'OR');

Note that Advanced Server supports the APPEND hint when adding multiple rows in a single INSERT statement:

> INSERT /\*+APPEND\*/ INTO sales VALUES
> (20, 20, '01-Aug-2011', 20, 'NY'),
> (30, 30, '01-Feb-2011', 30, 'FL'),
> (40, 40, '01-Nov-2011', 40, 'TX');

The APPEND hint can also be included in the SELECT clause of an INSERT INTO statement:

> INSERT INTO sales\_history SELECT /\*+APPEND\*/ FROM sales;

### Conflicting Hints

If a command includes two or more conflicting hints, the server will ignore the contradictory hints. The following table lists hints that are contradictory to each other.

Table 3‑3‑13 Conflicting Hints

<table>
<tbody>
<tr class="odd">
<td>Hint</td>
<td>Conflicting Hint</td>
</tr>
<tr class="even">
<td>ALL_ROWS</td>
<td>FIRST_ROWS - all formats</td>
</tr>
<tr class="odd">
<td>FULL(<em>table</em>)</td>
<td>INDEX(<em>table</em> [ <em>index</em> ])</td>
</tr>
<tr class="even">
<td>INDEX(<em>table</em>)</td>
<td><p>FULL(<em>table</em>)</p>
<p>NO_INDEX(<em>table</em>)</p></td>
</tr>
<tr class="odd">
<td>INDEX(<em>table</em> <em>index</em>)</td>
<td><p>FULL(<em>table</em>)</p>
<p>NO_INDEX(<em>table</em> <em>index</em>)</p></td>
</tr>
<tr class="even">
<td>USE_HASH(<em>table</em>)</td>
<td>NO_USE_HASH(<em>table</em>)</td>
</tr>
<tr class="odd">
<td>USE_MERGE(<em>table</em>)</td>
<td>NO_USE_MERGE(<em>table</em>)</td>
</tr>
<tr class="even">
<td>USE_NL(<em>table</em>)</td>
<td>NO_USE_NL(<em>table</em>)</td>
</tr>
</tbody>
</table>

## Functions and Operators

Postgres Plus Advanced Server provides a large number of functions and operators for the built-in data types.

### Logical Operators

The usual logical operators are available: AND, OR, NOT

SQL uses a three-valued Boolean logic where the null value represents "unknown". Observe the following truth tables:

Table 3‑3‑14 AND/OR Truth Table

|       |       |         |        |
| ----- | ----- | ------- | ------ |
| a     | b     | a AND b | a OR b |
| True  | True  | True    | True   |
| True  | False | False   | True   |
| True  | Null  | Null    | True   |
| False | False | False   | False  |
| False | Null  | False   | Null   |
| Null  | Null  | Null    | Null   |

Table 3‑3‑15 NOT Truth Table

|       |       |
| ----- | ----- |
| a     | NOT a |
| True  | False |
| False | True  |
| Null  | Null  |

The operators AND and OR are commutative, that is, you can switch the left and right operand without affecting the result.

### Comparison Operators

The usual comparison operators are shown in the following table.

Table 3‑3‑16 Comparison Operators

|          |                          |
| -------- | ------------------------ |
| Operator | Description              |
| \<       | Less than                |
| \>       | Greater than             |
| \<=      | Less than or equal to    |
| \>=      | Greater than or equal to |
| \=       | Equal                    |
| \<\>     | Not equal                |
| \!=      | Not equal                |

Comparison operators are available for all data types where this makes sense. All comparison operators are binary operators that return values of type BOOLEAN; expressions like 1 \< 2 \< 3 are not valid (because there is no \< operator to compare a Boolean value with 3).

In addition to the comparison operators, the special BETWEEN construct is available.

*a* BETWEEN *x* AND *y*

is equivalent to

*a* \>= *x* AND *a* \<= *y*

Similarly,

*a* NOT BETWEEN *x* AND *y*

is equivalent to

*a* \< *x* OR *a* \> *y*

There is no difference between the two respective forms apart from the CPU cycles required to rewrite the first one into the second one internally.

To check whether a value is or is not null, use the constructs

*expression* IS NULL

*expression* IS NOT NULL

Do not write *expression* = NULL because NULL is not "equal to" NULL. (The null value represents an unknown value, and it is not known whether two unknown values are equal.) This behavior conforms to the SQL standard.

Some applications may expect that *expression* = NULL returns true if *expression* evaluates to the null value. It is highly recommended that these applications be modified to comply with the SQL standard.

### Mathematical Functions and Operators

Mathematical operators are provided for many Postgres Plus Advanced Server types. For types without common mathematical conventions for all possible permutations (e.g., date/time types) the actual behavior is described in subsequent sections.

The following table shows the available mathematical operators.

Table 3‑3‑17 Mathematical Operators

|          |                                               |          |        |
| -------- | --------------------------------------------- | -------- | ------ |
| Operator | Description                                   | Example  | Result |
| \+       | Addition                                      | 2 + 3    | 5      |
| \-       | Subtraction                                   | 2 – 3    | \-1    |
| \*       | Multiplication                                | 2 \* 3   | 6      |
| /        | Division (integer division truncates results) | 4 / 2    | 2      |
| \*\*     | Exponentiation Operator                       | 2 \*\* 3 | 8      |

The following table shows the available mathematical functions. Many of these functions are provided in multiple forms with different argument types. Except where noted, any given form of a function returns the same data type as its argument. The functions working with DOUBLE PRECISION data are mostly implemented on top of the host system’s C library; accuracy and behavior in boundary cases may therefore vary depending on the host system.

Table 3‑3‑18 Mathematical Functions

|                                                                       |                                                                        |                                                                                                                             |                                      |                      |
| --------------------------------------------------------------------- | ---------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ | -------------------- |
| Function                                                              | Return Type                                                            | Description                                                                                                                 | Example                              | Result               |
| ABS(*x*)                                                              | Same as *x*                                                            | Absolute value                                                                                                              | ABS(-17.4)                           | 17.4                 |
| CEIL(DOUBLE PRECISION or NUMBER)                                      | Same as input                                                          | Smallest integer not less than argument                                                                                     | CEIL(-42.8)                          | \-42                 |
| EXP(DOUBLE PRECISION or NUMBER)                                       | Same as input                                                          | Exponential                                                                                                                 | EXP(1.0)                             | 2.7182818284590452   |
| FLOOR(DOUBLE PRECISION or NUMBER)                                     | Same as input                                                          | Largest integer not greater than argument                                                                                   | FLOOR(-42.8)                         | 43                   |
| LN(DOUBLE PRECISION or NUMBER)                                        | Same as input                                                          | Natural logarithm                                                                                                           | LN(2.0)                              | 0.6931471805599453   |
| LOG(*b* NUMBER, *x* NUMBER)                                           | NUMBER                                                                 | Logarithm to base *b*                                                                                                       | LOG(2.0, 64.0)                       | 6.0000000000000000   |
| MOD(*y*, *x*)                                                         | Same as argument types                                                 | Remainder of *y*/*x*                                                                                                        | MOD(9, 4)                            | 1                    |
| NVL(*x*, *y*)                                                         | Same as argument types; where both arguments are of the same data type | If *x* is null, then NVL returns *y*                                                                                        | NVL(9, 0)                            | 9                    |
| POWER(*a* DOUBLE PRECISION, *b* DOUBLE PRECISION)                     | DOUBLE PRECISION                                                       | *a* raised to the power of *b*                                                                                              | POWER(9.0, 3.0)                      | 729.0000000000000000 |
| POWER(*a* NUMBER, *b* NUMBER)                                         | NUMBER                                                                 | *a* raised to the power of *b*                                                                                              | POWER(9.0, 3.0)                      | 729.0000000000000000 |
| ROUND(DOUBLE PRECISION or NUMBER)                                     | Same as input                                                          | Round to nearest integer                                                                                                    | ROUND(42.4)                          | 42                   |
| ROUND(*v* NUMBER, *s* INTEGER)                                        | NUMBER                                                                 | Round to *s* decimal places                                                                                                 | ROUND(42.4382, 2)                    | 42.44                |
| SIGN(DOUBLE PRECISION or NUMBER)                                      | Same as input                                                          | Sign of the argument (-1, 0, +1)                                                                                            | SIGN(-8.4)                           | \-1                  |
| SQRT(DOUBLE PRECISION or NUMBER)                                      | Same as input                                                          | Square root                                                                                                                 | SQRT(2.0)                            | 1.414213562373095    |
| TRUNC(DOUBLE PRECISION or NUMBER)                                     | Same as input                                                          | Truncate toward zero                                                                                                        | TRUNC(42.8)                          | 42                   |
| TRUNC(*v* NUMBER, *s* INTEGER)                                        | NUMBER                                                                 | Truncate to s decimal places                                                                                                | TRUNC(42.4382, 2)                    | 42.43                |
| WIDTH\_BUCKET(*op* NUMBER, *b1* NUMBER, *b2* NUMBER, *count* INTEGER) | INTEGER                                                                | Return the bucket to which *op* would be assigned in an equidepth histogram with *count* buckets, in the range *b1* to *b2* | WIDTH\_BUCKET(5.35, 0.024, 10.06, 5) | 3                    |

The following table shows the available trigonometric functions. All trigonometric functions take arguments and return values of type DOUBLE PRECISION.

Table 3‑3‑19 Trigonometric Functions

|                 |                            |
| --------------- | -------------------------- |
| Function        | Description                |
| ACOS(*x*)       | Inverse cosine             |
| ASIN(*x*)       | Inverse sine               |
| ATAN(*x*)       | Inverse tangent            |
| ATAN2(*x*, *y*) | Inverse tangent of *x*/*y* |
| COS(*x*)        | Cosine                     |
| SIN(*x*)        | Sine                       |
| TAN(*x*)        | Tangent                    |

### String Functions and Operators

This section describes functions and operators for examining and manipulating string values. Strings in this context include values of the types CHAR, VARCHAR2, and CLOB. Unless otherwise noted, all of the functions listed below work on all of these types, but be wary of potential effects of automatic padding when using the CHAR type. Generally, the functions described here also work on data of non-string types by converting that data to a string representation first.

Table 3‑3‑20 SQL String Functions and Operators

|                                                                        |             |                                                                                                                                                                                                                            |                                                                     |              |
| ---------------------------------------------------------------------- | ----------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------ |
| Function                                                               | Return Type | Description                                                                                                                                                                                                                | Example                                                             | Result       |
| *string* || *string*                                                   | CLOB        | String concatenation                                                                                                                                                                                                       | 'Enterprise' || 'DB'                                                | EnterpriseDB |
| CONCAT(*string*, *string*)                                             | CLOB        | String concatenation                                                                                                                                                                                                       | 'a' || 'b'                                                          | ab           |
| HEXTORAW(*varchar2*)                                                   | RAW         | Converts a VARCHAR2 value to a RAW value                                                                                                                                                                                   | HEXTORAW('303132')                                                  | '012'        |
| RAWTOHEX(*raw*)                                                        | VARCHAR2    | Converts a RAW value to a HEXADECIMAL value                                                                                                                                                                                | RAWTOHEX('012')                                                     | '303132'     |
| INSTR(*string*, *set*, \[ *start* \[, *occurrence* \] \])              | INTEGER     | Finds the location of a set of characters in a string, starting at position *start* in the string, *string*, and looking for the first, second, third and so on occurrences of the set. Returns 0 if the set is not found. | INSTR('PETER PIPER PICKED a PECK of PICKLED PEPPERS','PI',1,3)      | 30           |
| INSTRB(*string*, *set*)                                                | INTEGER     | Returns the position of the *set* within the *string*. Returns 0 if *set* is not found.                                                                                                                                    | INSTRB('PETER PIPER PICKED a PECK of PICKLED PEPPERS', 'PICK')      | 13           |
| INSTRB(*string*, *set*, *start*)                                       | INTEGER     | Returns the position of the *set* within the *string*, beginning at *start*. Returns 0 if *set* is not found.                                                                                                              | INSTRB('PETER PIPER PICKED a PECK of PICKLED PEPPERS','PICK', 14)   | 30           |
| INSTRB(*string*, *set*, *start*, *occurrence*)                         | INTEGER     | Returns the position of the specified *occurrence* of *set* within the *string*, beginning at *start*. Returns 0 if *set* is not found.                                                                                    | INSTRB('PETER PIPER PICKED a PECK of PICKLED PEPPERS','PICK', 1, 2) | 30           |
| LOWER(*string*)                                                        | CLOB        | Convert *string* to lower case                                                                                                                                                                                             | LOWER('TOM')                                                        | tom          |
| SUBSTR(*string*, *start* \[, *count* \])                               | CLOB        | Extract substring starting from *start* and going for *count* characters. If *count* is not specified, the string is clipped from the start till the end.                                                                  | SUBSTR('This is a test',6,2)                                        | is           |
| SUBSTRB(*string*, *start* \[, *count* \])                              | CLOB        | Same as SUBSTR except *start* and *count* are in number of bytes.                                                                                                                                                          | SUBSTRB('abc',3) (assuming a double-byte character set)             | c            |
| SUBSTR2(*string*, *start* \[, *count* \])                              | CLOB        | Alias for SUBSTR.                                                                                                                                                                                                          | SUBSTR2('This is a test',6,2)                                       | is           |
| SUBSTR2(*string*, *start* \[, *count* \])                              | CLOB        | Alias for SUBSTRB.                                                                                                                                                                                                         | SUBSTR2('abc',3) (assuming a double-byte character set)             | c            |
| SUBSTR4(*string*, *start* \[, *count* \])                              | CLOB        | Alias for SUBSTR.                                                                                                                                                                                                          | SUBSTR4('This is a test',6,2)                                       | is           |
| SUBSTR4(*string*, *start* \[, *count* \])                              | CLOB        | Alias for SUBSTRB.                                                                                                                                                                                                         | SUBSTR4('abc',3) (assuming a double-byte character set)             | c            |
| SUBSTRC(*string*, *start* \[, *count* \])                              | CLOB        | Alias for SUBSTR.                                                                                                                                                                                                          | SUBSTRC('This is a test',6,2)                                       | is           |
| SUBSTRC(*string*, *start* \[, *count* \])                              | CLOB        | Alias for SUBSTRB.                                                                                                                                                                                                         | SUBSTRC('abc',3) (assuming a double-byte character set)             | c            |
| TRIM(\[ LEADING | TRAILING | BOTH \] \[ *characters* \] FROM *string*) | CLOB        | Remove the longest string containing only the characters (a space by default) from the start/end/both ends of the string.                                                                                                  | TRIM(BOTH 'x' FROM 'xTomxx')                                        | Tom          |
| LTRIM(*string* \[, *set*\])                                            | CLOB        | Removes all the characters specified in *set* from the left of a given *string*. If *set* is not specified, a blank space is used as default.                                                                              | LTRIM('abcdefghi', 'abc')                                           | defghi       |
| RTRIM(*string* \[, *set*\])                                            | CLOB        | Removes all the characters specified in *set* from the right of a given *string*. If *set* is not specified, a blank space is used as default.                                                                             | RTRIM('abcdefghi', 'ghi')                                           | abcdef       |
| UPPER(*string*)                                                        | CLOB        | Convert *string* to upper case                                                                                                                                                                                             | UPPER('tom')                                                        | TOM          |

Additional string manipulation functions are available and are listed in the following table. Some of them are used internally to implement the SQL-standard string functions listed in Table 3‑3‑20.

Table 3‑3‑21 Other String Functions

|                                                                                  |                                                             |                                                                                                                                                                                                                                               |                                                     |           |
| -------------------------------------------------------------------------------- | ----------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- | --------- |
| Function                                                                         | Return Type                                                 | Description                                                                                                                                                                                                                                   | Example                                             | Result    |
| ASCII(*string*)                                                                  | INTEGER                                                     | ASCII code of the first byte of the argument                                                                                                                                                                                                  | ASCII('x')                                          | 120       |
| CHR(INTEGER)                                                                     | CLOB                                                        | Character with the given ASCII code                                                                                                                                                                                                           | CHR(65)                                             | A         |
| DECODE(*expr*, *expr1a*, *expr1b* \[, *expr2a*, *expr2b* \]... \[, *default* \]) | Same as argument types of *expr1b*, *expr2b*,..., *default* | Finds first match of *expr* with *expr1a*, *expr2a*, etc. When match found, returns corresponding parameter pair, *expr1b*, *expr2b*, etc. If no match found, returns *default*. If no match found and *default* not specified, returns null. | DECODE(3, 1,'One', 2,'Two', 3,'Three', 'Not found') | Three     |
| INITCAP(*string*)                                                                | CLOB                                                        | Convert the first letter of each word to uppercase and the rest to lowercase. Words are sequences of alphanumeric characters separated by non-alphanumeric characters.                                                                        | INITCAP('hi THOMAS')                                | Hi Thomas |
| LENGTH                                                                           | INTEGER                                                     | Returns the number of characters in a string value.                                                                                                                                                                                           | LENGTH('Côte d''Azur')                              | 11        |
| LENGTHC                                                                          | INTEGER                                                     | This function is identical in functionality to LENGTH; the function name is supported for compatibility.                                                                                                                                      | LENGTHC('Côte d''Azur')                             | 11        |
| LENGTH2                                                                          | INTEGER                                                     | This function is identical in functionality to LENGTH; the function name is supported for compatibility.                                                                                                                                      | LENGTH2('Côte d''Azur')                             | 11        |
| LENGTH4                                                                          | INTEGER                                                     | This function is identical in functionality to LENGTH; the function name is supported for compatibility.                                                                                                                                      | LENGTH4('Côte d''Azur')                             | 11        |
| LENGTHB                                                                          | INTEGER                                                     | Returns the number of bytes required to hold the given value.                                                                                                                                                                                 | LENGTHB('Côte d''Azur')                             | 12        |
| LPAD(*string*, *length* INTEGER \[, *fill* \])                                   | CLOB                                                        | Fill up *string* to size, *length* by prepending the characters, *fill* (a space by default). If *string* is already longer than *length* then it is truncated (on the right).                                                                | LPAD('hi', 5, 'xy')                                 | xyxhi     |
| REPLACE(*string*, *search\_string* \[, *replace\_string* \]                      | CLOB                                                        | Replaces one value in a string with another. If you do not specify a value for *replace\_string*, the *search\_string* value when found, is removed.                                                                                          | REPLACE( 'GEORGE', 'GE', 'EG')                      | EGOREG    |
| RPAD(*string*, *length* INTEGER \[, *fill* \])                                   | CLOB                                                        | Fill up *string* to size, *length* by appending the characters, *fill* (a space by default). If *string* is already longer than *length* then it is truncated.                                                                                | RPAD('hi', 5, 'xy')                                 | hixyx     |
| TRANSLATE(*string*, *from*, *to*)                                                | CLOB                                                        | Any character in *string* that matches a character in the *from* set is replaced by the corresponding character in the *to* set.                                                                                                              | TRANSLATE('12345', '14', 'ax')                      | a23x5     |

### Pattern Matching String Functions

Advanced Server offers support for the REGEXP\_COUNT, REGEXP\_INSTR and REGEXP\_SUBSTR functions. These functions search a string for a pattern specified by a regular expression, and return information about occurrences of the pattern within the string. The pattern should be a POSIX-style regular expression; for more information about forming a POSIX-style regular expression, please refer to the core documentation at:

[http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html](http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html#FUNCTIONS-POSIX-REGEXP)

#### REGEXP\_COUNT

REGEXP\_COUNT searches a string for a regular expression, and returns a count of the times that the regular expression occurs. The signature is:

INTEGER REGEXP\_COUNT
(
*srcstr* TEXT,
*pattern* TEXT,
*position* DEFAULT 1
*modifier* DEFAULT NULL
)

**Parameters**

*srcstr*

> *srcstr* specifies the string to search.

*pattern*

> *pattern* specifies the regular expression for which REGEXP\_COUNT will search.

*position*

> *position* is an integer value that indicates the position in the source string at which REGEXP\_COUNT will begin searching. The default value is 1.

*modifier*

> *modifier* specifies values that control the pattern matching behavior. The default value is NULL. For a complete list of the modifiers supported by Advanced Server, see the PostgreSQL core documentation, available at:

[http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html](http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html#FUNCTIONS-POSIX-REGEXP)

**Example**

In the following simple example, REGEXP\_COUNT returns a count of the number of times the letter i is used in the character string 'reinitializing':

edb=\# SELECT REGEXP\_COUNT('reinitializing', 'i', 1) FROM DUAL;

regexp\_count

\--------------

5

(1 row)

In the first example, the command instructs REGEXP\_COUNT begins counting in the first position; if we modify the command to start the count on the 6th position:

edb=\# SELECT REGEXP\_COUNT('reinitializing', 'i', 6) FROM DUAL;

regexp\_count

\--------------

3

(1 row)

REGEXP\_COUNT returns 3; the count now excludes any occurances of the letter i that occur before the 6th position.

#### REGEXP\_INSTR

REGEXP\_INSTR searches a string for a POSIX-style regular expression. This function returns the position within the string where the match was located. The signature is:

INTEGER REGEXP\_INSTR
(
*srcstr* TEXT,
*pattern* TEXT,
*position* INT DEFAULT 1,
*occurrence* INT DEFAULT 1,
*returnparam* INT DEFAULT 0,
*modifier* TEXT DEFAULT NULL,
*subexpression* INT DEFAULT 0,
)

**Parameters:**

*srcstr*

> *srcstr* specifies the string to search.

*pattern*

> *pattern* specifies the regular expression for which REGEXP\_INSTR will search.

*position*

> *position* specifies an integer value that indicates the start position in a source string. The default value is 1.

*occurrence*

> *occurrence* specifies which match is returned if more than one occurrence of the pattern occurs in the string that is searched. The default value is 1.

*returnparam*

> *returnparam* is an integer value that specifies the location within the string that REGEXP\_INSTR should return. The default value is 0. Specify:
>
> 0 to return the location within the string of the first character that matches *pattern*.
>
> A value greater than 0 to return the position of the first character following the end of the *pattern*.

*modifier*

> *modifier* specifies values that control the pattern matching behavior. The default value is NULL. For a complete list of the modifiers supported by Advanced Server, see the PostgreSQL core documentation, available at:
>
> [http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html](http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html#FUNCTIONS-POSIX-REGEXP)

subexpression

> subexpression is an integer value that identifies the portion of the *pattern* that will be returned by REGEXP\_INSTR. The default value of *subexpression* is 0.
>
> If you specify a value for *subexpression*, you must include one (or more) set of parentheses in the *pattern* that isolate a portion of the value being searched for. The value specified by *subexpression* indicates which set of parentheses should be returned; for example, if *subexpression* is 2, REGEXP\_INSTR will return the position of the second set of parentheses.

**Example**

In the following simple example, REGEXP\_INSTR searches a string that contains the a phone number for the first occurrence of a pattern that contains three consecutive digits:

edb=\# SELECT REGEXP\_INSTR('800-555-1212', '\[0-9\]\[0-9\]\[0-9\]', 1, 1) FROM DUAL;

regexp\_instr

\--------------

1

(1 row)

The command instructs REGEXP\_INSTR to return the position of the first occurrence. If we modify the command to return the start of the second occurrence of three consecutive digits:

edb=\# SELECT REGEXP\_INSTR('800-555-1212', '\[0-9\]\[0-9\]\[0-9\]', 1, 2) FROM DUAL;

regexp\_instr

\--------------

5

(1 row)

REGEXP\_INSTR returns 5; the second occurrence of three consecutive digits begins in the 5<sup>th</sup> position.

#### REGEXP\_SUBSTR

The REGEXP\_SUBSTR function searches a string for a pattern specified by a POSIX compliant regular expression. REGEXP\_SUBSTR returns the string that matches the pattern specified in the call to the function. The signature of the function is:

TEXT REGEXP\_SUBSTR
(
*srcstr* TEXT,
*pattern* TEXT,
*position* INT DEFAULT 1,
*occurrence* INT DEFAULT 1,
*modifier* TEXT DEFAULT NULL,
*subexpression* INT DEFAULT 0
)

**Parameters:**

*srcstr*

> *srcstr* specifies the string to search.

*pattern*

> *pattern* specifies the regular expression for which REGEXP\_SUBSTR will search.

*position*

> *position* specifies an integer value that indicates the start position in a source string. The default value is 1.

*occurrence*

> *occurrence* specifies which match is returned if more than one occurrence of the pattern occurs in the string that is searched. The default value is 1.

*modifier*

> *modifier* specifies values that control the pattern matching behavior. The default value is NULL. For a complete list of the modifiers supported by Advanced Server, see the PostgreSQL core documentation, available at:

[http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html](http://www.enterprisedb.com/docs/en/9.4/pg/functions-matching.html#FUNCTIONS-POSIX-REGEXP)

subexpression

> subexpression is an integer value that identifies the portion of the *pattern* that will be returned by REGEXP\_SUBSTR. The default value of *subexpression* is 0.
>
> If you specify a value for *subexpression*, you must include one (or more) set of parentheses in the *pattern* that isolate a portion of the value being searched for. The value specified by *subexpression* indicates which set of parentheses should be returned; for example, if *subexpression* is 2, REGEXP\_SUBSTR will return the value contained within the second set of parentheses.

**Example**

In the following simple example, REGEXP\_SUBSTR searches a string that contains a phone number for the first set of three consecutive digits:

edb=\# SELECT REGEXP\_SUBSTR('800-555-1212', '\[0-9\]\[0-9\]\[0-9\]', 1, 1) FROM DUAL;

regexp\_substr

\---------------

800

(1 row)

It locates the first occurrence of three digits and returns the string (800); if we modify the command to check for the second occurrence of three consecutive digits:

edb=\# SELECT REGEXP\_SUBSTR('800-555-1212', '\[0-9\]\[0-9\]\[0-9\]', 1, 2) FROM DUAL;

regexp\_substr

\---------------

555

(1 row)

REGEXP\_SUBSTR returns 555, the contents of the second substring.

### Pattern Matching Using the LIKE Operator

Postgres Plus Advanced Server provides pattern matching using the traditional SQL LIKE operator. The syntax for the LIKE operator is as follows.

*string* LIKE *pattern* \[ ESCAPE *escape-character* \]

*string* NOT LIKE *pattern* \[ ESCAPE *escape-character* \]

Every *pattern* defines a set of strings. The LIKE expression returns true if *string* is contained in the set of strings represented by *pattern*. As expected, the NOT LIKE expression returns false if LIKE returns true, and vice versa. An equivalent expression is NOT (*string* LIKE *pattern*).

If *pattern* does not contain percent signs or underscore, then the pattern only represents the string itself; in that case LIKE acts like the equals operator. An underscore (\_) in *pattern* stands for (matches) any single character; a percent sign (%) matches any string of zero or more characters.

Some examples:

'abc' LIKE 'abc' true

'abc' LIKE 'a%' true

'abc' LIKE '\_b\_' true

'abc' LIKE 'c' false

LIKE pattern matches always cover the entire string. To match a pattern anywhere within a string, the pattern must therefore start and end with a percent sign.

To match a literal underscore or percent sign without matching other characters, the respective character in *pattern* must be preceded by the escape character. The default escape character is the backslash but a different one may be selected by using the ESCAPE clause. To match the escape character itself, write two escape characters.

Note that the backslash already has a special meaning in string literals, so to write a pattern constant that contains a backslash you must write two backslashes in an SQL statement. Thus, writing a pattern that actually matches a literal backslash means writing four backslashes in the statement. You can avoid this by selecting a different escape character with ESCAPE; then a backslash is not special to LIKE anymore. (But it is still special to the string literal parser, so you still need two of them.)

It’s also possible to select no escape character by writing ESCAPE ''. This effectively disables the escape mechanism, which makes it impossible to turn off the special meaning of underscore and percent signs in the pattern.

### Data Type Formatting Functions

The Postgres Plus Advanced Server formatting functions (described in Table 3-3-22) provide a powerful set of tools for converting various data types (date/time, integer, floating point, numeric) to formatted strings and for converting from formatted strings to specific data types. These functions all follow a common calling convention: the first argument is the value to be formatted and the second argument is a string template that defines the output or input format.

Table 3‑3‑22 Formatting Functions

|                                      |             |                                                                                                |                                                                       |                        |
| ------------------------------------ | ----------- | ---------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- | ---------------------- |
| Function                             | Return Type | Description                                                                                    | Example                                                               | Result                 |
| TO\_CHAR(DATE \[, *format* \])       | VARCHAR2    | Convert a date/time to a string with output, *format*. If omitted default format is DD-MON-YY. | TO\_CHAR(SYSDATE, 'MM/DD/YYYY HH12:MI:SS AM')                         | 07/25/2007 09:43:02 AM |
| TO\_CHAR(TIMESTAMP \[, *format* \])  | VARCHAR2    | Convert a timestamp to a string with output, *format*. If omitted default format is DD-MON-YY. | TO\_CHAR(CURRENT\_TIMESTAMP, 'MM/DD/YYYY HH12:MI:SS AM')              | 08/13/2014 08:55:22 PM |
| TO\_CHAR(INTEGER \[, *format* \])    | VARCHAR2    | Convert an integer to a string with output, *format*                                           | TO\_CHAR(2412, '999,999S')                                            | 2,412+                 |
| TO\_CHAR(NUMBER \[, *format* \])     | VARCHAR2    | Convert a decimal number to a string with output, *format*                                     | TO\_CHAR(10125.35, '999,999.99')                                      | 10,125.35              |
| TO\_CHAR(DOUBLE PRECISION, *format*) | VARCHAR2    | Convert a floating-point number to a string with output, *format*                              | TO\_CHAR(CAST(123.5282 AS REAL), '999.99')                            | 123.53                 |
| TO\_DATE(*string* \[, *format* \])   | DATE        | Convert a date formatted string to a DATE data type                                            | TO\_DATE('2007-07-04 13:39:10', 'YYYY-MM-DD HH24:MI:SS')              | 04-JUL-07 13:39:10     |
| TO\_NUMBER(*string* \[, *format* \]) | NUMBER      | Convert a number formatted string to a NUMBER data type                                        | TO\_NUMBER('2,412-', '999,999S')                                      | \-2412                 |
| TO\_TIMESTAMP(*string*, *format*)    | TIMESTAMP   | Convert a timestamp formatted string to a TIMESTAMP data type                                  | TO\_TIMESTAMP('05 Dec 2000 08:30:25 pm', 'DD Mon YYYY hh12:mi:ss pm') | 05-DEC-00 20:30:25     |

In an output template string (for TO\_CHAR), there are certain patterns that are recognized and replaced with appropriately-formatted data from the value to be formatted. Any text that is not a template pattern is simply copied verbatim. Similarly, in an input template string (for anything but TO\_CHAR), template patterns identify the parts of the input data string to be looked at and the values to be found there.

The following table shows the template patterns available for formatting date values using the TO\_CHAR and TO\_DATE functions.

Table 3‑3‑23 Template Date/Time Format Patterns

<table>
<tbody>
<tr class="odd">
<td>Pattern</td>
<td>Description</td>
</tr>
<tr class="even">
<td>HH</td>
<td>Hour of day (01-12)</td>
</tr>
<tr class="odd">
<td>HH12</td>
<td>Hour of day (01-12)</td>
</tr>
<tr class="even">
<td>HH24</td>
<td>Hour of day (00-23)</td>
</tr>
<tr class="odd">
<td>MI</td>
<td>Minute (00-59)</td>
</tr>
<tr class="even">
<td>SS</td>
<td>Second (00-59)</td>
</tr>
<tr class="odd">
<td>SSSSS</td>
<td>Seconds past midnight (0-86399)</td>
</tr>
<tr class="even">
<td>FF<em>n</em></td>
<td>Fractional seconds where <em>n</em> is an optional integer from 1 to 9 for the number of digits to return. If omitted, the default is 6.</td>
</tr>
<tr class="odd">
<td>AM or A.M. or PM or P.M.</td>
<td>Meridian indicator (uppercase)</td>
</tr>
<tr class="even">
<td>am or a.m. or pm or p.m.</td>
<td>Meridian indicator (lowercase)</td>
</tr>
<tr class="odd">
<td>Y,YYY</td>
<td>Year (4 and more digits) with comma</td>
</tr>
<tr class="even">
<td>YEAR</td>
<td>Year (spelled out)</td>
</tr>
<tr class="odd">
<td>SYEAR</td>
<td>Year (spelled out) (BC dates prefixed by a minus sign)</td>
</tr>
<tr class="even">
<td>YYYY</td>
<td>Year (4 and more digits)</td>
</tr>
<tr class="odd">
<td>SYYYY</td>
<td>Year (4 and more digits) (BC dates prefixed by a minus sign)</td>
</tr>
<tr class="even">
<td>YYY</td>
<td>Last 3 digits of year</td>
</tr>
<tr class="odd">
<td>YY</td>
<td>Last 2 digits of year</td>
</tr>
<tr class="even">
<td>Y</td>
<td>Last digit of year</td>
</tr>
<tr class="odd">
<td>IYYY</td>
<td>ISO year (4 and more digits)</td>
</tr>
<tr class="even">
<td>IYY</td>
<td>Last 3 digits of ISO year</td>
</tr>
<tr class="odd">
<td>IY</td>
<td>Last 2 digits of ISO year</td>
</tr>
<tr class="even">
<td>I</td>
<td>Last 1 digit of ISO year</td>
</tr>
<tr class="odd">
<td>BC or B.C. or AD or A.D.</td>
<td>Era indicator (uppercase)</td>
</tr>
<tr class="even">
<td>bc or b.c. or ad or a.d.</td>
<td>Era indicator (lowercase)</td>
</tr>
<tr class="odd">
<td>MONTH</td>
<td>Full uppercase month name</td>
</tr>
<tr class="even">
<td>Month</td>
<td>Full mixed-case month name</td>
</tr>
<tr class="odd">
<td>month</td>
<td>Full lowercase month name</td>
</tr>
<tr class="even">
<td>MON</td>
<td>Abbreviated uppercase month name (3 chars in English, localized lengths vary)</td>
</tr>
<tr class="odd">
<td>Mon</td>
<td>Abbreviated mixed-case month name (3 chars in English, localized lengths vary)</td>
</tr>
<tr class="even">
<td>mon</td>
<td>Abbreviated lowercase month name (3 chars in English, localized lengths vary)</td>
</tr>
<tr class="odd">
<td>MM</td>
<td>Month number (01-12)</td>
</tr>
<tr class="even">
<td>DAY</td>
<td>Full uppercase day name</td>
</tr>
<tr class="odd">
<td>Day</td>
<td>Full mixed-case day name</td>
</tr>
<tr class="even">
<td>day</td>
<td>Full lowercase day name</td>
</tr>
<tr class="odd">
<td>DY</td>
<td>Abbreviated uppercase day name (3 chars in English, localized lengths vary)</td>
</tr>
<tr class="even">
<td>Dy</td>
<td>Abbreviated mixed-case day name (3 chars in English, localized lengths vary)</td>
</tr>
<tr class="odd">
<td>dy</td>
<td>Abbreviated lowercase day name (3 chars in English, localized lengths vary)</td>
</tr>
<tr class="even">
<td>DDD</td>
<td>Day of year (001-366)</td>
</tr>
<tr class="odd">
<td>DD</td>
<td>Day of month (01-31)</td>
</tr>
<tr class="even">
<td>D</td>
<td>Day of week (1-7; Sunday is 1)</td>
</tr>
<tr class="odd">
<td>W</td>
<td>Week of month (1-5) (The first week starts on the first day of the month)</td>
</tr>
<tr class="even">
<td>WW</td>
<td>Week number of year (1-53) (The first week starts on the first day of the year)</td>
</tr>
<tr class="odd">
<td>IW</td>
<td>ISO week number of year; the first Thursday of the new year is in week 1</td>
</tr>
<tr class="even">
<td>CC</td>
<td>Century (2 digits); the 21st century starts on 2001-01-01</td>
</tr>
<tr class="odd">
<td>SCC</td>
<td>Same as CC except BC dates are prefixed by a minus sign</td>
</tr>
<tr class="even">
<td>J</td>
<td>Julian Day (days since January 1, 4712 BC)</td>
</tr>
<tr class="odd">
<td>Q</td>
<td>Quarter</td>
</tr>
<tr class="even">
<td>RM</td>
<td>Month in Roman numerals (I-XII; I=January) (uppercase)</td>
</tr>
<tr class="odd">
<td>rm</td>
<td>Month in Roman numerals (i-xii; i=January) (lowercase)</td>
</tr>
<tr class="even">
<td>RR</td>
<td><p>First 2 digits of the year when given only the last 2 digits of the year. Result is based upon an algorithm using the current year and the given 2-digit year. The first 2 digits of the given 2-digit year will be the same as the first 2 digits of the current year with the following exceptions:</p>
<p>If the given 2-digit year is &lt; 50 and the last 2 digits of the current year is &gt;= 50, then the first 2 digits for the given year is 1 greater than the first 2 digits of the current year.</p>
<p>If the given 2-digit year is &gt;= 50 and the last 2 digits of the current year is &lt; 50, then the first 2 digits for the given year is 1 less than the first 2 digits of the current year.</p></td>
</tr>
<tr class="odd">
<td>RRRR</td>
<td>Only affects TO_DATE function. Allows specification of 2-digit or 4-digit year. If 2-digit year given, then returns first 2 digits of year like RR format. If 4-digit year given, returns the given 4-digit year.</td>
</tr>
</tbody>
</table>

Certain modifiers may be applied to any template pattern to alter its behavior. For example, FMMonth is the Month pattern with the FM modifier. The following table shows the modifier patterns for date/time formatting.

Table 3‑3‑24 Template Pattern Modifiers for Date/Time Formatting

|           |                                               |                 |
| --------- | --------------------------------------------- | --------------- |
| Modifier  | Description                                   | Example         |
| FM prefix | Fill mode (suppress padding blanks and zeros) | FMMonth         |
| TH suffix | Uppercase ordinal number suffix               | DDTH            |
| th suffix | Lowercase ordinal number suffix               | DDth            |
| FX prefix | Fixed format global option (see usage notes)  | FX Month DD Day |
| SP suffix | Spell mode                                    | DDSP            |

Usage notes for date/time formatting:
 - FM suppresses leading zeroes and trailing blanks that would otherwise be added to make the output of a pattern fixed-width.
 - TO\_TIMESTAMP and TO\_DATE skip multiple blank spaces in the input string if the FX option is not used. FX must be specified as the first item in the template. For example TO\_TIMESTAMP('2000    JUN', 'YYYY MON') is correct, but TO\_TIMESTAMP('2000    JUN', 'FXYYYY MON') returns an error, because TO\_TIMESTAMP expects one space only.
 - Ordinary text is allowed in TO\_CHAR templates and will be output literally.
 - In conversions from string to timestamp or date, the CC field is ignored if there is a YYY, YYYY or Y,YYY field. If CC is used with YY or Y then the year is computed as (CC-1)\*100+YY.

The following table shows the template patterns available for formatting numeric values.

Table 3‑3‑25 Template Patterns for Numeric Formatting

|            |                                                              |
| ---------- | ------------------------------------------------------------ |
| Pattern    | Description                                                  |
| 9          | Value with the specified number of digits                    |
| 0          | Value with leading zeroes                                    |
| . (period) | Decimal point                                                |
| , (comma)  | Group (thousand) separator                                   |
| $          | Dollar sign                                                  |
| PR         | Negative value in angle brackets                             |
| S          | Sign anchored to number (uses locale)                        |
| L          | Currency symbol (uses locale)                                |
| D          | Decimal point (uses locale)                                  |
| G          | Group separator (uses locale)                                |
| MI         | Minus sign specified in right-most position (if number \< 0) |
| RN or rn   | Roman numeral (input between 1 and 3999)                     |
| V          | Shift specified number of digits (see notes)                 |

Usage notes for numeric formatting:
 - 9 results in a value with the same number of digits as there are 9s. If a digit is not available it outputs a space.
 - TH does not convert values less than zero and does not convert fractional numbers.

V effectively multiplies the input values by 10*<sup>n</sup>*, where *n* is the number of digits following V. TO\_CHAR does not support the use of V combined with a decimal point. (E.g., 99.9V99 is not allowed.)

The following table shows some examples of the use of the TO\_CHAR and TO\_DATE functions.

Table 3‑3‑26 TO\_CHAR Examples

|                                                         |                           |
| ------------------------------------------------------- | ------------------------- |
| Expression                                              | Result                    |
| TO\_CHAR(CURRENT\_TIMESTAMP, 'Day, DD  HH12:MI:SS')     | 'Tuesday  , 06  05:39:18' |
| TO\_CHAR(CURRENT\_TIMESTAMP, 'FMDay, FMDD  HH12:MI:SS') | 'Tuesday, 6  05:39:18'    |
| TO\_CHAR(-0.1, '99.99')                                 | '  -.10'                  |
| TO\_CHAR(-0.1, 'FM9.99')                                | '-.1'                     |
| TO\_CHAR(0.1, '0.9')                                    | ' 0.1'                    |
| TO\_CHAR(12, '9990999.9')                               | '    0012.0'              |
| TO\_CHAR(12, 'FM9990999.9')                             | '0012.'                   |
| TO\_CHAR(485, '999')                                    | ' 485'                    |
| TO\_CHAR(-485, '999')                                   | '-485'                    |
| TO\_CHAR(1485, '9,999')                                 | ' 1,485'                  |
| TO\_CHAR(1485, '9G999')                                 | ' 1,485'                  |
| TO\_CHAR(148.5, '999.999')                              | ' 148.500'                |
| TO\_CHAR(148.5, 'FM999.999')                            | '148.5'                   |
| TO\_CHAR(148.5, 'FM999.990')                            | '148.500'                 |
| TO\_CHAR(148.5, '999D999')                              | ' 148.500'                |
| TO\_CHAR(3148.5, '9G999D999')                           | ' 3,148.500'              |
| TO\_CHAR(-485, '999S')                                  | '485-'                    |
| TO\_CHAR(-485, '999MI')                                 | '485-'                    |
| TO\_CHAR(485, '999MI')                                  | '485 '                    |
| TO\_CHAR(485, 'FM999MI')                                | '485'                     |
| TO\_CHAR(-485, '999PR')                                 | '\<485\>'                 |
| TO\_CHAR(485, 'L999')                                   | '$ 485'                   |
| TO\_CHAR(485, 'RN')                                     | '        CDLXXXV'         |
| TO\_CHAR(485, 'FMRN')                                   | 'CDLXXXV'                 |
| TO\_CHAR(5.2, 'FMRN')                                   | 'V'                       |
| TO\_CHAR(12, '99V999')                                  | ' 12000'                  |
| TO\_CHAR(12.4, '99V999')                                | ' 12400'                  |
| TO\_CHAR(12.45, '99V9')                                 | ' 125'                    |

#### IMMUTABLE TO\_CHAR(TIMESTAMP, format) Function

There are certain cases of the TO\_CHAR function that can result in usage of an IMMUTABLE form of the function. Basically, a function is IMMUTABLE if the function does not modify the database, and the function returns the same, consistent value dependent upon only its input parameters. That is, the settings of configuration parameters, the locale, the content of the database, etc. do not affect the results returned by the function.

For more information about function volatility categories VOLATILE, STABLE, and IMMUTABLE, please see the PostgreSQL Core documentation, available from EnterpriseDB at:

> <http://www.enterprisedb.com/docs/en/9.4/pg/xfunc-volatility.html>

A particular advantage of an IMMUTABLE function is that it can be used in the CREATE INDEX command to create an index based on that function.

In order for the TO\_CHAR function to use the IMMUTABLE form the following conditions must be satisfied:
 - The first parameter of the TO\_CHAR function must be of data type TIMESTAMP.
 - The format specified in the second parameter of the TO\_CHAR function must not affect the return value of the function based on factors such as language, locale, etc. For example a format of 'YYYY-MM-DD HH24:MI:SS' can be used for an IMMUTABLE form of the function since, regardless of locale settings, the result of the function is the date and time expressed solely in numeric form. However, a format of 'DD-MON-YYYY' cannot be used for an IMMUTABLE form of the function because the 3-character abbreviation of the month may return different results depending upon the locale setting.

Format patterns that result in a non-immutable function include any variations of spelled out or abbreviated months (MONTH, MON), days (DAY, DY), median indicators (AM, PM), or era indicators (BC, AD).

For the following example, a table with a TIMESTAMP column is created.

CREATE TABLE ts\_tbl (ts\_col TIMESTAMP);

The following shows the successful creation of an index with the IMMUTABLE form of the TO\_CHAR function.

edb=\# CREATE INDEX ts\_idx ON ts\_tbl (TO\_CHAR(ts\_col,'YYYY-MM-DD HH24:MI:SS'));

CREATE INDEX

edb=\# \\dS ts\_idx

Index "public.ts\_idx"

Column | Type | Definition

\---------+-------------------+-------------------------------------------------------------

to\_char | character varying | to\_char(ts\_col, 'YYYY-MM-DD HH24:MI:SS'::character varying)

btree, for table "public.ts\_tbl"

The following results in an error because the format specified in the TO\_CHAR function prevents the use of the IMMUTABLE form since the 3-character month abbreviation, MON, may result in different return values based on the locale setting.

edb=\# CREATE INDEX ts\_idx\_2 ON ts\_tbl (TO\_CHAR(ts\_col, 'DD-MON-YYYY'));

ERROR: functions in index expression must be marked IMMUTABLE

### Date/Time Functions and Operators

<span class="underline"></span>Table 3‑3‑28 shows the available functions for date/time value processing, with details appearing in the following subsections. Table 3‑3‑27 illustrates the behaviors of the basic arithmetic operators (+, -). For formatting functions, refer to Section <span class="underline"> </span> <span class="underline">3.5.7</span>. You should be familiar with the background information on date/time data types from Section <span class="underline"> </span> <span class="underline">3.2.4</span>.

Table 3‑3‑27 Date/Time Operators

|          |                                                                   |                    |
| -------- | ----------------------------------------------------------------- | ------------------ |
| Operator | Example                                                           | Result             |
| \+       | DATE '2001-09-28' + 7                                             | 05-OCT-01 00:00:00 |
| \+       | TIMESTAMP '2001-09-28 13:30:00' + 3                               | 01-OCT-01 13:30:00 |
| \-       | DATE '2001-10-01' - 7                                             | 24-SEP-01 00:00:00 |
| \-       | TIMESTAMP '2001-09-28 13:30:00' - 3                               | 25-SEP-01 13:30:00 |
| \-       | TIMESTAMP '2001-09-29 03:00:00' - TIMESTAMP '2001-09-27 12:00:00' | @ 1 day 15 hours   |

In the date/time functions of Table 3‑3‑28 the use of the DATE and TIMESTAMP data types are interchangeable.

Table 3‑3‑28 Date/Time Functions

<table>
<tbody>
<tr class="odd">
<td>Function</td>
<td>Return Type</td>
<td>Description</td>
<td>Example</td>
<td>Result</td>
</tr>
<tr class="even">
<td>ADD_MONTHS(DATE, NUMBER)</td>
<td>DATE</td>
<td>Add months to a date; see Section 3.5.7.1</td>
<td>ADD_MONTHS('28-FEB-97', 3.8)</td>
<td>31-MAY-97 00:00:00</td>
</tr>
<tr class="odd">
<td>CURRENT_DATE</td>
<td>DATE</td>
<td>Current date; see Section 3.5.7.8</td>
<td>CURRENT_DATE</td>
<td>04-JUL-07</td>
</tr>
<tr class="even">
<td>CURRENT_TIMESTAMP</td>
<td>TIMESTAMP</td>
<td>Returns the current date and time; see Section 3.5.8.8</td>
<td>CURRENT_TIMESTAMP</td>
<td>04-JUL-07 15:33:23.484</td>
</tr>
<tr class="odd">
<td>EXTRACT(<em>field</em> FROM TIMESTAMP)</td>
<td>DOUBLE PRECISION</td>
<td>Get subfield; see Section 3.5.8.2.</td>
<td>EXTRACT(hour FROM TIMESTAMP '2001-02-16 20:38:40')</td>
<td>20</td>
</tr>
<tr class="even">
<td>LAST_DAY(DATE)</td>
<td>DATE</td>
<td>Returns the last day of the month represented by the given date. If the given date contains a time portion, it is carried forward to the result unchanged.</td>
<td>LAST_DAY('14-APR-98')</td>
<td>30-APR-98 00:00:00</td>
</tr>
<tr class="odd">
<td>LOCALTIMESTAMP [ (<em>precision</em>) ]</td>
<td>TIMESTAMP</td>
<td>Current date and time (start of current transaction); see Section 3.5.7.8</td>
<td>LOCALTIMESTAMP</td>
<td>04-JUL-07 15:33:23.484</td>
</tr>
<tr class="even">
<td>MONTHS_BETWEEN(DATE, DATE)</td>
<td>NUMBER</td>
<td>Number of months between two dates; see Section 3.5.7.3</td>
<td>MONTHS_BETWEEN('28-FEB-07', '30-NOV-06')</td>
<td>3</td>
</tr>
<tr class="odd">
<td>NEXT_DAY(DATE, <em>dayofweek</em>)</td>
<td>DATE</td>
<td>Date falling on <em>dayofweek</em> following specified date; see Section 3.5.7.4</td>
<td>NEXT_DAY('16-APR-07','FRI')</td>
<td>20-APR-07 00:00:00</td>
</tr>
<tr class="even">
<td>NEW_TIME(DATE, VARCHAR, VARCHAR)</td>
<td>DATE</td>
<td>Converts a date and time to an alternate time zone</td>
<td>NEW_TIME(TO_DATE '2005/05/29 01:45', 'AST', 'PST')</td>
<td><p>2005/05/29</p>
<p>21:45:00</p></td>
</tr>
<tr class="odd">
<td>ROUND(DATE [, <em>format</em> ])</td>
<td>DATE</td>
<td>Date rounded according to <em>format</em>; see Section 3.5.7.6</td>
<td>ROUND(TO_DATE('29-MAY-05'),'MON')</td>
<td>01-JUN-05 00:00:00</td>
</tr>
<tr class="even">
<td>SYS_EXTRACT_UTC(TIMESTAMP WITH TIME ZONE)</td>
<td>TIMESTAMP</td>
<td>Returns Coordinated Universal Time</td>
<td>SYS_EXTRACT_UTC(CAST('24-MAR-11 12:30:00PM -04:00' AS TIMESTAMP WITH TIME ZONE))</td>
<td>24-MAR-11 16:30:00</td>
</tr>
<tr class="odd">
<td>SYSDATE</td>
<td>DATE</td>
<td>Returns current date and time</td>
<td>SYSDATE</td>
<td>01-AUG-12 11:12:34</td>
</tr>
<tr class="even">
<td>SYSTIMESTAMP()</td>
<td>TIMESTAMP</td>
<td>Returns current date and time</td>
<td>SYSTIMESTAMP</td>
<td>01-AUG-12 11:11:23.665229 -07:00</td>
</tr>
<tr class="odd">
<td>TRUNC(DATE [<em>format</em>])</td>
<td>DATE</td>
<td>Truncate according to format; see Section 3.5.7.7</td>
<td>TRUNC(TO_DATE('29-MAY-05'), 'MON')</td>
<td>01-MAY-05</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td>00:00:00</td>
</tr>
</tbody>
</table>

#### ADD\_MONTHS

The ADD\_MONTHS functions adds (or subtracts if the second parameter is negative) the specified number of months to the given date. The resulting day of the month is the same as the day of the month of the given date except when the day is the last day of the month in which case the resulting date always falls on the last day of the month.

Any fractional portion of the number of months parameter is truncated before performing the calculation.

If the given date contains a time portion, it is carried forward to the result unchanged.

The following are examples of the ADD\_MONTHS function.

SELECT ADD\_MONTHS('13-JUN-07',4) FROM DUAL;

add\_months

\--------------------

13-OCT-07 00:00:00

(1 row)

SELECT ADD\_MONTHS('31-DEC-06',2) FROM DUAL;

add\_months

\--------------------

28-FEB-07 00:00:00

(1 row)

SELECT ADD\_MONTHS('31-MAY-04',-3) FROM DUAL;

add\_months

\--------------------

29-FEB-04 00:00:00

(1 row)

#### EXTRACT

The EXTRACT function retrieves subfields such as year or hour from date/time values. The EXTRACT function returns values of type DOUBLE PRECISION. The following are valid field names:

YEAR

The year field

SELECT EXTRACT(YEAR FROM TIMESTAMP '2001-02-16 20:38:40') FROM DUAL;

date\_part

\-----------

2001

(1 row)

MONTH

The number of the month within the year (1 - 12)

SELECT EXTRACT(MONTH FROM TIMESTAMP '2001-02-16 20:38:40') FROM DUAL;

date\_part

\-----------

2

(1 row)

DAY

The day (of the month) field (1 - 31)

SELECT EXTRACT(DAY FROM TIMESTAMP '2001-02-16 20:38:40') FROM DUAL;

date\_part

\-----------

16

(1 row)

HOUR

The hour field (0 - 23)

SELECT EXTRACT(HOUR FROM TIMESTAMP '2001-02-16 20:38:40') FROM DUAL;

date\_part

\-----------

20

(1 row)

MINUTE

The minutes field (0 - 59)

SELECT EXTRACT(MINUTE FROM TIMESTAMP '2001-02-16 20:38:40') FROM DUAL;

date\_part

\-----------

38

(1 row)

SECOND

The seconds field, including fractional parts (0 - 59)

SELECT EXTRACT(SECOND FROM TIMESTAMP '2001-02-16 20:38:40') FROM DUAL;

date\_part

\-----------

40

(1 row)

#### MONTHS\_BETWEEN

The MONTHS\_BETWEEN function returns the number of months between two dates. The result is a numeric value which is positive if the first date is greater than the second date or negative if the first date is less than the second date.

The result is always a whole number of months if the day of the month of both date parameters is the same, or both date parameters fall on the last day of their respective months.

The following are some examples of the MONTHS\_BETWEEN function.

SELECT MONTHS\_BETWEEN('15-DEC-06','15-OCT-06') FROM DUAL;

months\_between

\----------------

2

(1 row)

SELECT MONTHS\_BETWEEN('15-OCT-06','15-DEC-06') FROM DUAL;

months\_between

\----------------

\-2

(1 row)

SELECT MONTHS\_BETWEEN('31-JUL-00','01-JUL-00') FROM DUAL;

months\_between

\----------------

0.967741935

(1 row)

SELECT MONTHS\_BETWEEN('01-JAN-07','01-JAN-06') FROM DUAL;

months\_between

\----------------

12

(1 row)

#### NEXT\_DAY

The NEXT\_DAY function returns the first occurrence of the given weekday strictly greater than the given date. At least the first three letters of the weekday must be specified - e.g., SAT. If the given date contains a time portion, it is carried forward to the result unchanged.

The following are examples of the NEXT\_DAY function.

SELECT NEXT\_DAY(TO\_DATE('13-AUG-07','DD-MON-YY'),'SUNDAY') FROM DUAL;

next\_day

\--------------------

19-AUG-07 00:00:00

(1 row)

SELECT NEXT\_DAY(TO\_DATE('13-AUG-07','DD-MON-YY'),'MON') FROM DUAL;

next\_day

\--------------------

20-AUG-07 00:00:00

(1 row)

#### NEW\_TIME

The NEW\_TIME function converts a date and time from one time zone to another. NEW\_TIME returns a value of type DATE. The syntax is:

NEW\_TIME(*DATE*, *time\_zone1*, *time\_zone2*)

*time\_zone1* and *time\_zone2* must be string values from the Time Zone column of the following table:

| Time Zone | Offset from UTC | Description                 |
| --------- | --------------- | --------------------------- |
| AST       | UTC+4           | Atlantic Standard Time      |
| ADT       | UTC+3           | Atlantic Daylight Time      |
| BST       | UTC+11          | Bering Standard Time        |
| BDT       | UTC+10          | Bering Daylight Time        |
| CST       | UTC+6           | Central Standard Time       |
| CDT       | UTC+5           | Central Daylight Time       |
| EST       | UTC+5           | Eastern Standard Time       |
| EDT       | UTC+4           | Eastern Daylight Time       |
| GMT       | UTC             | Greenwich Mean Time         |
| HST       | UTC+10          | Alaska-Hawaii Standard Time |
| HDT       | UTC+9           | Alaska-Hawaii Daylight Time |
| MST       | UTC+7           | Mountain Standard Time      |
| MDT       | UTC+6           | Mountain Daylight Time      |
| NST       | UTC+3:30        | Newfoundland Standard Time  |
| PST       | UTC+8           | Pacific Standard Time       |
| PDT       | UTC+7           | Pacific Daylight Time       |
| YST       | UTC+9           | Yukon Standard Time         |
| YDT       | UTC+8           | Yukon Daylight Time         |

Following is an example of the NEW\_TIME function.

SELECT NEW\_TIME(TO\_DATE('08-13-07 10:35:15','MM-DD-YY HH24:MI:SS'),'AST', 'PST') "Pacific Standard Time" FROM DUAL;

Pacific Standard Time

\---------------------

13-AUG-07 06:35:15

(1 row)

#### ROUND

The ROUND function returns a date rounded according to a specified template pattern. If the template pattern is omitted, the date is rounded to the nearest day. The following table shows the template patterns for the ROUND function.

Table 3‑3‑29 Template Date Patterns for the ROUND Function

|                                     |                                                                                                                                                                                                                                                      |
| ----------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Pattern                             | Description                                                                                                                                                                                                                                          |
| CC, SCC                             | Returns January 1, *cc*01 where *cc* is first 2 digits of the given year if last 2 digits \<= 50, or 1 greater than the first 2 digits of the given year if last 2 digits \> 50; (for AD years)                                                      |
| SYYY, YYYY, YEAR, SYEAR, YYY, YY, Y | Returns January 1, *yyyy* where *yyyy* is rounded to the nearest year; rounds down on June 30, rounds up on July 1                                                                                                                                   |
| IYYY, IYY, IY, I                    | Rounds to the beginning of the ISO year which is determined by rounding down if the month and day is on or before June 30th, or by rounding up if the month and day is July 1st or later                                                             |
| Q                                   | Returns the first day of the quarter determined by rounding down if the month and day is on or before the 15th of the second month of the quarter, or by rounding up if the month and day is on the 16th of the second month or later of the quarter |
| MONTH, MON, MM, RM                  | Returns the first day of the specified month if the day of the month is on or prior to the 15th; returns the first day of the following month if the day of the month is on the 16th or later                                                        |
| WW                                  | Round to the nearest date that corresponds to the same day of the week as the first day of the year                                                                                                                                                  |
| IW                                  | Round to the nearest date that corresponds to the same day of the week as the first day of the ISO year                                                                                                                                              |
| W                                   | Round to the nearest date that corresponds to the same day of the week as the first day of the month                                                                                                                                                 |
| DDD, DD, J                          | Rounds to the start of the nearest day; 11:59:59 AM or earlier rounds to the start of the same day; 12:00:00 PM or later rounds to the start of the next day                                                                                         |
| DAY, DY, D                          | Rounds to the nearest Sunday                                                                                                                                                                                                                         |
| HH, HH12, HH24                      | Round to the nearest hour                                                                                                                                                                                                                            |
| MI                                  | Round to the nearest minute                                                                                                                                                                                                                          |

Following are examples of usage of the ROUND function.

The following examples round to the nearest hundred years.

SELECT TO\_CHAR(ROUND(TO\_DATE('1950','YYYY'),'CC'),'DD-MON-YYYY') "Century" FROM DUAL;

Century

\-------------

01-JAN-1901

(1 row)

SELECT TO\_CHAR(ROUND(TO\_DATE('1951','YYYY'),'CC'),'DD-MON-YYYY') "Century" FROM DUAL;

Century

\-------------

01-JAN-2001

(1 row)

The following examples round to the nearest year.

SELECT TO\_CHAR(ROUND(TO\_DATE('30-JUN-1999','DD-MON-YYYY'),'Y'),'DD-MON-YYYY') "Year" FROM DUAL;

Year

\-------------

01-JAN-1999

(1 row)

SELECT TO\_CHAR(ROUND(TO\_DATE('01-JUL-1999','DD-MON-YYYY'),'Y'),'DD-MON-YYYY') "Year" FROM DUAL;

Year

\-------------

01-JAN-2000

(1 row)

The following examples round to the nearest ISO year. The first example rounds to 2004 and the ISO year for 2004 begins on December 29<sup>th</sup> of 2003. The second example rounds to 2005 and the ISO year for 2005 begins on January 3<sup>rd</sup> of that same year.

(An ISO year begins on the first Monday from which a 7 day span, Monday thru Sunday, contains at least 4 days of the new year. Thus, it is possible for the beginning of an ISO year to start in December of the prior year.)

SELECT TO\_CHAR(ROUND(TO\_DATE('30-JUN-2004','DD-MON-YYYY'),'IYYY'),'DD-MON-YYYY') "ISO Year" FROM DUAL;

ISO Year

\-------------

29-DEC-2003

(1 row)

SELECT TO\_CHAR(ROUND(TO\_DATE('01-JUL-2004','DD-MON-YYYY'),'IYYY'),'DD-MON-YYYY') "ISO Year" FROM DUAL;

ISO Year

\-------------

03-JAN-2005

(1 row)

The following examples round to the nearest quarter.

SELECT ROUND(TO\_DATE('15-FEB-07','DD-MON-YY'),'Q') "Quarter" FROM DUAL;

Quarter

\--------------------

01-JAN-07 00:00:00

(1 row)

SELECT ROUND(TO\_DATE('16-FEB-07','DD-MON-YY'),'Q') "Quarter" FROM DUAL;

Quarter

\--------------------

01-APR-07 00:00:00

(1 row)

The following examples round to the nearest month.

SELECT ROUND(TO\_DATE('15-DEC-07','DD-MON-YY'),'MONTH') "Month" FROM DUAL;

Month

\--------------------

01-DEC-07 00:00:00

(1 row)

SELECT ROUND(TO\_DATE('16-DEC-07','DD-MON-YY'),'MONTH') "Month" FROM DUAL;

Month

\--------------------

01-JAN-08 00:00:00

(1 row)

The following examples round to the nearest week. The first day of 2007 lands on a Monday so in the first example, January 18<sup>th</sup> is closest to the Monday that lands on January 15<sup>th</sup>. In the second example, January 19<sup>th</sup> is closer to the Monday that falls on January 22<sup>nd</sup>.

SELECT ROUND(TO\_DATE('18-JAN-07','DD-MON-YY'),'WW') "Week" FROM DUAL;

Week

\--------------------

15-JAN-07 00:00:00

(1 row)

SELECT ROUND(TO\_DATE('19-JAN-07','DD-MON-YY'),'WW') "Week" FROM DUAL;

Week

\--------------------

22-JAN-07 00:00:00

(1 row)

The following examples round to the nearest ISO week. An ISO week begins on a Monday. In the first example, January 1, 2004 is closest to the Monday that lands on December 29, 2003. In the second example, January 2, 2004 is closer to the Monday that lands on January 5, 2004.

SELECT ROUND(TO\_DATE('01-JAN-04','DD-MON-YY'),'IW') "ISO Week" FROM DUAL;

ISO Week

\--------------------

29-DEC-03 00:00:00

(1 row)

SELECT ROUND(TO\_DATE('02-JAN-04','DD-MON-YY'),'IW') "ISO Week" FROM DUAL;

ISO Week

\--------------------

05-JAN-04 00:00:00

(1 row)

The following examples round to the nearest week where a week is considered to start on the same day as the first day of the month.

SELECT ROUND(TO\_DATE('05-MAR-07','DD-MON-YY'),'W') "Week" FROM DUAL;

Week

\--------------------

08-MAR-07 00:00:00

(1 row)

SELECT ROUND(TO\_DATE('04-MAR-07','DD-MON-YY'),'W') "Week" FROM DUAL;

Week

\--------------------

01-MAR-07 00:00:00

(1 row)

The following examples round to the nearest day.

SELECT ROUND(TO\_DATE('04-AUG-07 11:59:59 AM','DD-MON-YY HH:MI:SS AM'),'J') "Day" FROM DUAL;

Day

\--------------------

04-AUG-07 00:00:00

(1 row)

SELECT ROUND(TO\_DATE('04-AUG-07 12:00:00 PM','DD-MON-YY HH:MI:SS AM'),'J') "Day" FROM DUAL;

Day

\--------------------

05-AUG-07 00:00:00

(1 row)

The following examples round to the start of the nearest day of the week (Sunday).

SELECT ROUND(TO\_DATE('08-AUG-07','DD-MON-YY'),'DAY') "Day of Week" FROM DUAL;

Day of Week

\--------------------

05-AUG-07 00:00:00

(1 row)

SELECT ROUND(TO\_DATE('09-AUG-07','DD-MON-YY'),'DAY') "Day of Week" FROM DUAL;

Day of Week

\--------------------

12-AUG-07 00:00:00

(1 row)

The following examples round to the nearest hour.

SELECT TO\_CHAR(ROUND(TO\_DATE('09-AUG-07 08:29','DD-MON-YY HH:MI'),'HH'),'DD-MON-YY HH24:MI:SS') "Hour" FROM DUAL;

Hour

\--------------------

09-AUG-07 08:00:00

(1 row)

SELECT TO\_CHAR(ROUND(TO\_DATE('09-AUG-07 08:30','DD-MON-YY HH:MI'),'HH'),'DD-MON-YY HH24:MI:SS') "Hour" FROM DUAL;

Hour

\--------------------

09-AUG-07 09:00:00

(1 row)

The following examples round to the nearest minute.

SELECT TO\_CHAR(ROUND(TO\_DATE('09-AUG-07 08:30:29','DD-MON-YY HH:MI:SS'),'MI'),'DD-MON-YY HH24:MI:SS') "Minute" FROM DUAL;

Minute

\--------------------

09-AUG-07 08:30:00

(1 row)

SELECT TO\_CHAR(ROUND(TO\_DATE('09-AUG-07 08:30:30','DD-MON-YY HH:MI:SS'),'MI'),'DD-MON-YY HH24:MI:SS') "Minute" FROM DUAL;

Minute

\--------------------

09-AUG-07 08:31:00

(1 row)

#### TRUNC

The TRUNC function returns a date truncated according to a specified template pattern. If the template pattern is omitted, the date is truncated to the nearest day. The following table shows the template patterns for the TRUNC function.

Table 3‑3‑30 Template Date Patterns for the TRUNC Function

|                                     |                                                                                                                                                  |
| ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| Pattern                             | Description                                                                                                                                      |
| CC, SCC                             | Returns January 1, *cc*01 where *cc* is first 2 digits of the given year                                                                         |
| SYYY, YYYY, YEAR, SYEAR, YYY, YY, Y | Returns January 1, *yyyy* where *yyyy* is the given year                                                                                         |
| IYYY, IYY, IY, I                    | Returns the start date of the ISO year containing the given date                                                                                 |
| Q                                   | Returns the first day of the quarter containing the given date                                                                                   |
| MONTH, MON, MM, RM                  | Returns the first day of the specified month                                                                                                     |
| WW                                  | Returns the largest date just prior to, or the same as the given date that corresponds to the same day of the week as the first day of the year  |
| IW                                  | Returns the start of the ISO week containing the given date                                                                                      |
| W                                   | Returns the largest date just prior to, or the same as the given date that corresponds to the same day of the week as the first day of the month |
| DDD, DD, J                          | Returns the start of the day for the given date                                                                                                  |
| DAY, DY, D                          | Returns the start of the week (Sunday) containing the given date                                                                                 |
| HH, HH12, HH24                      | Returns the start of the hour                                                                                                                    |
| MI                                  | Returns the start of the minute                                                                                                                  |

Following are examples of usage of the TRUNC function.

The following example truncates down to the hundred years unit.

SELECT TO\_CHAR(TRUNC(TO\_DATE('1951','YYYY'),'CC'),'DD-MON-YYYY') "Century" FROM DUAL;

Century

\-------------

01-JAN-1901

(1 row)

The following example truncates down to the year.

SELECT TO\_CHAR(TRUNC(TO\_DATE('01-JUL-1999','DD-MON-YYYY'),'Y'),'DD-MON-YYYY') "Year" FROM DUAL;

Year

\-------------

01-JAN-1999

(1 row)

The following example truncates down to the beginning of the ISO year.

SELECT TO\_CHAR(TRUNC(TO\_DATE('01-JUL-2004','DD-MON-YYYY'),'IYYY'),'DD-MON-YYYY') "ISO Year" FROM DUAL;

ISO Year

\-------------

29-DEC-2003

(1 row)

The following example truncates down to the start date of the quarter.

SELECT TRUNC(TO\_DATE('16-FEB-07','DD-MON-YY'),'Q') "Quarter" FROM DUAL;

Quarter

\--------------------

01-JAN-07 00:00:00

(1 row)

The following example truncates to the start of the month.

SELECT TRUNC(TO\_DATE('16-DEC-07','DD-MON-YY'),'MONTH') "Month" FROM DUAL;

Month

\--------------------

01-DEC-07 00:00:00

(1 row)

The following example truncates down to the start of the week determined by the first day of the year. The first day of 2007 lands on a Monday so the Monday just prior to January 19<sup>th</sup> is January 15<sup>th</sup>.

SELECT TRUNC(TO\_DATE('19-JAN-07','DD-MON-YY'),'WW') "Week" FROM DUAL;

Week

\--------------------

15-JAN-07 00:00:00

(1 row)

The following example truncates to the start of an ISO week. An ISO week begins on a Monday. January 2, 2004 falls in the ISO week that starts on Monday, December 29, 2003.

SELECT TRUNC(TO\_DATE('02-JAN-04','DD-MON-YY'),'IW') "ISO Week" FROM DUAL;

ISO Week

\--------------------

29-DEC-03 00:00:00

(1 row)

The following example truncates to the start of the week where a week is considered to start on the same day as the first day of the month.

SELECT TRUNC(TO\_DATE('21-MAR-07','DD-MON-YY'),'W') "Week" FROM DUAL;

Week

\--------------------

15-MAR-07 00:00:00

(1 row)

The following example truncates to the start of the day.

SELECT TRUNC(TO\_DATE('04-AUG-07 12:00:00 PM','DD-MON-YY HH:MI:SS AM'),'J') "Day" FROM DUAL;

Day

\--------------------

04-AUG-07 00:00:00

(1 row)

The following example truncates to the start of the week (Sunday).

SELECT TRUNC(TO\_DATE('09-AUG-07','DD-MON-YY'),'DAY') "Day of Week" FROM DUAL;

Day of Week

\--------------------

05-AUG-07 00:00:00

(1 row)

The following example truncates to the start of the hour.

SELECT TO\_CHAR(TRUNC(TO\_DATE('09-AUG-07 08:30','DD-MON-YY HH:MI'),'HH'),'DD-MON-YY HH24:MI:SS') "Hour" FROM DUAL;

Hour

\--------------------

09-AUG-07 08:00:00

(1 row)

The following example truncates to the minute.

SELECT TO\_CHAR(TRUNC(TO\_DATE('09-AUG-07 08:30:30','DD-MON-YY HH:MI:SS'),'MI'),'DD-MON-YY HH24:MI:SS') "Minute" FROM DUAL;

Minute

\--------------------

09-AUG-07 08:30:00

(1 row)

#### CURRENT DATE/TIME

Postgres Plus Advanced Server provides a number of functions that return values related to the current date and time. These functions all return values based on the start time of the current transaction.
 - CURRENT\_DATE
 - CURRENT\_TIMESTAMP
 - LOCALTIMESTAMP
 - LOCALTIMESTAMP(precision)

CURRENT\_DATE returns the current date and time based on the start time of the current transaction. The value of CURRENT\_DATE will not change if called multiple times within a transaction.

SELECT CURRENT\_DATE FROM DUAL;

date

\-----------

06-AUG-07

CURRENT\_TIMESTAMP returns the current date and time. When called from a single SQL statement, it will return the same value for each occurrence within the statement. If called from multiple statements within a transaction, may return different values for each occurrence. If called from a function, may return a different value than the value returned by current\_timestamp in the caller.

SELECT CURRENT\_TIMESTAMP, CURRENT\_TIMESTAMP FROM DUAL;

current\_timestamp | current\_timestamp

\----------------------------------+----------------------------------

02-SEP-13 17:52:29.261473 +05:00 | 02-SEP-13 17:52:29.261474 +05:00

LOCALTIMESTAMP can optionally be given a precision parameter which causes the result to be rounded to that many fractional digits in the seconds field. Without a precision parameter, the result is given to the full available precision.

SELECT LOCALTIMESTAMP FROM DUAL;

timestamp

\------------------------

06-AUG-07 16:11:35.973

(1 row)

SELECT LOCALTIMESTAMP(2) FROM DUAL;

timestamp

\-----------------------

06-AUG-07 16:11:44.58

(1 row)

Since these functions return the start time of the current transaction, their values do not change during the transaction. This is considered a feature: the intent is to allow a single transaction to have a consistent notion of the “current” time, so that multiple modifications within the same transaction bear the same time stamp. Other database systems may advance these values more frequently.

### Sequence Manipulation Functions

This section describes Postgres Plus Advanced Server’s functions for operating on sequence objects. Sequence objects (also called sequence generators or just sequences) are special single-row tables created with the CREATE SEQUENCE command. A sequence object is usually used to generate unique identifiers for rows of a table. The sequence functions, listed below, provide simple, multiuser-safe methods for obtaining successive sequence values from sequence objects.

*sequence*.NEXTVAL

*sequence*.CURRVAL

*sequence* is the identifier assigned to the sequence in the CREATE SEQUENCE command. The following describes the usage of these functions.

NEXTVAL

Advance the sequence object to its next value and return that value. This is done atomically: even if multiple sessions execute NEXTVAL concurrently, each will safely receive a distinct sequence value.

CURRVAL

Return the value most recently obtained by NEXTVAL for this sequence in the current session. (An error is reported if NEXTVAL has never been called for this sequence in this session.) Notice that because this is returning a session-local value, it gives a predictable answer whether or not other sessions have executed NEXTVAL since the current session did.

If a sequence object has been created with default parameters, NEXTVAL calls on it will return successive values beginning with 1. Other behaviors can be obtained by using special parameters in the CREATE SEQUENCE command.

**Important**: To avoid blocking of concurrent transactions that obtain numbers from the same sequence, a NEXTVAL operation is never rolled back; that is, once a value has been fetched it is considered used, even if the transaction that did the NEXTVAL later aborts. This means that aborted transactions may leave unused "holes" in the sequence of assigned values.

### Conditional Expressions

The following section describes the SQL-compliant conditional expressions available in Postgres Plus Advanced Server.

#### CASE

The SQL CASE expression is a generic conditional expression, similar to if/else statements in other languages:

CASE WHEN *condition* THEN *result*

\[ WHEN ... \]

\[ ELSE *result* \]

END

CASE clauses can be used wherever an expression is valid. *condition* is an expression that returns a BOOLEAN result. If the result is true then the value of the CASE expression is the *result* that follows the condition. If the result is false any subsequent WHEN clauses are searched in the same manner. If no WHEN *condition* is true then the value of the CASE expression is the *result* in the ELSE clause. If the ELSE clause is omitted and no condition matches, the result is null.

An example:

SELECT \* FROM test;

a

\---

1

2

3

(3 rows)

SELECT a,

CASE WHEN a=1 THEN 'one'

WHEN a=2 THEN 'two'

ELSE 'other'

END

FROM test;

a | case

\---+-------

1 | one

2 | two

3 | other

(3 rows)

The data types of all the *result* expressions must be convertible to a single output type.

The following “simple” CASE expression is a specialized variant of the general form above:

CASE *expression*

WHEN *value* THEN *result*

\[ WHEN ... \]

\[ ELSE *result* \]

END

The *expression* is computed and compared to all the *value* specifications in the WHEN clauses until one is found that is equal. If no match is found, the *result* in the ELSE clause (or a null value) is returned.

The example above can be written using the simple CASE syntax:

SELECT a,

CASE a WHEN 1 THEN 'one'

WHEN 2 THEN 'two'

ELSE 'other'

END

FROM test;

a | case

\---+-------

1 | one

2 | two

3 | other

(3 rows)

A CASE expression does not evaluate any subexpressions that are not needed to determine the result. For example, this is a possible way of avoiding a division-by-zero failure:

SELECT ... WHERE CASE WHEN x \<\> 0 THEN y/x \> 1.5 ELSE false END;

#### COALESCE

The COALESCE function returns the first of its arguments that is not null. Null is returned only if all arguments are null.

COALESCE(*value* \[, *value2* \] ... )

It is often used to substitute a default value for null values when data is retrieved for display or further computation. For example:

SELECT COALESCE(description, short\_description, '(none)') ...

Like a CASE expression, COALESCE will not evaluate arguments that are not needed to determine the result; that is, arguments to the right of the first non-null argument are not evaluated. This SQL-standard function provides capabilities similar to NVL and IFNULL, which are used in some other database systems.

#### NULLIF

The NULLIF function returns a null value if *value1* and *value2* are equal; otherwise it returns *value1*.

NULLIF(*value1*, *value2*)

This can be used to perform the inverse operation of the COALESCE example given above:

SELECT NULLIF(value1, '(none)') ...

If *value1* is (none), return a null, otherwise return *value1*.

#### NVL

The NVL function returns the first of its arguments that is not null. NVL evaluates the first expression; if that expression evaluates to NULL, NVL returns the second expression.

> NVL(*expr1*, *expr2*)

The return type is the same as the argument types; all arguments must have the same data type (or be coercible to a common type). NVL returns NULL if all arguments are NULL.

The following example computes a bonus for non-commissioned employees, If an employee is a commissioned employee, this expression returns the employees commission; if the employee is not a commissioned employee (that is, his commission is NULL), this expression returns a bonus that is 10% of his salary.

> bonus = NVL(emp.commission, emp.salary \* .10)

#### NVL2

NVL2 evaluates an expression, and returns either the second or third expression, depending on the value of the first expression. If the first expression is not NULL, NVL2 returns the value in expr2; if the first expression is NULL, NVL2 returns the value in expr3.

> NVL2(expr1, expr2, expr3)

The return type is the same as the argument types; all arguments must have the same data type (or be coercible to a common type).

The following example computes a bonus for commissioned employees - if a given employee is a commissioned employee, this expression returns an amount equal to 110% of his commission; if the employee is not a commissioned employee (that is, his commission is NULL), this expression returns 0.

> bonus = NVL2(emp.commission, emp.commission \* 1.1, 0)

#### GREATEST and LEAST

The GREATEST and LEAST functions select the largest or smallest value from a list of any number of expressions.

GREATEST(*value* \[, *value2* \] ... )

LEAST(*value* \[, *value2* \] ... )

The expressions must all be convertible to a common data type, which will be the type of the result. Null values in the list are ignored. The result will be null only if all the expressions evaluate to null.

Note that GREATEST and LEAST are not in the SQL standard, but are a common extension.

### Aggregate Functions

*Aggregate* functions compute a single result value from a set of input values. The built-in aggregate functions are listed in the following tables.

Table 3‑3‑31 General-Purpose Aggregate Functions

|                     |                                               |                                                                                                                                                                    |                                                                    |
| ------------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------ |
| Function            | Argument Type                                 | Return Type                                                                                                                                                        | Description                                                        |
| AVG(*expression*)   | INTEGER, REAL, DOUBLE PRECISION, NUMBER       | NUMBER for any integer type, DOUBLE PRECISION for a floating-point argument, otherwise the same as the argument data type                                          | The average (arithmetic mean) of all input values                  |
| COUNT(\*)           |                                               | BIGINT                                                                                                                                                             | Number of input rows                                               |
| COUNT(*expression*) | Any                                           | BIGINT                                                                                                                                                             | Number of input rows for which the value of expression is not null |
| MAX(*expression*)   | Any numeric, string, date/time, or bytea type | Same as argument type                                                                                                                                              | Maximum value of expression across all input values                |
| MIN(*expression*)   | Any numeric, string, date/time, or bytea type | Same as argument type                                                                                                                                              | Minimum value of expression across all input values                |
| SUM(*expression*)   | INTEGER, REAL, DOUBLE PRECISION, NUMBER       | BIGINT for SMALLINT or INTEGER arguments, NUMBER for BIGINT arguments, DOUBLE PRECISION for floating-point arguments, otherwise the same as the argument data type | Sum of expression across all input values                          |

It should be noted that except for COUNT, these functions return a null value when no rows are selected. In particular, SUM of no rows returns null, not zero as one might expect. The COALESCE function may be used to substitute zero for null when necessary.

The following table shows the aggregate functions typically used in statistical analysis. (These are separated out merely to avoid cluttering the listing of more-commonly-used aggregates.) Where the description mentions *N*, it means the number of input rows for which all the input expressions are non-null. In all cases, null is returned if the computation is meaningless, for example when *N* is zero.

Table 3‑3‑32 Aggregate Functions for Statistics

|                            |                                         |                                                                 |                                                                                                           |
| -------------------------- | --------------------------------------- | --------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| Function                   | Argument Type                           | Return Type                                                     | Description                                                                                               |
| CORR(*Y*, *X*)             | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Correlation coefficient                                                                                   |
| COVAR\_POP(*Y*, *X*)       | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Population covariance                                                                                     |
| COVAR\_SAMP(*Y*, *X*)      | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Sample covariance                                                                                         |
| REGR\_AVGX(*Y*, *X*)       | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Average of the independent variable (sum(*X*) / *N*)                                                      |
| REGR\_AVGY(*Y*, *X*)       | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Average of the dependent variable (sum(*Y*) / *N*)                                                        |
| REGR\_COUNT(*Y*, *X*)      | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Number of input rows in which both expressions are nonnull                                                |
| REGR\_INTERCEPT(*Y*, *X*)  | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | y-intercept of the least-squares-fit linear equation determined by the (*X*, *Y*) pairs                   |
| REGR\_R2(*Y*, *X*)         | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Square of the correlation coefficient                                                                     |
| REGR\_SLOPE(*Y*, *X*)      | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Slope of the least-squares-fit linear equation determined by the (*X*, *Y*) pairs                         |
| REGR\_SXX(*Y*, *X*)        | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Sum (*X*<sup>2</sup>) – sum (*X*)<sup>2</sup> / *N* (“sum of squares” of the independent variable)        |
| REGR\_SXY(*Y*, *X*)        | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Sum (*X*\**Y*) – sum (*X*) \* sum (*Y*) / *N* (“sum of products” of independent times dependent variable) |
| REGR\_SYY(*Y*, *X*)        | DOUBLE PRECISION                        | DOUBLE PRECISION                                                | Sum (*Y*<sup>2</sup>) – sum (*Y*)<sup>2</sup> / *N* (“sum of squares” of the dependent variable)          |
| STDDEV(*expression*)       | INTEGER, REAL, DOUBLE PRECISION, NUMBER | DOUBLE PRECISION for floating-point arguments, otherwise NUMBER | Historic alias for STDDEV\_SAMP                                                                           |
| STDDEV\_POP(*expression*)  | INTEGER, REAL, DOUBLE PRECISION, NUMBER | DOUBLE PRECISION for floating-point arguments, otherwise NUMBER | Population standard deviation of the input values                                                         |
| STDDEV\_SAMP(*expression*) | INTEGER, REAL, DOUBLE PRECISION, NUMBER | DOUBLE PRECISION for floating-point arguments, otherwise NUMBER | Sample standard deviation of the input values                                                             |
| VARIANCE(*expression*)     | INTEGER, REAL, DOUBLE PRECISION, NUMBER | DOUBLE PRECISION for floating-point arguments, otherwise NUMBER | Historical alias for VAR\_SAMP                                                                            |
| VAR\_POP(*expression*)     | INTEGER, REAL, DOUBLE PRECISION, NUMBER | DOUBLE PRECISION for floating-point arguments, otherwise NUMBER | Population variance of the input values (square of the population standard deviation)                     |
| VAR\_SAMP(*expression*)    | INTEGER, REAL, DOUBLE PRECISION, NUMBER | DOUBLE PRECISION for floating-point arguments, otherwise NUMBER | Sample variance of the input values (square of the sample standard deviation)                             |

### Subquery Expressions

This section describes the SQL-compliant subquery expressions available in Postgres Plus Advanced Server. All of the expression forms documented in this section return Boolean (true/false) results.

#### EXISTS

The argument of EXISTS is an arbitrary SELECT statement, or subquery. The subquery is evaluated to determine whether it returns any rows. If it returns at least one row, the result of EXISTS is TRUE; if the subquery returns no rows, the result of EXISTS is FALSE.

EXISTS(*subquery*)

The subquery can refer to variables from the surrounding query, which will act as constants during any one evaluation of the subquery.

The subquery will generally only be executed far enough to determine whether at least one row is returned, not all the way to completion. It is unwise to write a subquery that has any side effects (such as calling sequence functions); whether the side effects occur or not may be difficult to predict.

Since the result depends only on whether any rows are returned, and not on the contents of those rows, the output list of the subquery is normally uninteresting. A common coding convention is to write all EXISTS tests in the form EXISTS(SELECT 1 WHERE ...). There are exceptions to this rule however, such as subqueries that use INTERSECT.

This simple example is like an inner join on deptno, but it produces at most one output row for each dept row, even though there are multiple matching emp rows:

SELECT dname FROM dept WHERE EXISTS (SELECT 1 FROM emp WHERE emp.deptno = dept.deptno);

dname

\------------

ACCOUNTING

RESEARCH

SALES

(3 rows)

#### IN

The right-hand side is a parenthesized subquery, which must return exactly one column. The left-hand expression is evaluated and compared to each row of the subquery result. The result of IN is TRUE if any equal subquery row is found. The result is FALSE if no equal row is found (including the special case where the subquery returns no rows).

*expression* IN (*subquery*)

Note that if the left-hand expression yields null, or if there are no equal right-hand values and at least one right-hand row yields null, the result of the IN construct will be null, not false. This is in accordance with SQL’s normal rules for Boolean combinations of null values.

As with EXISTS, it’s unwise to assume that the subquery will be evaluated completely.

#### NOT IN

The right-hand side is a parenthesized subquery, which must return exactly one column. The left-hand expression is evaluated and compared to each row of the subquery result. The result of NOT IN is TRUE if only unequal subquery rows are found (including the special case where the subquery returns no rows). The result is FALSE if any equal row is found.

*expression* NOT IN (*subquery*)

Note that if the left-hand expression yields null, or if there are no equal right-hand values and at least one right-hand row yields null, the result of the NOT IN construct will be null, not true. This is in accordance with SQL’s normal rules for Boolean combinations of null values.

As with EXISTS, it’s unwise to assume that the subquery will be evaluated completely.

#### ANY/SOME

The right-hand side is a parenthesized subquery, which must return exactly one column. The left-hand expression is evaluated and compared to each row of the subquery result using the given operator, which must yield a Boolean result. The result of ANY is TRUE if any true result is obtained. The result is FALSE if no true result is found (including the special case where the subquery returns no rows).

*expression* *operator* ANY (*subquery*)

*expression* *operator* SOME (*subquery*)

SOME is a synonym for ANY. IN is equivalent to = ANY.

Note that if there are no successes and at least one right-hand row yields null for the operator’s result, the result of the ANY construct will be null, not false. This is in accordance with SQL’s normal rules for Boolean combinations of null values.

As with EXISTS, it’s unwise to assume that the subquery will be evaluated completely.

#### ALL

The right-hand side is a parenthesized subquery, which must return exactly one column. The left-hand expression is evaluated and compared to each row of the subquery result using the given operator, which must yield a Boolean result. The result of ALL is TRUE if all rows yield true (including the special case where the subquery returns no rows). The result is FALSE if any false result is found. The result is null if the comparison does not return false for any row, and it returns null for at least one row.

*expression* *operator* ALL (*subquery*)

NOT IN is equivalent to \<\> ALL. As with EXISTS, it’s unwise to assume that the subquery will be evaluated completely.

